/*!
 * my-mcbe-script-better-door.js v0.0.0 (https://github.com/PFiS1737/my-mcbe-script#readme)
 * Copyright 2022-2024 PFiS1737
 * Licensed under MIT
 * 
 * This file is automatically generated, please do not change it.
 */
import{system as t,world as e,BlockPermutation as r,BlockVolume as s,ItemStack as n,MinecraftDimensionTypes as i,Dimension as a,Entity as o,GameMode as c}from"@minecraft/server";import{MessageFormData as h,FormCancelationReason as u,ModalFormResponse as d,MessageFormResponse as l,ActionFormResponse as m,ModalFormData as p,ActionFormData as _}from"@minecraft/server-ui";class f{static error(t){console.error(`${t}\n${t.stack}`)}}function g(t,e,r){if(Array.isArray(t))t.forEach(e,r);else if(t?.[Symbol.iterator])for(const s of t)e.call(r,s,t);else"object"==typeof t&&g(Object.keys(t),((s,n)=>e.call(r,t[s],s,n,t)))}async function y(t,e,r){if(Array.isArray(t))for(let s=0;s<t.length;s++)await e.call(r,t[s],s,t);else if(t?.[Symbol.iterator])for(const s of t)await e.call(r,s,t);else"object"==typeof t&&await y(Object.keys(t),(async(s,n)=>await e.call(r,t[s],s,n,t)))}function w(t){try{return JSON.parse(t)}catch(e){return function(t,e={}){return new Function(...Object.keys(e),`return ${t}`)(...Object.values(e))}(`(${t})`)}}function b(t){return"AsyncFunction"===t[Symbol.toStringTag]}class v{constructor(t){this.types=new Set(t)}add(...t){return g(t,(t=>this.types.add(t))),this}has(t){return this.types.has(t)}clone(){return new v([...this])}toArray(){return Array.from(this)}[Symbol.iterator](){return this.types.keys()}}const x=new v(["minecraft:acacia_door","minecraft:bamboo_door","minecraft:birch_door","minecraft:cherry_door","minecraft:crimson_door","minecraft:dark_oak_door","minecraft:jungle_door","minecraft:mangrove_door","minecraft:spruce_door","minecraft:warped_door","minecraft:wooden_door"]),I=new v(["minecraft:copper_door","minecraft:exposed_copper_door","minecraft:weathered_copper_door","minecraft:oxidized_copper_door","minecraft:waxed_copper_door","minecraft:waxed_exposed_copper_door","minecraft:waxed_weathered_copper_door","minecraft:waxed_oxidized_copper_door"]),S=new v([...x,...I,"minecraft:iron_door"]),A=new v(["minecraft:acacia_trapdoor","minecraft:bamboo_trapdoor","minecraft:birch_trapdoor","minecraft:cherry_trapdoor","minecraft:crimson_trapdoor","minecraft:dark_oak_trapdoor","minecraft:jungle_trapdoor","minecraft:mangrove_trapdoor","minecraft:spruce_trapdoor","minecraft:trapdoor","minecraft:warped_trapdoor"]),M=new v(["minecraft:copper_trapdoor","minecraft:exposed_copper_trapdoor","minecraft:weathered_copper_trapdoor","minecraft:oxidized_copper_trapdoor","minecraft:waxed_copper_trapdoor","minecraft:waxed_exposed_copper_trapdoor","minecraft:waxed_weathered_copper_trapdoor","minecraft:waxed_oxidized_copper_trapdoor"]),k=new v([...A,...M,"minecraft:iron_trapdoor"]);function R(t){return t>1?t*R(t-1):1}function E(t,e,r){return s=>t**(r-s)*e**s*function(t,e){return R(t)/(R(e)*R(t-e))}(r,s)}function D(t,e,r=1){const s=[];for(let n=t;n<e;n+=r)s.push(n);return s}new v(["minecraft:acacia_log","minecraft:birch_log","minecraft:cherry_log","minecraft:dark_oak_log","minecraft:jungle_log","minecraft:mangrove_log","minecraft:oak_log","minecraft:spruce_log "]),new v(["minecraft:crimson_stem","minecraft:warped_stem"]),new v(["minecraft:coal_ore","minecraft:copper_ore","minecraft:deepslate_coal_ore","minecraft:deepslate_copper_ore","minecraft:deepslate_diamond_ore","minecraft:deepslate_emerald_ore","minecraft:deepslate_gold_ore","minecraft:deepslate_iron_ore","minecraft:deepslate_lapis_ore","minecraft:deepslate_redstone_ore","minecraft:diamond_ore","minecraft:emerald_ore","minecraft:gold_ore","minecraft:iron_ore","minecraft:lapis_ore","minecraft:nether_gold_ore","minecraft:quartz_ore","minecraft:redstone_ore"]),new v(["minecraft:stone","minecraft:deepslate"]);class T{constructor(...t){this.axes=t}static create(t){return Array.isArray(t)?new this(...t):"string"==typeof t?this.parse(t):void 0}static parse(t){return this.create(t.split(" ").map(Number))}stringify(){return this[Symbol.toPrimitive]("string")}toArray(){return[...this]}[Symbol.toPrimitive](t){return"string"===t?this.axes.join(" "):this}[Symbol.iterator](){return this.axes[Symbol.iterator]()}get dimensions(){return this.axes.length}get(t){return this.axes[t]}set(t,e){this.axes[t]=e}map(t){return T.create(this.axes.map(t))}}class B{static create(t){return T.create(t)}static clone(t){return this.create(t.toArray())}static _assertDimensions(t,e){if(t.dimensions!==e.dimensions)throw new Error("Vectors must have the same dimensions.")}static add(t,e){return B._assertDimensions(t,e),t.map(((t,r)=>t+e.get(r)))}static subtract(t,e){return B._assertDimensions(t,e),t.map(((t,r)=>t-e.get(r)))}static multiply(t,e){return B._assertDimensions(t,e),t.map(((t,r)=>t*e.get(r)))}static divide(t,e){return B._assertDimensions(t,e),t.map(((t,r)=>t/e.get(r)))}static scale(t,e){return t.map((t=>t*e))}static negate(t){return t.map((t=>-t))}static inverse(t){return t.map((t=>1/t))}static exchange(t,e,r){const s=this.clone(t),n=s.get(e),i=s.get(r);return s.set(e,i),s.set(r,n),s}static exactEquals(t,e){return B._assertDimensions(t,e),t.axes.every(((t,r)=>t===e.get(r)))}static equals(t,e){return B._assertDimensions(t,e),t.axes.every(((t,r)=>function(t,e,r=1e-6){return Math.abs(t-e)<=r*Math.max(1,Math.abs(t),Math.abs(e))}(t,e.get(r))))}static max(...t){const e=t[0].dimensions,r=t.reduce(((t,e)=>(e.axes.forEach(((e,r)=>{e>t[r]&&(t[r]=e)})),t)),new Array(e).fill(Number.NEGATIVE_INFINITY));return this.create(r)}static min(...t){const e=t[0].dimensions,r=t.reduce(((t,e)=>(e.axes.forEach(((e,r)=>{e<t[r]&&(t[r]=e)})),t)),new Array(e).fill(Number.POSITIVE_INFINITY));return this.create(r)}static floor(t){return t.map((t=>Math.floor(t)))}static ceil(t){return t.map((t=>Math.ceil(t)))}static round(t){return t.map((t=>{return(e=t)>=0?Math.round(e):e%.5==0?Math.floor(e):Math.round(e);var e}))}static abs(t){return t.map((t=>Math.abs(t)))}static maxMagnitude(...t){return t.reduce(((t,e)=>B.magnitude(e)>B.magnitude(t)?e:t))}static minMagnitude(...t){return t.reduce(((t,e)=>B.magnitude(e)<B.magnitude(t)?e:t))}static magnitude(t){return Math.sqrt(B.squaredMagnitude(t))}static squaredMagnitude(t){return t.axes.reduce(((t,e)=>t+e**2),0)}static distance(t,e){return Math.sqrt(B.squaredDistance(t,e))}static squaredDistance(t,e){return B._assertDimensions(t,e),t.axes.reduce(((t,r,s)=>t+(r-e.get(s))**2),0)}static dot(t,e){return B._assertDimensions(t,e),t.axes.reduce(((t,r,s)=>t+r*e.get(s)),0)}static normalize(t){const e=this.magnitude(t);return e?this.scale(t,1/e):this.create(new Array(t.dimensions).fill(0))}static angle(t,e){const r=this.dot(this.normalize(t),this.normalize(e));return Math.acos(r)}static random(t,e=1){const r=Array.from({length:t},(()=>2*Math.random()-1));return this.scale(this.create(r),e)}static lerp(t,e,r){return B._assertDimensions(t,e),t.map(((t,s)=>t*(1-r)+e.get(s)*r))}static slerp(t,e,r){if(r<=0)return this.clone(t);if(r>=1)return this.clone(e);const s=this.angle(t,e),n=Math.sin(s);if(n<=Number.EPSILON)return this.lerp(t,e,r);const i=Math.sin(s*(1-r))/n,a=Math.sin(s*r)/n;return t.map(((t,r)=>t*i+e.get(r)*a))}static bezier(t,e){const r=t.length-1;if(!r)return t[0];const s=[];for(let n=0;n<r;n++)s.push(this.lerp(t[n],t[n+1],e));return this.bezier(s,e)}}class N extends B{static create(t){return O.create(t)}static cross(t,e){return this.create([t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x])}}class O extends T{constructor(t=0,e=0,r=0){super(t,e,r)}get x(){return this.get(0)}set x(t){this.set(0,t)}get y(){return this.get(1)}set y(t){this.set(1,t)}get z(){return this.get(2)}set z(t){this.set(2,t)}static create(t){return Array.isArray(t)?new this(...t):"string"==typeof t?this.parse(t):"object"==typeof t?new this(t.x,t.y,t.z):void 0}get magnitude(){return N.magnitude(this)}get squaredMagnitude(){return N.squaredMagnitude(this)}get normalized(){return N.normalize(this)}get floored(){return N.floor(this)}get ceiled(){return N.ceil(this)}get rounded(){return N.round(this)}get absoluted(){return N.abs(this)}map(t){return O.create(this.axes.map(t))}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new O(this.x,this.y,this.z)}equals(t){return N.equals(this,t)}distanceTo(t){return N.distance(this,t)}squaredDistanceTo(t){return N.squaredDistance(this,t)}add(t){return this.copy(N.add(this,t))}subtract(t){return this.copy(N.subtract(this,t))}multiply(t){return this.copy(N.multiply(this,t))}divide(t){return this.copy(N.divide(this,t))}scale(t){return this.copy(N.scale(this,t))}negate(){return this.copy(N.negate(this))}inverse(){return this.copy(N.inverse(this))}floor(){return this.copy(this.floored)}ceil(){return this.copy(this.ceiled)}round(){return this.copy(this.rounded)}abs(){return this.copy(this.absoluted)}normalize(){return this.copy(this.normalized)}}class $ extends O{get centerCorrected(){return $.create(N.add(this.floored,new O(.5,.5,.5)))}clone(){return new $(this.x,this.y,this.z)}equals(t){return N.exactEquals(this,t)}isNearTo(t,e){return this.distanceTo(t)<=e}offset(t){return this.add(t)}}class z{static getDirectionOffset(t){return $.create({x:t.isEast()?1:t.isWest()?-1:0,y:t.isUp()?1:t.isDown()?-1:0,z:t.isSouth()?1:t.isNorth()?-1:0})}static between(t,e,r=1){const s=[];for(let n=t.x;n<=e.x;n+=r)for(let i=t.y;i<=e.y;i+=r)for(let a=t.z;a<=e.z;a+=r)s.push(new $(n,i,a));return s}}class C extends ${constructor(t,e,r){super(t,e,r),this.floor()}get centerCorrected(){throw new Error('Couldn\'t get "centerCorrected" on BlockLocation.')}clone(){return new C(this.x,this.y,this.z)}divide(t){return super.divide(t),this.floor()}inverse(){throw new Error('Couldn\'t call "inverse" on BlockLocation.')}between(t){return z.between(this,t)}}function P(e){return new Promise(((r,s)=>{t.run((()=>{try{r(e())}catch(t){s(t)}}))}))}function j(t){return t.replace(/^minecraft\:/,"")}class V{constructor(t){this.code=t}get name(){switch(this.code){case 0:return"East";case 1:return"South";case 2:return"Up";case 3:return"West";case 4:return"North";case 5:return"Down"}}isEast(){return 0===this.code}isSouth(){return 1===this.code}isUp(){return 2===this.code}isWest(){return 3===this.code}isNorth(){return 4===this.code}isDown(){return 5===this.code}equals(t){return this.code===t.code}getOpposite(){const t=this.code+3;return new V(t>=6?t-6:t)}isOppositeTo(t){return 3===Math.abs(this.code-t.code)}}class F{static East=new V(0);static South=new V(1);static Up=new V(2);static West=new V(3);static North=new V(4);static Down=new V(5)}class L{static wrap(...t){return new this(...t)}static tryWrap(...t){try{return new this(...t)}catch(t){}}static match(){throw new Error("Not implemented.")}static assert(){throw new Error("Not implemented.")}}const U=new v(["minecraft:diamond_pickaxe","minecraft:netherite_pickaxe"]),W=new v([...U,"minecraft:iron_pickaxe"]),q=new v([...W,"minecraft:stone_pickaxe"]),H=new v([...q,"minecraft:golden_pickaxe","minecraft:wooden_pickaxe"]);class K extends L{constructor(t){super(),this._item=t,this.type=t.type,this.typeId=t.typeId;g(t.getComponents(),(t=>{this.components.set(j(t.typeId),t)}))}components=new Map;hasComponent(t){return this._item.hasComponent(t)}get enchants(){return this.components.get("enchantable")}}var G={acacia_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:acacia_log"}}]},amethyst_block:{drops:[{dig_by:H.toArray(),raw:{item_id:"minecraft:amethyst_block"}}]},amethyst_cluster:{drops:[{dig_by:H.toArray(),raw:{item_id:"minecraft:amethyst_shard",default_range:[4,4]},fortune_rule:"ore"},{dig_by:"<default>",raw:{item_id:"minecraft:amethyst_shard",default_range:[2,2]}}]},ancient_debris:{drops:[{dig_by:U.toArray(),raw:{item_id:"minecraft:ancient_debris"},refined:{item_id:"minecraft:netherite_scrap"}}]},birch_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:birch_log"}}]},cherry_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:cherry_log"}}]},coal_ore:{drops:[{dig_by:H.toArray(),raw:{item_id:"minecraft:coal",xp_range:[0,2]},fortune_rule:"ore"}]},copper_ore:{drops:[{dig_by:q.toArray(),raw:{item_id:"minecraft:raw_copper",default_range:[2,5]},refined:{item_id:"minecraft:copper_ingot"},fortune_rule:"ore"}]},crimson_stem:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:crimson_stem"}}]},dark_oak_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:dark_oak_log"}}]},deepslate:{drops:[{dig_by:H.toArray(),raw:{item_id:"minecraft:cobbled_deepslate"}}]},deepslate_coal_ore:{drops:[{dig_by:H.toArray(),raw:{item_id:"minecraft:coal",xp_range:[0,2]},fortune_rule:"ore"}]},deepslate_copper_ore:{drops:[{dig_by:q.toArray(),raw:{item_id:"minecraft:raw_copper",default_range:[2,5]},refined:{item_id:"minecraft:copper_ingot"},fortune_rule:"ore"}]},deepslate_diamond_ore:{drops:[{dig_by:W.toArray(),raw:{item_id:"minecraft:diamond",xp_range:[3,7]},fortune_rule:"ore"}]},deepslate_emerald_ore:{drops:[{dig_by:W.toArray(),raw:{item_id:"minecraft:emerald",xp_range:[3,7]},fortune_rule:"ore"}]},deepslate_gold_ore:{drops:[{dig_by:W.toArray(),raw:{item_id:"minecraft:raw_gold"},refined:{item_id:"minecraft:gold_ingot"},fortune_rule:"ore"}]},deepslate_iron_ore:{drops:[{dig_by:q.toArray(),raw:{item_id:"minecraft:raw_iron"},refined:{item_id:"minecraft:iron_ingot"},fortune_rule:"ore"}]},deepslate_lapis_ore:{drops:[{dig_by:q.toArray(),raw:{item_id:"minecraft:lapis_lazuli",default_range:[4,9],xp_range:[2,5]},fortune_rule:"ore"}]},deepslate_redstone_ore:{drops:[{dig_by:W.toArray(),raw:{item_id:"minecraft:redstone",default_range:[4,5],xp_range:[1,5]},fortune_rule:"melon"}]},diamond_ore:{drops:[{dig_by:W.toArray(),raw:{item_id:"minecraft:diamond",xp_range:[3,7]},fortune_rule:"ore"}]},emerald_ore:{drops:[{dig_by:W.toArray(),raw:{item_id:"minecraft:emerald",xp_range:[3,7]},fortune_rule:"ore"}]},gold_ore:{drops:[{dig_by:W.toArray(),raw:{item_id:"minecraft:raw_gold"},refined:{item_id:"minecraft:gold_ingot"},fortune_rule:"ore"}]},iron_ore:{drops:[{dig_by:q.toArray(),raw:{item_id:"minecraft:raw_iron"},refined:{item_id:"minecraft:iron_ingot"},fortune_rule:"ore"}]},jungle_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:jungle_log"}}]},lapis_ore:{drops:[{dig_by:q.toArray(),raw:{item_id:"minecraft:lapis_lazuli",default_range:[4,9],xp_range:[2,5]},fortune_rule:"ore"}]},mangrove_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:mangrove_log"}}]},nether_gold_ore:{drops:[{dig_by:H.toArray(),raw:{item_id:"minecraft:gold_nugget",default_range:[2,6],xp_range:[0,1]},refined:{item_id:"minecraft:gold_ingot"},fortune_rule:"ore"}]},oak_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:oak_log"}}]},obsidian:{drops:[{dig_by:U.toArray(),raw:{item_id:"minecraft:obsidian"}}]},quartz_ore:{drops:[{dig_by:H.toArray(),raw:{item_id:"minecraft:quartz",xp_range:[2,5]},fortune_rule:"ore"}]},redstone_ore:{drops:[{dig_by:W.toArray(),raw:{item_id:"minecraft:redstone",default_range:[4,5],xp_range:[1,5]},fortune_rule:"melon"}]},spruce_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:spruce_log"}}]},stone:{drops:[{dig_by:H.toArray(),raw:{item_id:"minecraft:cobblestone"},refined:{item_id:"minecraft:smooth_stone"}}]},warped_stem:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:warped_stem"}}]}};class X{constructor(t,e,r=1){this.min=t,this.max=e,this.step=r}toArray(){return D(this.min,this.max+this.step,this.step)}get array(){return this.toArray()}includes(t){return this.array.includes(t)}[Symbol.iterator](){return this.array.values()}}class J{constructor(t){t&&g(t,(t=>{"number"==typeof t?this.addItem({weight:1,value:t}):this.addItem(t)}))}table=new Set;totalWeight=0;addItem(t){this.table.add(t),this.totalWeight+=t.weight}getResult(){let t=0;for(const{weight:r,value:s}of this.table){if(e=r/(this.totalWeight-t),Math.random()<=e)return s;t+=r}var e}[Symbol.iterator](){return this.table[Symbol.iterator]()}}class Y{constructor({item_id:t,default_range:e=[1,1],max_amount:r=Number.POSITIVE_INFINITY,xp_range:s=[0,0],damage:n=1}={}){this.itemId=t,this.range=new X(...e),this.amountLootTable=new J(this.range.toArray()),this.maxAmount=r,this.xpRange=new X(...s),this.damage=n}getResult(){return[{itemId:this.itemId,amount:Math.min(this.amountLootTable.getResult(),this.maxAmount),xp:new J(this.xpRange.toArray()).getResult(),damage:this.damage}]}}class Z{constructor(t){this.items=t.map((t=>new Y(t)))}getResult(){const t=[];return g(this.items,(e=>t.push(...e.getResult()))),t}}const Q="ore",tt="melon",et="grass",rt="flower",st="crop",nt="custom";class it{constructor(t,e){const r=j(t),s=G[r]?.drops;if(!s)throw new Error(`Block ${r} has not been supported.`);this.blockTypeId=t,this.drops=s,e&&this.setItemUse(e)}setItemUse(t="<empty>"){const e=this.drops.find((e=>{const r=e.dig_by;return Array.isArray(r)?r.includes(t):"string"==typeof r?r===t:void 0}))??this.drops.find((t=>"<default>"===t.dig_by));if(!e)return!1;if(this.blockItem=new Y({item_id:r.resolve(this.blockTypeId).getItemStack()?.typeId}),this.rawResource=new Y(e.raw)??this.blockItem,this.refinedResource=new Y(e.refined),this.seendResource=new Y(e.seed)??this.rawResource,this.immatureResource=new Y(e.immature)??this.seendResource,this.fortuneRule=e.fortune_rule,this.fortuneRule===nt&&(this.custumLootTable=e.option?.custom,!this.custumLootTable))throw new Error("You must provide a custom loot table for the custom fortune rule.");return!0}getDrops({withFortune:t=0,withSilkTouch:e=!1,immature:r=!1}={}){if(t&&e)throw new Error("Could not call with both fortune and silk_touch.");if(r)return this.immatureResource.getResult();if(e)return this.blockItem.getResult();if(0===t||!this.fortuneRule)return this.rawResource.getResult();{const e=t;switch(this.fortuneRule){case Q:{const t=this.rawResource.getResult()[0],r=new J([...D(2,e+2),{weight:2,value:1}]);return t.amount*=r.getResult(),[t]}case tt:{const t=this.rawResource.getResult()[0],r=new J([...this.rawResource.amountLootTable,...D(1,e+1).map((t=>({weight:1,value:Math.min(this.rawResource.maxAmount,this.rawResource.range.max+t)})))]);return t.amount=r.getResult(),[t]}case et:{const t=this.rawResource.getResult()[0];if(0===t.amount)return[t];const r=new J(D(1,2*e+2));return t.amount=r.getResult(),[t]}case rt:{const t=this.rawResource.getResult()[0],r=new J(D(1,2*e+2));return t.amount=r.getResult(),[t]}case st:{const t=this.rawResource.getResult()[0],r=E(1-(s=4/7),s,e+3),n=new J(D(0,e+4).map((t=>({weight:r(t),value:t}))));return[t,{itemId:this.seendResource.itemId,amount:n.getResult()}]}case nt:{const t=new J(this.custumLootTable[e]);return new Z(t.getResult()).getResult()}}}var s}}class at extends L{constructor(t){super(),this._block=t,this.type=t.type,this.typeId=t.typeId,this.location=C.create(t.location),this.dimension=t.dimension,this.permutation=t.permutation}getOffsetBlock(t){const e=this.location.clone().offset(t);return new at(this.dimension.getBlock(e))}getNeighbourBlock(t){const e=z.getDirectionOffset(t);return this.getOffsetBlock(e)}getState(t){return this.permutation.getState(t)}hasState(t){return!!this.getState(t)}setState(t,e){const s=this.permutation.getAllStates();s[t]=e,this._block.setPermutation(r.resolve(this.typeId,s))}canBeDugBy(t="<empty>"){return new it(this.typeId).setItemUse(t)}destroy(){this.dimension.fillBlocks(new s(this.location,this.location),r.resolve("minecraft:air"))}breakBy(t){const e=new it(this.typeId,t?.typeId??"<empty>");this.destroy();const r=(()=>{if(t){const r=t instanceof K?t:new K(t);return e.getDrops({withFortune:r.enchants.hasEnchantment("fortune")?r.enchants.getEnchantment("fortune").level:0,withSilkTouch:r.enchants.hasEnchantment("silk_touch")})}return e.getDrops()})();return{drops:r,spawnDrops:()=>{g(r,(t=>{for(this.dimension.spawnItem(new n(t.itemId,t.amount),this.location);t.xp--;)this.dimension.spawnEntity("minecraft:xp_orb",this.location)}))},getTotalDamage:()=>{let t=0;return g(r,(e=>{e.damage&&(t+=e.damage)})),t}}}}class ot extends L{constructor(t){super(),this._blocks=(Array.isArray(t)?t:[t]).map((t=>t instanceof at?t:new at(t)))}get _block(){return this._blocks[0]}get type(){return this._block.type}get typeId(){return this._block.typeId}get location(){return this._block.location}get dimension(){return this._block.dimension}get permutation(){return this._block.permutation}}class ct extends ot{constructor(t){ct.assert(t);const e=t instanceof at?t:new at(t),r=e.getState("upper_block_bit");super([r?e.getNeighbourBlock(F.Down):e,r?e:e.getNeighbourBlock(F.Up)])}static match(t){return S.has(t?.typeId)}static assert(t){if(ct.match(t))return!0;throw new TypeError(`The "${t.typeId}" is not a door.`)}get _lower(){return this._blocks[0]}get _upper(){return this._blocks[1]}get opened(){return this._lower.getState("open_bit")}get facingDirection(){switch(this._lower.getState("direction")){case 0:return F.East;case 1:return F.South;case 2:return F.West;case 3:return F.North;default:throw new Error("Unkonw error.")}}get hingeSide(){return this._upper.getState("door_hinge_bit")}isWooden(){return x.has(this.typeId)}isCopper(){return I.has(this.typeId)}isIron(){return!this.canBeOpenedByHand()}canBeOpenedByHand(){return this.isWooden()||this.isCopper()}open(){this._lower.setState("open_bit",!0)}close(){this._lower.setState("open_bit",!1)}getRelated({shouldBeTheSameType:t=!0}={}){const e=[this],r=this.facingDirection,s=this.hingeSide,n=C.create({x:Number(r.isSouth()?s||-1:r.isNorth()?!s||-1:0),y:0,z:Number(r.isEast()?!s||-1:r.isWest()?s||-1:0)}),i=this._lower.getOffsetBlock(n);if(ct.match(i)){const n=new ct(i);!n.canBeOpenedByHand()||t&&n.typeId!==this.typeId||n.facingDirection.code!==r.code||n.hingeSide!==!s||e.push(n)}return e}}class ht extends L{components=new Map;constructor(t){super(),this._entity=t,this.id=t.id,this.typeId=t.typeId,this.scoreboardIdentity=t.scoreboardIdentity;g(t.getComponents(),(t=>{this.components.set(j(t.typeId),t)}))}get nameTag(){return this._entity.nameTag}get location(){return $.create(this._entity.location)}get dimension(){return this._entity.dimension}get isSneaking(){return this._entity.isSneaking}getRotation(){return this._entity.getRotation()}getFacingDirectionXZ(){const t=this.getRotation().y;return t>-135&&t<=-45?F.East:t>-45&&t<=45?F.South:t>45&&t<=135?F.West:t>135||t<=-135?F.North:void 0}}const ut=e.getDimension(i.overworld),dt=new Set;class lt{static run(t,e=ut){if(e instanceof a||e instanceof o)return e.runCommand(t);throw new TypeError("Target must be Entity or Dimension.")}static async asyncRun(t,e=ut){if(!(e instanceof a||e instanceof o))throw new TypeError("Target must be Entity or Dimension.");{const r=[...dt].filter((({regex:e})=>e.test(t))).map((t=>t.runner));if(!r.length)return await e.runCommandAsync(t);await y(r,(async r=>await r(t,e)))}}static register(t,r,s){if(t.startsWith("/"))throw new Error("Unable to register slash commands.");const n=new RegExp(`^${t}${r}( |$)`),i=async(t,e)=>{const r=t.split(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g).filter((t=>t.trim().length>0));await s(r,e)};dt.add({regex:n,runner:i}),e.beforeEvents.chatSend.subscribe((t=>{n.test(t.message)&&(t.cancel=!0,i(t.message,t.sender).catch(f.error))}))}}class mt extends L{constructor(t){super(),this._container=t}get size(){return this._container.size}get emptySlotsCount(){return this._container.emptySlotsCount}getItem(t){return this._container.getItem(t)}setItem(t,e){return this._container.setItem(t,e)}tryAddItem(t){return this._container.addItem(t)}}class pt extends mt{constructor(t,e){super(e),this._entity=t}get location(){return this._entity.location}get dimension(){return this._entity.dimension}addItem(t){const e=this.tryAddItem(t);e&&this.dimension.spawnItem(e,this.location)}}class _t extends ht{constructor(t){super(t),this.name=t.name}static match(t){return"minecraft:player"===t.typeId}get _player(){return this._entity}get experience(){return this.addExperience(0)}get level(){return this._player.level}get inventory(){return new pt(this,this.components.get("inventory").container)}get selectedSlotIndex(){return this._player.selectedSlotIndex}getGameMode(){const t=[];return g(c,(e=>{this.testGameMode(e)&&t.push(e)})),t[0]}testGameMode(t){return this.dimension.getPlayers({gameMode:t}).some((t=>t.id===this.id))}setGameMode(t){if(!Object.values(c).includes(t))throw new TypeError("Unknown gamemode.");lt.run(`gamemode ${t}`,this._player)}getMainHandItem(){return this.inventory.getItem(this.selectedSlotIndex)}setMainHandItem(t){this.inventory.setItem(this.selectedSlotIndex,t)}async useItemFromInventory(t,e=(async t=>{})){let r=this.inventory.getItem(t);r=await e(r),this.inventory.setItem(t,r)}async useMainHandItem(t=(async()=>{})){await this.useItemFromInventory(this.selectedSlotIndex,t)}addExperience(t=0,{useXpOrb:e=!1}={}){if(e&&t>=0){for(;t--;)this.dimension.spawnEntity("minecraft:xp_orb",this.location);return this.experience}return this._player.addExperience(t)}addLevels(t=0){return this._player.addLevels(t)}}class ft extends at{constructor(t){ft.assert(t),super(t)}static match(t){return k.has(t?.typeId)}static assert(t){if(ft.match(t))return!0;throw new TypeError(`The "${t.typeId}" is not a trapdoor.`)}get opened(){return this.getState("open_bit")}get facingDirection(){switch(this.getState("direction")){case 0:return F.East;case 2:return F.South;case 1:return F.West;case 3:return F.North;default:throw new Error("Unkonw error.")}}get upsideOrDown(){return this.getState("upside_down_bit")}isWooden(){return A.has(this.typeId)}isCopper(){return M.has(this.typeId)}isIron(){return!this.canBeOpenedByHand()}canBeOpenedByHand(){return this.isWooden()||this.isCopper()}open(){this.setState("open_bit",!0)}close(){this.setState("open_bit",!1)}getRelated(t,{extensive:e=!0,maxLength:r=1,shouldBeTheSameType:s=!0}={}){const n=[this];if(r>0){const t=this.getNeighbourBlock(this.facingDirection);if(ft.match(t)){const e=new ft(t._block);!e.canBeOpenedByHand()||s&&e.typeId!==this.typeId||!e.facingDirection.isOppositeTo(this.facingDirection)||e.upsideOrDown!==this.upsideOrDown||n.push(e)}}if(e){let e=this,i=!1;for(;--r;){const a=_t.wrap(t).getFacingDirectionXZ(),o=i?e.getNeighbourBlock(a.getOpposite()):e.getNeighbourBlock(a);if(ft.match(o)){const i=new ft(o._block);if(i.canBeOpenedByHand()&&(!s||i.typeId===this.typeId)&&i.facingDirection.equals(this.facingDirection)&&i.upsideOrDown===this.upsideOrDown){const s=i.getRelated(t,{extensive:!1,maxLength:r});if(s.length>1){n.push(...s),e=i;continue}}}if(i)break;i=!0,e=this,r++}}return n}}class gt{static async confirm({title:t="确认",body:e,target:r,onCancel:s=(async()=>{}),onConfirm:n=(async()=>{})}){if(!e||!r)throw new Error;const i=await P((()=>new gt({dialog:(new h).title(t).body(e).button1("CANCEL").button2("OK"),onClose:s,onSelectButton1:s,onSelectButton2:n})));return await i.show(r)}constructor({dialog:t,onClose:e=(async()=>{}),onSubmit:r=(async t=>{}),onSelectButton1:s=(async()=>{}),onSelectButton2:n=(async()=>{}),onSelect:i=(async t=>{})}){this.dialog=t,this.onSubmit=r,this.onSelectButton1=s,this.onSelectButton2=n,this.onSelect=i,this.onClose=e}async show(t){let e;t.sendMessage("[!] 新对话框已发送，请关闭命令输入栏或其他对话框");do{e=await this.dialog.show(t)}while(e.cancelationReason===u.UserBusy);if(e.canceled&&e.cancelationReason===u.UserClosed)return await this.onClose();if(e instanceof d)return await this.onSubmit(e.formValues);if(e instanceof l){if(0===e.selection)return await this.onSelectButton1();if(1===e.selection)return await this.onSelectButton2()}else if(e instanceof m)return await this.onSelect(e.selection);return e}}function yt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var wt,bt,vt={exports:{}},xt={exports:{}};wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bt={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&bt.rotl(t,8)|4278255360&bt.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=bt.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],r=0,s=0;r<t.length;r++,s+=8)e[s>>>5]|=t[r]<<24-s%32;return e},wordsToBytes:function(t){for(var e=[],r=0;r<32*t.length;r+=8)e.push(t[r>>>5]>>>24-r%32&255);return e},bytesToHex:function(t){for(var e=[],r=0;r<t.length;r++)e.push((t[r]>>>4).toString(16)),e.push((15&t[r]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(parseInt(t.substr(r,2),16));return e},bytesToBase64:function(t){for(var e=[],r=0;r<t.length;r+=3)for(var s=t[r]<<16|t[r+1]<<8|t[r+2],n=0;n<4;n++)8*r+6*n<=8*t.length?e.push(wt.charAt(s>>>6*(3-n)&63)):e.push("=");return e.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var e=[],r=0,s=0;r<t.length;s=++r%4)0!=s&&e.push((wt.indexOf(t.charAt(r-1))&Math.pow(2,-2*s+8)-1)<<2*s|wt.indexOf(t.charAt(r))>>>6-2*s);return e}},xt.exports=bt;var It=xt.exports,St={utf8:{stringToBytes:function(t){return St.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(St.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e},bytesToString:function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")}}},At=St,Mt=function(t){return null!=t&&(kt(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&kt(t.slice(0,0))}(t)||!!t._isBuffer)};function kt(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}!function(){var t=It,e=At.utf8,r=Mt,s=At.bin,n=function(i,a){i.constructor==String?i=a&&"binary"===a.encoding?s.stringToBytes(i):e.stringToBytes(i):r(i)?i=Array.prototype.slice.call(i,0):Array.isArray(i)||i.constructor===Uint8Array||(i=i.toString());for(var o=t.bytesToWords(i),c=8*i.length,h=1732584193,u=-271733879,d=-1732584194,l=271733878,m=0;m<o.length;m++)o[m]=16711935&(o[m]<<8|o[m]>>>24)|4278255360&(o[m]<<24|o[m]>>>8);o[c>>>5]|=128<<c%32,o[14+(c+64>>>9<<4)]=c;var p=n._ff,_=n._gg,f=n._hh,g=n._ii;for(m=0;m<o.length;m+=16){var y=h,w=u,b=d,v=l;h=p(h,u,d,l,o[m+0],7,-680876936),l=p(l,h,u,d,o[m+1],12,-389564586),d=p(d,l,h,u,o[m+2],17,606105819),u=p(u,d,l,h,o[m+3],22,-1044525330),h=p(h,u,d,l,o[m+4],7,-176418897),l=p(l,h,u,d,o[m+5],12,1200080426),d=p(d,l,h,u,o[m+6],17,-1473231341),u=p(u,d,l,h,o[m+7],22,-45705983),h=p(h,u,d,l,o[m+8],7,1770035416),l=p(l,h,u,d,o[m+9],12,-1958414417),d=p(d,l,h,u,o[m+10],17,-42063),u=p(u,d,l,h,o[m+11],22,-1990404162),h=p(h,u,d,l,o[m+12],7,1804603682),l=p(l,h,u,d,o[m+13],12,-40341101),d=p(d,l,h,u,o[m+14],17,-1502002290),h=_(h,u=p(u,d,l,h,o[m+15],22,1236535329),d,l,o[m+1],5,-165796510),l=_(l,h,u,d,o[m+6],9,-1069501632),d=_(d,l,h,u,o[m+11],14,643717713),u=_(u,d,l,h,o[m+0],20,-373897302),h=_(h,u,d,l,o[m+5],5,-701558691),l=_(l,h,u,d,o[m+10],9,38016083),d=_(d,l,h,u,o[m+15],14,-660478335),u=_(u,d,l,h,o[m+4],20,-405537848),h=_(h,u,d,l,o[m+9],5,568446438),l=_(l,h,u,d,o[m+14],9,-1019803690),d=_(d,l,h,u,o[m+3],14,-187363961),u=_(u,d,l,h,o[m+8],20,1163531501),h=_(h,u,d,l,o[m+13],5,-1444681467),l=_(l,h,u,d,o[m+2],9,-51403784),d=_(d,l,h,u,o[m+7],14,1735328473),h=f(h,u=_(u,d,l,h,o[m+12],20,-1926607734),d,l,o[m+5],4,-378558),l=f(l,h,u,d,o[m+8],11,-2022574463),d=f(d,l,h,u,o[m+11],16,1839030562),u=f(u,d,l,h,o[m+14],23,-35309556),h=f(h,u,d,l,o[m+1],4,-1530992060),l=f(l,h,u,d,o[m+4],11,1272893353),d=f(d,l,h,u,o[m+7],16,-155497632),u=f(u,d,l,h,o[m+10],23,-1094730640),h=f(h,u,d,l,o[m+13],4,681279174),l=f(l,h,u,d,o[m+0],11,-358537222),d=f(d,l,h,u,o[m+3],16,-722521979),u=f(u,d,l,h,o[m+6],23,76029189),h=f(h,u,d,l,o[m+9],4,-640364487),l=f(l,h,u,d,o[m+12],11,-421815835),d=f(d,l,h,u,o[m+15],16,530742520),h=g(h,u=f(u,d,l,h,o[m+2],23,-995338651),d,l,o[m+0],6,-198630844),l=g(l,h,u,d,o[m+7],10,1126891415),d=g(d,l,h,u,o[m+14],15,-1416354905),u=g(u,d,l,h,o[m+5],21,-57434055),h=g(h,u,d,l,o[m+12],6,1700485571),l=g(l,h,u,d,o[m+3],10,-1894986606),d=g(d,l,h,u,o[m+10],15,-1051523),u=g(u,d,l,h,o[m+1],21,-2054922799),h=g(h,u,d,l,o[m+8],6,1873313359),l=g(l,h,u,d,o[m+15],10,-30611744),d=g(d,l,h,u,o[m+6],15,-1560198380),u=g(u,d,l,h,o[m+13],21,1309151649),h=g(h,u,d,l,o[m+4],6,-145523070),l=g(l,h,u,d,o[m+11],10,-1120210379),d=g(d,l,h,u,o[m+2],15,718787259),u=g(u,d,l,h,o[m+9],21,-343485551),h=h+y>>>0,u=u+w>>>0,d=d+b>>>0,l=l+v>>>0}return t.endian([h,u,d,l])};n._ff=function(t,e,r,s,n,i,a){var o=t+(e&r|~e&s)+(n>>>0)+a;return(o<<i|o>>>32-i)+e},n._gg=function(t,e,r,s,n,i,a){var o=t+(e&s|r&~s)+(n>>>0)+a;return(o<<i|o>>>32-i)+e},n._hh=function(t,e,r,s,n,i,a){var o=t+(e^r^s)+(n>>>0)+a;return(o<<i|o>>>32-i)+e},n._ii=function(t,e,r,s,n,i,a){var o=t+(r^(e|~s))+(n>>>0)+a;return(o<<i|o>>>32-i)+e},n._blocksize=16,n._digestsize=16,vt.exports=function(e,r){if(null==e)throw new Error("Illegal argument "+e);var i=t.wordsToBytes(n(e,r));return r&&r.asBytes?i:r&&r.asString?s.bytesToString(i):t.bytesToHex(i)}}();var Rt=yt(vt.exports),Et=function(t){null==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,t.constructor==Array?this.init_by_array(t,t.length):this.init_seed(t)};Et.prototype.init_seed=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},Et.prototype.init_by_array=function(t,e){var r,s,n;for(this.init_seed(19650218),r=1,s=0,n=this.N>e?this.N:e;n;n--){var i=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1664525*((4294901760&i)>>>16)<<16)+1664525*(65535&i))+t[s]+s,this.mt[r]>>>=0,s++,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1),s>=e&&(s=0)}for(n=this.N-1;n;n--){i=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1566083941*((4294901760&i)>>>16)<<16)+1566083941*(65535&i))-r,this.mt[r]>>>=0,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1)}this.mt[0]=2147483648},Et.prototype.random_int=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;for(this.mti==this.N+1&&this.init_seed(5489),r=0;r<this.N-this.M;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+this.M]^t>>>1^e[1&t];for(;r<this.N-1;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},Et.prototype.random_int31=function(){return this.random_int()>>>1},Et.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},Et.prototype.random=function(){return this.random_int()*(1/4294967296)},Et.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},Et.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)};var Dt=new Et(Math.random()*Number.MAX_SAFE_INTEGER);var Tt=yt((function(t){var e=t.length;for(;e--;)t[e]=Math.floor(256*Dt.random());return t}));const Bt=function(){const t=(e=16,Tt(new Uint8Array(e)));var e;let r="";for(let e=0;e<16;++e)r+=t[e].toString(16);return r}(),Nt=new RegExp(`(\\\\)?"@__(F|R|D|M|S|A|U|I|B|L)-${Bt}-(\\d+)__@"`,"g"),Ot=/\{\s*\[native code\]\s*\}/g,$t=/function.*?\(/,zt=/.*?=>.*?/,Ct=/[<>\/\u2028\u2029]/g,Pt=["*","async"],jt={"<":"\\u003C",">":"\\u003E","/":"\\u002F","\u2028":"\\u2028","\u2029":"\\u2029"};function Vt(t){return jt[t]}function Ft(t,e){e||(e={}),"number"!=typeof e&&"string"!=typeof e||(e={space:e});const r=[],s=[],n=[],i=[],a=[],o=[],c=[],h=[];if(e.ignoreFunction&&"function"==typeof t&&(t=void 0),void 0===t)return String(t);let u;return u=e.isJSON&&!e.space?JSON.stringify(t):JSON.stringify(t,e.isJSON?null:function(t,u){if(e.ignoreFunction&&function(t){const e=[];for(const r in t)"function"==typeof t[r]&&e.push(r);for(let r=0;r<e.length;r++)delete t[e[r]]}(u),!u&&void 0!==u)return u;const d=this[t],l=typeof d;if("object"===l){if(d instanceof RegExp)return`@__R-${Bt}-${s.push(d)-1}__@`;if(d instanceof Date)return`@__D-${Bt}-${n.push(d)-1}__@`;if(d instanceof Map)return`@__M-${Bt}-${i.push(d)-1}__@`;if(d instanceof Set)return`@__S-${Bt}-${a.push(d)-1}__@`;if(Array.isArray(d)&&d.filter((()=>!0)).length!==d.length)return`@__A-${Bt}-${o.push(d)-1}__@`}return"function"===l?`@__F-${Bt}-${r.push(d)-1}__@`:"undefined"===l?`@__U-${Bt}-${c.push(d)-1}__@`:"number"!==l||Number.isNaN(d)||Number.isFinite(d)?u:`@__I-${Bt}-${h.push(d)-1}__@`},e.space),"string"!=typeof u?String(u):(!0!==e.unsafe&&(u=u.replace(Ct,Vt)),0===r.length&&0===s.length&&0===n.length&&0===i.length&&0===a.length&&0===o.length&&0===c.length&&0===h.length?u:u.replace(Nt,((t,c,u,d)=>{if(c)return t;if("D"===u)return`new Date("${n[d].toISOString()}")`;if("R"===u)return`new RegExp(${Ft(s[d].source)}, "${s[d].flags}")`;if("M"===u)return`new Map(${Ft(Array.from(i[d].entries()),e)})`;if("S"===u)return`new Set(${Ft(Array.from(a[d].values()),e)})`;if("A"===u)return`Array.prototype.slice.call(${Ft(Object.assign({length:o[d].length},o[d]),e)})`;if("U"===u)return"undefined";if("I"===u)return h[d];return function(t){const e=t.toString();if(Ot.test(e))throw new TypeError(`Serializing native function: ${t.name}`);if($t.test(e))return e;if(zt.test(e))return e;const r=e.indexOf("("),s=e.substr(0,r).trim().split(" ").filter((t=>t.length>0));return s.filter((t=>-1===Pt.indexOf(t))).length>0?`${s.indexOf("async")>-1?"async ":""}function${s.join("").indexOf("*")>-1?"*":""}${e.substr(r)}`:e}(r[d])})))}const Lt=new Map;class Ut{static open(t,e){return new Ut(t,e)}constructor(t,r){const s=Rt(`db:${r}_${t.id}`).slice(8,24);this.id=s,this.objective=function(t,r){const s=e.scoreboard.getObjective(t);if(!s&&!r)throw new Error(`Couldn't find objective "${t}".`);return s||e.scoreboard.addObjective(t,r)}(s,`db:${r}`),this._syncDataFromScoreboard(),Lt.set(s,this)}store=new Map;_syncDataFromScoreboard(){this.store.clear(),g(this.objective.getParticipants(),(t=>{const e=w(t.displayName),r=Object.keys(e)[0],s=e[r];this.store.set(r,{value:s,participant:t})}))}has(t){return this.store.has(t)}async delete(t){if(this.has(t)){const{participant:e}=this.store.get(t);return await P((()=>this.objective.removeParticipant(e))),this.store.delete(t),!0}return!1}async clear(){await y(this.store,(async([,{participant:t}])=>await P((()=>this.objective.removeParticipant(t))))),this.store.clear()}get(t){if(this.has(t))return this.store.get(t).value}async set(t,e){await this.delete(t);const r=Ft({[t]:e}).replaceAll('"',"'");if(r.length>32767)throw new RangeError("Database: Only accepts a string value less than 32767 characters.");await P((()=>this.objective.setScore(r,1))),this._syncDataFromScoreboard()}getAll(){const t={};for(const[e,r]of this)t[e]=r;return t}*entries(){for(const[t,{value:e}]of this.store.entries())yield[t,e]}*keys(){for(const t of this.store.keys())yield t}*values(){for(const{value:t}of this.store.values())yield t}[Symbol.iterator](){return this.entries()}}class Wt{constructor(){this._events={}}on(t,e){if(b(e)){const r=`${t}.async`;this._events[r]?this._events[r].push(e):this._events[r]=[e]}else this._events[t]?this._events[t].push(e):this._events[t]=[e];return this}once(t,e){if(b(e)){const r=`${t}.async`,s=async(...t)=>{await e(...t),this.removeListener(r,s)};this._events[r]?this._events[r].push(s):this._events[r]=[s]}else{const r=(...s)=>{e(...s),this.removeListener(t,r)};this._events[t]?this._events[t].push(r):this._events[t]=[r]}return this}removeListener(t,e){if(this._events[t]){const r=[];g(this._events[t],(t=>{t!==e&&r.push(t)})),this._events[t]=r}return this}async emit(t,...e){this._events[t]&&g(this._events[t],(t=>t(...e))),await this.asyncEmit(t,...e)}async asyncEmit(t,...e){const r=`${t}.async`;this._events[r]&&await y(this._events[r],(async t=>await t(...e)))}addListener(t,e){return this.on(t,e)}off(t,e){return this.removeListener(t,e)}}class qt{constructor({name:t,description:e,range:r=[0,1,1],defaultValue:s,events:n,reload:i,_player:a}){this.name=t,this.description=e,this.range=new X(...r),this.events=new Wt,this.reload=i,this._defaultValue=s,this._player=a,n&&g(n,((t,e)=>this.events.on(e,t))),void 0!==s&&this._includes(s)?this.selected=s:this.selected=this.range.min,this.events.emit("inited",this.selected,a),this.events.emit("changed",this.selected,void 0,a)}select(t){return!(this.selected===t||!this._includes(t))&&(this.original=this.selected,this.selected=t,this.events.emit("selected",this.selected,this.original,this._player),this.events.emit("changed",this.selected,this.original,this._player),!0)}_includes(t){return this.range.includes(t)}}class Ht{constructor({name:t,description:e,values:r=[],defaultValue:s,events:n,reload:i,_player:a}){this.name=t,this.description=e,this.values=new Map(r.map((t=>("object"!=typeof t[0]&&void 0!==t[0]||(t[0]=Ft(t[0])),!0!==t[0]||t[1]?!1!==t[0]||t[1]||(t[1]="关闭"):t[1]="开启",t)))),this.events=new Wt,this.reload=i,this._defaultValue=s,this._player=a,n&&g(n,((t,e)=>this.events.on(e,t))),void 0!==s&&this.hasVal(s)?this.selected=s:r[0]&&(this.selected=r[0][0]),this.events.emit("inited",this.selected,a),this.events.emit("changed",this.selected,void 0,a)}select(t){return!(this.selected===t||!this.hasVal(t))&&(this.original=this.selected,this.selected=t,this.events.emit("selected",this.selected,this.original,this._player),this.events.emit("changed",this.selected,this.original,this._player),!0)}hasVal(t){return this.values.has(t)||!this.values.size}}class Kt{constructor(t,e){this.name=e,this.db=Ut.open(t,`option-manager:${e}`),this.player=t}items={};addItem(t){return t.range?this.items[t.name]=new qt(t):t.values&&(this.items[t.name]=new Ht(t)),this}async _syncToDB(){const t=this.getItemValMap();await y(t,(async(t,e)=>{await this.db.set(e,t)})),await y(this.db,(async([t,e])=>{this.hasItem(t)||await this.db.delete(t)}))}async _syncFromDB(){g(this.db,(([t,e])=>this.setItemVal(t,e,void 0,{syncFromDB:!0}))),await this._syncToDB()}async init(){return this.addItem=void 0,await this._syncFromDB(),this.getItemValMap()}_getItem(t){return this.items[t]}hasItem(t){return!!this.items[t]}setItemVal(t,e,r=((t,e,r)=>{}),{syncFromDB:s=!1}={}){const n=this._getItem(t);if(n){n.select(e)&&(!s&&n.reload&&(this.reload=!0),r(n.selected,n.original,this.getItemValMap()))}return this}getItemVal(t){const e=this._getItem(t);if(e)return e.selected}getItemValMap(){const t={};return g(this.items,((e,r)=>{t[r]=this.getItemVal(r)})),t}async done(t){const e=async({reply:t=!0}={})=>{await this._syncToDB(),t&&this.player.sendMessage("设置选项修改成功")};this.reload?(this.reload=!1,await gt.confirm({body:'你选择的项目更改后需要刷新脚本，请手动运行 "/reload" 命令。\n\n您也可以取消您的更改',target:this.player,onConfirm:async()=>{await e({reply:!1})},onCancel:async()=>{await this._syncFromDB(),await this.showDialog(t)}})):await e()}async showDialog(t){const e=(new p).title(`${this.name} 选项`),r=[];g(this.items,(t=>{if(t instanceof Ht){const{name:s,description:n,values:i,selected:a}=t;if(2===i.size&&i.get(!0)&&i.get(!1)){const t=new Map;g(i,(([e])=>t.set(e,e))),r.push({name:s,valuesMap:t}),e.toggle(n,a)}else{const t=[...i],o=new Map;g(t,(([t],e)=>o.set(e,t))),r.push({name:s,valuesMap:o}),e.dropdown(n,t.map((t=>t[1])),t.map((t=>t[0])).findIndex((t=>t===a)))}}else if(t instanceof qt){const{name:s,description:n,range:i,selected:a}=t,o=new Map;g(i,(t=>o.set(t,t))),r.push({name:s,valuesMap:o}),e.slider(n,i.min,i.max,i.step,a)}}));const s=new gt({dialog:e,onClose:async()=>{t&&await t.show(this.player)},onSubmit:async e=>{g(e,((t,e)=>{const{name:s,valuesMap:n}=r[e],i=n.get(t);this.setItemVal(s,i)})),await this.done(t)}});await s.show(this.player)}}class Gt{constructor(t){this.name=t}players=new Map;_items=new Set;addItem(t){return this._items.add(t),this}applyPlayer(t){if(this.players.has(t))return this.players.get(t);const e=new Kt(t,this.name);return g(this._items,(r=>{r._player=t,e.addItem(r)})),this.players.set(t,e),e}async applyMainPlayer(){const t=await function(){const t=e.getAllPlayers();return t.length?Promise.resolve(t[0]):new Promise((t=>{const r=e.afterEvents.playerSpawn.subscribe((s=>{s.initialSpawn&&t(s.player),e.afterEvents.playerSpawn.unsubscribe(r)}))}))}();return this.applyPlayer(t)}async init(){const t=new Map;return await y(this.players,(async([e,r])=>{const s=await r.init();t.set(e,s)})),this.applyPlayer=void 0,t}getPlayer(t){return this.players.get(t)}}const Xt=new class{namespaces=new Map;registerNamesapace(t){const e=new Gt(t);return this.namespaces.set(t,e),e}getNamesapace(t){return this.namespaces.get(t)}async showDialog(t){const e=(new _).title("设置选项").body("选择要设置的模块："),r=[];g(this.namespaces,(([t])=>{r.push(t),e.button(t)}));const s=new gt({dialog:e,onSelect:async e=>{const n=r[e];await this.getNamesapace(n).getPlayer(t).showDialog(s)}});await s.show(t)}};lt.register("!","option",(async(t,e)=>{switch(t[1]){case"dialog":case"-d":case void 0:await P((()=>Xt.showDialog(e)));break;default:throw function(t,e){const r=new Error(t);return e.sendMessage(r.toString()),r}("未知的子命令",e)}}));const Jt=Xt.registerNamesapace("better-door").addItem({name:"door",description:"允许双开门",values:[[!0],[!1]],defaultValue:!0,events:{changed:(t,e)=>console.warn("better-door:door -> from",e,"to",t)}}).addItem({name:"trapdoor",description:"允许多开活板门",values:[[!0],[!1]],defaultValue:!1,events:{changed:(t,e)=>console.warn("better-door:trapdoor -> from",e,"to",t)}}).addItem({name:"max_trapdoor_length",description:"允许多开活板门的最大距离",range:[1,32],defaultValue:3,events:{changed:(t,e)=>console.warn("better-door:max_trapdoor_length -> from",e,"to",t)}}).addItem({name:"should_be_the_same_type",description:"是否需要是同种门",values:[[!0],[!1]],defaultValue:!0,events:{changed:(t,e)=>console.warn("better-door:should_be_the_same_type -> from",e,"to",t)}});Jt.applyMainPlayer().then((()=>g(e.getAllPlayers(),(t=>Jt.applyPlayer(t))))).then((()=>Jt.init())).then((()=>e.beforeEvents.itemUseOn.subscribe((t=>{const{block:e,source:r}=t,s=Jt.getPlayer(r),n=s.getItemVal("should_be_the_same_type");if(ct.match(e)&&s.getItemVal("door")){t.cancel=!0;const r=ct.wrap(e).getRelated({shouldBeTheSameType:n});P((()=>{r[0].opened?g(r,(t=>t.close())):g(r,(t=>t.open()))})).catch(f.error)}else if(ft.match(e)&&s.getItemVal("trapdoor")){t.cancel=!0;const i=s.getItemVal("max_trapdoor_length"),a=ft.wrap(e).getRelated(r,{maxLength:i,shouldBeTheSameType:n});P((()=>{a[0].opened?g(a,(t=>t.close())):g(a,(t=>t.open()))})).catch(f.error)}})))).catch(f.error);
