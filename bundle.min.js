/*!
 * my-mcbe-script-bundle.js v0.0.0 (https://github.com/PFiS1737/my-mcbe-script#readme)
 * Copyright 2022-2023 PFiS1737
 * Licensed under MIT
 * 
 * This file is automatically generated, please do not change it.
 */
import{world as t,MinecraftDimensionTypes as e,Dimension as r,Entity as n,system as i,BlockPermutation as s,ItemStack as a,GameMode as o,EntityDamageCause as c,DisplaySlotId as l,ObjectiveSortOrder as h}from"@minecraft/server";import{MessageFormData as d,FormCancelationReason as u,ModalFormResponse as m,MessageFormResponse as p,ActionFormResponse as g,ModalFormData as y,ActionFormData as f}from"@minecraft/server-ui";function _(t,e,r){if(Array.isArray(t))t.forEach(e,r);else if(t&&t[Symbol.iterator])for(let n of t)e.call(r,n,t);else"object"==typeof t&&_(Object.keys(t),((n,i)=>e.call(r,t[n],n,i,t)))}async function w(t,e,r){if(Array.isArray(t))for(let n=0;n<t.length;n++)await e.call(r,t[n],n,t);else if(t&&t[Symbol.iterator])for(let n of t)await e.call(r,n,t);else"object"==typeof t&&await w(Object.keys(t),(async(n,i)=>await e.call(r,t[n],n,i,t)))}function b(t){try{return JSON.parse(t)}catch(e){return function(t,e={}){return new Function(...Object.keys(e),`return ${t}`)(...Object.values(e))}(`(${t})`)}}const v=async function(){}.constructor;class x{static error(t){console.error(`${t}\n${t.stack}`)}}const k=t.getDimension(e.overworld),I=new Set;class S{static run(t,e=k){if(e instanceof r||e instanceof n)return e.runCommand(t);throw new TypeError("Target must be Entity or Dimension.")}static async asyncRun(t,e=k){if(!(e instanceof r||e instanceof n))throw new TypeError("Target must be Entity or Dimension.");{const r=[...I].filter((({regex:e})=>e.test(t))).map((t=>t.runner));if(!r.length)return await e.runCommandAsync(t);await w(r,(async r=>await r(t,e)))}}static register(e,r,n){if(e.startsWith("/"))throw new Error("Unable to register slash commands.");const i=new RegExp(`^${e}${r}( |$)`),s=async(t,e)=>{const r=t.split(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g).filter((t=>t.trim().length>0));await n(r,e)};I.add({regex:i,runner:s}),t.beforeEvents.chatSend.subscribe((t=>{i.test(t.message)&&(t.cancel=!0,s(t.message,t.sender).catch(x.error))}))}}function M(t){return new Promise(((e,r)=>{i.run((()=>{try{e(t())}catch(t){r(t)}}))}))}function A(t,e){const r=new Error(t);return e.sendMessage(r.toString()),r}function D(e,r){const n=t.scoreboard.getObjective(e);if(n||r)return n||t.scoreboard.addObjective(e,r);throw new Error(`Couldn't find objective "${e}".`)}function E(t){return t.replace(/^minecraft\:/,"")}class z{static async confirm({title:t="确认",body:e,target:r,onCancel:n=(async()=>{}),onConfirm:i=(async()=>{})}){if(!e||!r)throw new Error;const s=await M((()=>new z({dialog:(new d).title(t).body(e).button1("CANCEL").button2("OK"),onClose:n,onSelectButton1:n,onSelectButton2:i})));return await s.show(r)}constructor({dialog:t,onClose:e=(async()=>{}),onSubmit:r=(async()=>{}),onSelectButton1:n=(async()=>{}),onSelectButton2:i=(async()=>{}),onSelect:s=(async()=>{})}){this.dialog=t,this.onSubmit=r,this.onSelectButton1=n,this.onSelectButton2=i,this.onSelect=s,this.onClose=e}async show(t){let e;t.sendMessage("[!] 新对话框已发送，请关闭命令输入栏或其他对话框");do{e=await this.dialog.show(t)}while(e.cancelationReason===u.UserBusy);if(e.canceled&&e.cancelationReason===u.UserClosed)return await this.onClose();if(e instanceof m)return await this.onSubmit(e.formValues);if(e instanceof p){if(0===e.selection)return await this.onSelectButton1();if(1===e.selection)return await this.onSelectButton2()}else if(e instanceof g)return await this.onSelect(e.selection);return e}}var R=function(t){null==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,t.constructor==Array?this.init_by_array(t,t.length):this.init_seed(t)};R.prototype.init_seed=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},R.prototype.init_by_array=function(t,e){var r,n,i;for(this.init_seed(19650218),r=1,n=0,i=this.N>e?this.N:e;i;i--){var s=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1664525*((4294901760&s)>>>16)<<16)+1664525*(65535&s))+t[n]+n,this.mt[r]>>>=0,n++,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1),n>=e&&(n=0)}for(i=this.N-1;i;i--){s=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1566083941*((4294901760&s)>>>16)<<16)+1566083941*(65535&s))-r,this.mt[r]>>>=0,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1)}this.mt[0]=2147483648},R.prototype.random_int=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;for(this.mti==this.N+1&&this.init_seed(5489),r=0;r<this.N-this.M;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+this.M]^t>>>1^e[1&t];for(;r<this.N-1;r++)t=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},R.prototype.random_int31=function(){return this.random_int()>>>1},R.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},R.prototype.random=function(){return this.random_int()*(1/4294967296)},R.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},R.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)};var B=new R(Math.random()*Number.MAX_SAFE_INTEGER),T=function(t){var e=t.length;for(;e--;)t[e]=Math.floor(256*B.random());return t};var N=function(){for(var t=(n=16,T(new Uint8Array(n))),e="",r=0;r<16;++r)e+=t[r].toString(16);var n;return e}(),P=new RegExp('(\\\\)?"@__(F|R|D|M|S|A|U|I|B|L)-'+N+'-(\\d+)__@"',"g"),O=/\{\s*\[native code\]\s*\}/g,V=/function.*?\(/,$=/.*?=>.*?/,C=/[<>\/\u2028\u2029]/g,j=["*","async"],L={"<":"\\u003C",">":"\\u003E","/":"\\u002F","\u2028":"\\u2028","\u2029":"\\u2029"};function U(t){return L[t]}function F(t,e){e||(e={}),"number"!=typeof e&&"string"!=typeof e||(e={space:e});var r,n=[],i=[],s=[],a=[],o=[],c=[],l=[],h=[];return e.ignoreFunction&&"function"==typeof t&&(t=void 0),void 0===t?String(t):(r=e.isJSON&&!e.space?JSON.stringify(t):JSON.stringify(t,e.isJSON?null:function(t,r){if(e.ignoreFunction&&function(t){var e=[];for(var r in t)"function"==typeof t[r]&&e.push(r);for(var n=0;n<e.length;n++)delete t[e[n]]}(r),!r&&void 0!==r)return r;var d=this[t],u=typeof d;if("object"===u){if(d instanceof RegExp)return"@__R-"+N+"-"+(i.push(d)-1)+"__@";if(d instanceof Date)return"@__D-"+N+"-"+(s.push(d)-1)+"__@";if(d instanceof Map)return"@__M-"+N+"-"+(a.push(d)-1)+"__@";if(d instanceof Set)return"@__S-"+N+"-"+(o.push(d)-1)+"__@";if(d instanceof Array&&d.filter((function(){return!0})).length!==d.length)return"@__A-"+N+"-"+(c.push(d)-1)+"__@"}return"function"===u?"@__F-"+N+"-"+(n.push(d)-1)+"__@":"undefined"===u?"@__U-"+N+"-"+(l.push(d)-1)+"__@":"number"!==u||isNaN(d)||isFinite(d)?r:"@__I-"+N+"-"+(h.push(d)-1)+"__@"},e.space),"string"!=typeof r?String(r):(!0!==e.unsafe&&(r=r.replace(C,U)),0===n.length&&0===i.length&&0===s.length&&0===a.length&&0===o.length&&0===c.length&&0===l.length&&0===h.length?r:r.replace(P,(function(t,r,l,d){return r?t:"D"===l?'new Date("'+s[d].toISOString()+'")':"R"===l?"new RegExp("+F(i[d].source)+', "'+i[d].flags+'")':"M"===l?"new Map("+F(Array.from(a[d].entries()),e)+")":"S"===l?"new Set("+F(Array.from(o[d].values()),e)+")":"A"===l?"Array.prototype.slice.call("+F(Object.assign({length:c[d].length},c[d]),e)+")":"U"===l?"undefined":"I"===l?h[d]:function(t){var e=t.toString();if(O.test(e))throw new TypeError("Serializing native function: "+t.name);if(V.test(e))return e;if($.test(e))return e;var r=e.indexOf("("),n=e.substr(0,r).trim().split(" ").filter((function(t){return t.length>0}));return n.filter((function(t){return-1===j.indexOf(t)})).length>0?(n.indexOf("async")>-1?"async ":"")+"function"+(n.join("").indexOf("*")>-1?"*":"")+e.substr(r):e}(n[d])}))))}var q,W,K={exports:{}},H={exports:{}};q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&W.rotl(t,8)|4278255360&W.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=W.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],r=0,n=0;r<t.length;r++,n+=8)e[n>>>5]|=t[r]<<24-n%32;return e},wordsToBytes:function(t){for(var e=[],r=0;r<32*t.length;r+=8)e.push(t[r>>>5]>>>24-r%32&255);return e},bytesToHex:function(t){for(var e=[],r=0;r<t.length;r++)e.push((t[r]>>>4).toString(16)),e.push((15&t[r]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(parseInt(t.substr(r,2),16));return e},bytesToBase64:function(t){for(var e=[],r=0;r<t.length;r+=3)for(var n=t[r]<<16|t[r+1]<<8|t[r+2],i=0;i<4;i++)8*r+6*i<=8*t.length?e.push(q.charAt(n>>>6*(3-i)&63)):e.push("=");return e.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var e=[],r=0,n=0;r<t.length;n=++r%4)0!=n&&e.push((q.indexOf(t.charAt(r-1))&Math.pow(2,-2*n+8)-1)<<2*n|q.indexOf(t.charAt(r))>>>6-2*n);return e}},H.exports=W;var J={utf8:{stringToBytes:function(t){return J.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(J.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e},bytesToString:function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")}}},G=J,X=function(t){return null!=t&&(Z(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Z(t.slice(0,0))}(t)||!!t._isBuffer)};function Z(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}!function(){var t=H.exports,e=G.utf8,r=X,n=G.bin,i=function(s,a){s.constructor==String?s=a&&"binary"===a.encoding?n.stringToBytes(s):e.stringToBytes(s):r(s)?s=Array.prototype.slice.call(s,0):Array.isArray(s)||s.constructor===Uint8Array||(s=s.toString());for(var o=t.bytesToWords(s),c=8*s.length,l=1732584193,h=-271733879,d=-1732584194,u=271733878,m=0;m<o.length;m++)o[m]=16711935&(o[m]<<8|o[m]>>>24)|4278255360&(o[m]<<24|o[m]>>>8);o[c>>>5]|=128<<c%32,o[14+(c+64>>>9<<4)]=c;var p=i._ff,g=i._gg,y=i._hh,f=i._ii;for(m=0;m<o.length;m+=16){var _=l,w=h,b=d,v=u;l=p(l,h,d,u,o[m+0],7,-680876936),u=p(u,l,h,d,o[m+1],12,-389564586),d=p(d,u,l,h,o[m+2],17,606105819),h=p(h,d,u,l,o[m+3],22,-1044525330),l=p(l,h,d,u,o[m+4],7,-176418897),u=p(u,l,h,d,o[m+5],12,1200080426),d=p(d,u,l,h,o[m+6],17,-1473231341),h=p(h,d,u,l,o[m+7],22,-45705983),l=p(l,h,d,u,o[m+8],7,1770035416),u=p(u,l,h,d,o[m+9],12,-1958414417),d=p(d,u,l,h,o[m+10],17,-42063),h=p(h,d,u,l,o[m+11],22,-1990404162),l=p(l,h,d,u,o[m+12],7,1804603682),u=p(u,l,h,d,o[m+13],12,-40341101),d=p(d,u,l,h,o[m+14],17,-1502002290),l=g(l,h=p(h,d,u,l,o[m+15],22,1236535329),d,u,o[m+1],5,-165796510),u=g(u,l,h,d,o[m+6],9,-1069501632),d=g(d,u,l,h,o[m+11],14,643717713),h=g(h,d,u,l,o[m+0],20,-373897302),l=g(l,h,d,u,o[m+5],5,-701558691),u=g(u,l,h,d,o[m+10],9,38016083),d=g(d,u,l,h,o[m+15],14,-660478335),h=g(h,d,u,l,o[m+4],20,-405537848),l=g(l,h,d,u,o[m+9],5,568446438),u=g(u,l,h,d,o[m+14],9,-1019803690),d=g(d,u,l,h,o[m+3],14,-187363961),h=g(h,d,u,l,o[m+8],20,1163531501),l=g(l,h,d,u,o[m+13],5,-1444681467),u=g(u,l,h,d,o[m+2],9,-51403784),d=g(d,u,l,h,o[m+7],14,1735328473),l=y(l,h=g(h,d,u,l,o[m+12],20,-1926607734),d,u,o[m+5],4,-378558),u=y(u,l,h,d,o[m+8],11,-2022574463),d=y(d,u,l,h,o[m+11],16,1839030562),h=y(h,d,u,l,o[m+14],23,-35309556),l=y(l,h,d,u,o[m+1],4,-1530992060),u=y(u,l,h,d,o[m+4],11,1272893353),d=y(d,u,l,h,o[m+7],16,-155497632),h=y(h,d,u,l,o[m+10],23,-1094730640),l=y(l,h,d,u,o[m+13],4,681279174),u=y(u,l,h,d,o[m+0],11,-358537222),d=y(d,u,l,h,o[m+3],16,-722521979),h=y(h,d,u,l,o[m+6],23,76029189),l=y(l,h,d,u,o[m+9],4,-640364487),u=y(u,l,h,d,o[m+12],11,-421815835),d=y(d,u,l,h,o[m+15],16,530742520),l=f(l,h=y(h,d,u,l,o[m+2],23,-995338651),d,u,o[m+0],6,-198630844),u=f(u,l,h,d,o[m+7],10,1126891415),d=f(d,u,l,h,o[m+14],15,-1416354905),h=f(h,d,u,l,o[m+5],21,-57434055),l=f(l,h,d,u,o[m+12],6,1700485571),u=f(u,l,h,d,o[m+3],10,-1894986606),d=f(d,u,l,h,o[m+10],15,-1051523),h=f(h,d,u,l,o[m+1],21,-2054922799),l=f(l,h,d,u,o[m+8],6,1873313359),u=f(u,l,h,d,o[m+15],10,-30611744),d=f(d,u,l,h,o[m+6],15,-1560198380),h=f(h,d,u,l,o[m+13],21,1309151649),l=f(l,h,d,u,o[m+4],6,-145523070),u=f(u,l,h,d,o[m+11],10,-1120210379),d=f(d,u,l,h,o[m+2],15,718787259),h=f(h,d,u,l,o[m+9],21,-343485551),l=l+_>>>0,h=h+w>>>0,d=d+b>>>0,u=u+v>>>0}return t.endian([l,h,d,u])};i._ff=function(t,e,r,n,i,s,a){var o=t+(e&r|~e&n)+(i>>>0)+a;return(o<<s|o>>>32-s)+e},i._gg=function(t,e,r,n,i,s,a){var o=t+(e&n|r&~n)+(i>>>0)+a;return(o<<s|o>>>32-s)+e},i._hh=function(t,e,r,n,i,s,a){var o=t+(e^r^n)+(i>>>0)+a;return(o<<s|o>>>32-s)+e},i._ii=function(t,e,r,n,i,s,a){var o=t+(r^(e|~n))+(i>>>0)+a;return(o<<s|o>>>32-s)+e},i._blocksize=16,i._digestsize=16,K.exports=function(e,r){if(null==e)throw new Error("Illegal argument "+e);var s=t.wordsToBytes(i(e,r));return r&&r.asBytes?s:r&&r.asString?n.bytesToString(s):t.bytesToHex(s)}}();var Y=K.exports;const Q=new Map;class tt{static open(t,e){return new this(t,e)}constructor(t,e){const r=Y("db:"+e+"_"+t.id).slice(8,24);this.id=r,this.objective=D(r,"db:"+e),this._syncDataFromScoreboard(),Q.set(r,this)}store=new Map;_syncDataFromScoreboard(){this.store.clear(),_(this.objective.getParticipants(),(t=>{const e=b(t.displayName),r=Object.keys(e)[0],n=e[r];this.store.set(r,{value:n,participant:t})}))}has(t){return this.store.has(t)}async delete(t){if(this.has(t)){const{participant:e}=this.store.get(t);return await M((()=>this.objective.removeParticipant(e))),this.store.delete(t),!0}return!1}async clear(){await w(this.store,(async([,{participant:t}])=>await M((()=>this.objective.removeParticipant(t))))),this.store.clear()}get(t){if(this.has(t))return this.store.get(t).value}async set(t,e){await this.delete(t);const r=F({[t]:e}).replaceAll('"',"'");if(r.length>32767)throw new RangeError("Database: Only accepts a string value less than 32767 characters.");await M((()=>this.objective.setScore(r,1))),this._syncDataFromScoreboard()}getAll(){const t={};for(const[e,r]of this)t[e]=r;return t}*entries(){for(const[t,{value:e}]of this.store.entries())yield[t,e]}*keys(){for(const t of this.store.keys())yield t}*values(){for(const{value:t}of this.store.values())yield t}[Symbol.iterator](){return this.entries()}}class et{constructor(){this._events={}}on(t,e){if(e instanceof v){const r=`${t}.async`;this._events[r]?this._events[r].push(e):this._events[r]=[e]}else this._events[t]?this._events[t].push(e):this._events[t]=[e];return this}once(t,e){if(e instanceof v){const r=`${t}.async`,n=async(...t)=>{await e(...t),this.removeListener(r,n)};this._events[r]?this._events[r].push(n):this._events[r]=[n]}else{const r=(...n)=>{e(...n),this.removeListener(t,r)};this._events[t]?this._events[t].push(r):this._events[t]=[r]}return this}removeListener(t,e){if(this._events[t]){const r=[];_(this._events[t],(t=>{t!==e&&r.push(t)})),this._events[t]=r}return this}async emit(t,...e){this._events[t]&&_(this._events[t],(t=>t(...e))),await this.asyncEmit(t,...e)}async asyncEmit(t,...e){const r=`${t}.async`;this._events[r]&&await w(this._events[r],(async t=>await t(...e)))}addListener(t,e){return this.on(t,e)}off(t,e){return this.removeListener(t,e)}}class rt{constructor({name:t,description:e,values:r=[],defaultValue:n,events:i,reload:s,_player:a}){this.name=t,this.description=e,this.values=new Map(r.map((t=>("object"!=typeof t[0]&&void 0!==t[0]||(t[0]=F(t[0])),!0!==t[0]||t[1]?!1!==t[0]||t[1]||(t[1]="关闭"):t[1]="开启",t)))),this.events=new et,this.reload=s,this._defaultValue=n,this._player=a,i&&_(i,((t,e)=>this.events.on(e,t))),void 0!==n&&this.hasVal(n)?this.selected=n:r[0]&&(this.selected=r[0][0]),this.events.emit("inited",this.selected,a),this.events.emit("changed",this.selected,void 0,a)}select(t){return!(this.selected===t||!this.hasVal(t))&&(this.original=this.selected,this.selected=t,this.events.emit("selected",this.selected,this.original,this._player),this.events.emit("changed",this.selected,this.original,this._player),!0)}hasVal(t){return this.values.has(t)||!this.values.size}}function nt(t){return t>=0?Math.round(t):t%.5==0?Math.floor(t):Math.round(t)}function it(t){return Math.random()<=t}function st(t,e,r=1e-6){return Math.abs(t-e)<=r*Math.max(1,Math.abs(t),Math.abs(e))}function at(t){return t>1?t*at(t-1):1}function ot(t,e,r){return n=>t**(r-n)*e**n*function(t,e){return at(t)/(at(e)*at(t-e))}(r,n)}function ct(t,e,r){let n=0;for(let i=t;i<=e;i++)n+=r(i);return n}function lt(t,e,r=1){const n=[];for(let i=t;i<e;i+=r)n.push(i);return n}class ht{constructor(t,e,r=1){this.min=t,this.max=e,this.step=r}toArray(){return lt(this.min,this.max+this.step,this.step)}get array(){return this.toArray()}includes(t){return this.array.includes(t)}[Symbol.iterator](){return this.array.values()}}class dt{constructor({name:t,description:e,range:r=[0,1,1],defaultValue:n,events:i,reload:s,_player:a}){this.name=t,this.description=e,this.range=new ht(...r),this.events=new et,this.reload=s,this._defaultValue=n,this._player=a,i&&_(i,((t,e)=>this.events.on(e,t))),void 0!==n&&this._includes(n)?this.selected=n:this.selected=this.range.min,this.events.emit("inited",this.selected,a),this.events.emit("changed",this.selected,void 0,a)}select(t){return!(this.selected===t||!this._includes(t))&&(this.original=this.selected,this.selected=t,this.events.emit("selected",this.selected,this.original,this._player),this.events.emit("changed",this.selected,this.original,this._player),!0)}_includes(t){return this.range.includes(t)}}class ut{constructor(t,e){this.name=e,this.db=tt.open(t,`option-manager:${e}`),this.player=t}items={};addItem(t){return t.range?this.items[t.name]=new dt(t):t.values&&(this.items[t.name]=new rt(t)),this}async _syncToDB(){const t=this.getItemValMap();await w(t,(async(t,e)=>{await this.db.set(e,t)})),await w(this.db,(async([t,e])=>{this.hasItem(t)||this.db.delete(t)}))}async _syncFromDB(){_(this.db,(([t,e])=>this.setItemVal(t,e,void 0,{syncFromDB:!0}))),await this._syncToDB()}async init(){return delete this.addItem,await this._syncFromDB(),this.getItemValMap()}_getItem(t){return this.items[t]}hasItem(t){return!!this.items[t]}setItemVal(t,e,r=(()=>{}),{syncFromDB:n}={}){const i=this._getItem(t);if(i){i.select(e)&&(!n&&i.reload&&(this.reload=!0),r(i.selected,i.original,this.getItemValMap()))}return this}getItemVal(t){const e=this._getItem(t);if(e)return e.selected}getItemValMap(){const t={};return _(this.items,((e,r)=>t[r]=this.getItemVal(r))),t}async done(t){const e=async({reply:t=!0}={})=>{await this._syncToDB(),t&&this.player.sendMessage("设置选项修改成功")};this.reload?(this.reload=!1,await z.confirm({body:'你选择的项目更改后需要刷新脚本，请手动运行 "/reload" 命令。\n\n您也可以取消您的更改',target:this.player,onConfirm:async()=>{await e({reply:!1})},onCancel:async()=>{await this._syncFromDB(),await this.showDialog(t)}})):await e()}async showDialog(t){const e=(new y).title(`${this.name} 选项`),r=[];_(this.items,(t=>{if(t instanceof rt){const{name:n,description:i,values:s,selected:a}=t;if(2===s.size&&s.get(!0)&&s.get(!1)){const t=new Map;_(s,(([e])=>t.set(e,e))),r.push({name:n,valuesMap:t}),e.toggle(i,a)}else{const t=[...s],o=new Map;_(t,(([t],e)=>o.set(e,t))),r.push({name:n,valuesMap:o}),e.dropdown(i,t.map((t=>t[1])),t.map((t=>t[0])).findIndex((t=>t===a)))}}else if(t instanceof dt){const{name:n,description:i,range:s,selected:a}=t,o=new Map;_(s,(t=>o.set(t,t))),r.push({name:n,valuesMap:o}),e.slider(i,s.min,s.max,s.step,a)}}));const n=new z({dialog:e,onClose:async()=>{t&&await t.show(this.player)},onSubmit:async e=>{_(e,((t,e)=>{const{name:n,valuesMap:i}=r[e],s=i.get(t);this.setItemVal(n,s)})),await this.done(t)}});await n.show(this.player)}}class mt{constructor(t){this.name=t}players=new Map;_items=new Set;addItem(t){return this._items.add(t),this}applyPlayer(t){if(this.players.has(t))return this.players.get(t);const e=new ut(t,this.name);return _(this._items,(r=>{r._player=t,e.addItem(r)})),this.players.set(t,e),e}async applyMainPlayer(){const e=await function(){const e=t.getAllPlayers();return e.length?Promise.resolve(e[0]):new Promise((e=>{const r=t.afterEvents.playerSpawn.subscribe((n=>{n.initialSpawn&&e(n.player),t.afterEvents.playerSpawn.unsubscribe(r)}))}))}();return this.applyPlayer(e)}async init(){const t=new Map;return await w(this.players,(async([e,r])=>{const n=await r.init();t.set(e,n)})),delete this.applyPlayer,t}getPlayer(t){return this.players.get(t)}}const pt=new class{constructor(){}namespaces=new Map;registerNamesapace(t){const e=new mt(t);return this.namespaces.set(t,e),e}getNamesapace(t){return this.namespaces.get(t)}async showDialog(t){const e=(new f).title("设置选项").body("选择要设置的模块："),r=[];_(this.namespaces,(([t])=>{r.push(t),e.button(t)}));const n=new z({dialog:e,onSelect:async e=>{const i=r[e];await this.getNamesapace(i).getPlayer(t).showDialog(n)}});await n.show(t)}};S.register("!","option",(async(t,e)=>{switch(t[1]){case"dialog":case"-d":case void 0:await M((()=>pt.showDialog(e)));break;default:throw A("未知的子命令",e)}}));class gt{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.z=r}static parse(t){return new this(...t.split(" ").map(Number))}static create(t){if(Array.isArray(t))return new this(...t);if("string"==typeof t)return this.parse(t);if("object"==typeof t)return new this(t.x,t.y,t.z);throw new TypeError('The argument "vector" must be an array, a vector string or a vector object.')}stringify(){return this[Symbol.toPrimitive]("string")}toArray(){return[...this]}[Symbol.toPrimitive](t){return"string"===t?`${this.x} ${this.y} ${this.z}`:this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}class yt{static clone(t){return ft.create(t)}static add(t,e){return new ft(t.x+e.x,t.y+e.y,t.z+e.z)}static subtract(t,e){return new ft(t.x-e.x,t.y-e.y,t.z-e.z)}static multiply(t,e){return new ft(t.x*e.x,t.y*e.y,t.z*e.z)}static divide(t,e){return new ft(t.x/e.x,t.y/e.y,t.z/e.z)}static scale(t,e){return new ft(t.x*e,t.y*e,t.z*e)}static negate(t){return new ft(-t.x,-t.y,-t.z)}static inverse(t){return new ft(1/t.x,1/t.y,1/t.z)}static exchange(t,e=[]){if(2!==e.length)throw new Error("You could only exchange two axes.");const r=this.clone(t),n=r[e[0]],i=r[e[1]];return r[e[0]]=i,r[e[1]]=n,r}static exactEquals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}static equals(t,e){return st(t.x,e.x)&&st(t.y,e.y)&&st(t.z,e.z)}static max(...t){return new ft(Math.max(...t.map((({x:t})=>t))),Math.max(...t.map((({y:t})=>t))),Math.max(...t.map((({z:t})=>t))))}static min(...t){return new ft(Math.min(...t.map((({x:t})=>t))),Math.min(...t.map((({y:t})=>t))),Math.min(...t.map((({z:t})=>t))))}static floor(t){return new ft(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}static ceil(t){return new ft(Math.ceil(t.x),Math.ceil(t.y),Math.ceil(t.z))}static round(t){return new ft(nt(t.x),nt(t.y),nt(t.z))}static abs(t){return new ft(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))}static maxMagnitude(...t){return t.reduce(((t,e)=>this.magnitude(e)>this.magnitude(t)?e:t))}static minMagnitude(...t){return t.reduce(((t,e)=>this.magnitude(e)<this.magnitude(t)?e:t))}static magnitude(t){return Math.sqrt(this.squaredMagnitude(t))}static squaredMagnitude(t){return t.x**2+t.y**2+t.z**2}static distance(t,e){return Math.sqrt(this.squaredDistance(t,e))}static squaredDistance(t,e){return(e.x-t.x)**2+(e.y-t.y)**2+(e.x-t.z)**2}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){return new ft(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static normalize(t){const e=this.magnitude(t);return e?this.scale(t,1/e):new ft(0,0,0)}static angle(t,e){const r=this.dot(this.normalize(t),this.normalize(e));return Math.acos(r)}static random(t=1){const e=2*Math.random()*Math.PI,r=2*Math.random()-1,n=Math.sqrt(1-r*r)*t;return new ft(Math.cos(e)*n,Math.sin(e)*n,r*t)}static lerp(t,e,r){return new ft(t.x*(1-r)+e.x*r,t.y*(1-r)+e.y*r,t.z*(1-r)+e.z*r)}static slerp(t,e,r){if(r<=0)return this.clone(t);if(r>=1)return this.clone(e);const n=this.angle(t,e),i=Math.sin(n);if(i<=Number.EPSILON)return this.lerp(t,e,r);const s=Math.sin(n*(1-r))/i,a=Math.sin(n*r)/i;return new ft(t.x*s+e.x*a,t.y*s+e.y*a,t.z*s+e.z*a)}static bezier(t,e){const r=t.length-1,n=ot(1-e,e,r);return new ft(ct(0,r,(e=>t[e].x*n(e))),ct(0,r,(e=>t[e].y*n(e))),ct(0,r,(e=>t[e].z*n(e))))}}class ft extends gt{constructor(t,e,r){super(t,e,r)}get magnitude(){return yt.magnitude(this)}get squaredMagnitude(){return yt.squaredMagnitude(this)}get normalized(){return yt.normalize(this)}get floored(){return yt.floor(this)}get ceiled(){return yt.ceil(this)}get rounded(){return yt.round(this)}get absolute(){return yt.abs(this)}set(t,e,r){return this.x=t,this.y=e,this.z=r,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new ft(this.x,this.y,this.z)}equals(t){return yt.equals(this,t)}distance(t){return yt.distance(this,t)}squaredDistance(t){return yt.squaredDistance(this,t)}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}negate(t){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}inverse(t){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this}floor(){return this.copy(yt.floor(this)),this}ceil(){return this.copy(yt.ceil(this)),this}round(){return this.copy(yt.round(this)),this}abs(){return this.copy(yt.abs(this)),this}normalize(){return this.copy(yt.normalize(this)),this}}class _t extends ft{constructor(t,e,r){super(t,e,r)}get centerCorrected(){return new _t(...yt.add(this.floored,new ft(.5,.5,.5)))}clone(){return new _t(this.x,this.y,this.z)}equals(t){return yt.exactEquals(this,t)}offset(t){return this.add(t)}isNear(t,e){return this.distance(t)<=e}}class wt{static getDirectionOffset(t){return _t.create({x:t.isEast()?1:t.isWest()?-1:0,y:t.isUp()?1:t.isDown()?-1:0,z:t.isSouth()?1:t.isNorth()?-1:0})}static between(t,e,r=1){const n=[];for(let i=t.x;i<=e.x;i+=r)for(let s=t.y;s<=e.y;s+=r)for(let a=t.z;a<=e.z;a+=r)n.push(new _t(i,s,a));return n}}class bt extends _t{constructor(t,e,r){super(t,e,r),this.floor()}get centerCorrected(){throw new Error('Couldn\'t get "centerCorrected" on BlockLocation.')}clone(){return new bt(this.x,this.y,this.z)}divide(t){return super.divide(t),this.floor()}inverse(){throw new Error('Couldn\'t call "inverse" on BlockLocation.')}between(t){return wt.between(this,t)}}class vt{constructor({location:e,dimension:n}){this.location=e instanceof _t?e:_t.create(e),this.dimension=n instanceof r?n:t.getDimension(n)}textify(){return{location:`${this.location}`,dimension:this.dimension.id}}[Symbol.toPrimitive](t){return"string"===t?`${E(this.dimension.id)}: ${this.location}`:this}}class xt{constructor(t){this.code=t}get name(){switch(this.code){case 0:return"East";case 1:return"South";case 2:return"Up";case 3:return"West";case 4:return"North";case 5:return"Down"}}isEast(){return 0===this.code}isSouth(){return 1===this.code}isUp(){return 2===this.code}isWest(){return 3===this.code}isNorth(){return 4===this.code}isDown(){return 5===this.code}equals(t){return this.code===t.code}getOpposite(){const t=this.code+3;return new xt(t>=6?t-6:t)}isOppositeTo(t){return 3===Math.abs(this.code-t.code)}}class kt{static East=new xt(0);static South=new xt(1);static Up=new xt(2);static West=new xt(3);static North=new xt(4);static Down=new xt(5)}const It=new Map;class St{constructor(t){this.db=tt.open(t,"tpx"),this.player=t}static init(t){const e=new this(t);return It.set(t,e),e}async set({name:t,disposable:e,force:r}){const n=new vt(this.player),i=async()=>(await this.db.set(t,{info:n.textify(),disposable:e}),n);return!r&&this.db.has(t)?await z.confirm({body:`名称 ${t} 已被占用，是否覆盖？`,target:this.player,onConfirm:async()=>await i()}):await i()}async get(t){if(!this.db.has(t))return;const{info:e,disposable:r}=this.db.get(t);return r&&await this.db.delete(t),e?new vt(e):void 0}async remove(t){return!!this.db.has(t)&&await z.confirm({body:`是否删除 ${t} `,target:this.player,onConfirm:async()=>await this.db.delete(t)})}getAll(){const t=[];return _(this.db,(([e,{info:r,disposable:n}])=>{const i=new vt(r);t.push({name:e,info:i,disposable:n,text:`${e} (${i})`+(n?" [一次性]":"")})})),t}}class Mt{constructor(t){this.player=t,this.playerOption=Dt.getPlayer(t),this.playerDB=It.get(t)}async set({name:t="default",option:e={}}){const r=await this.playerDB.set(Object.assign({name:t},e));if("__back__"!==t&&"__death__"!==t)return{info:r}}async remove({name:t="default"}){return await this.playerDB.remove(t)}async teleport({name:t="default"}){const e=await this.playerDB.get(t);if(e)return this.playerOption.getItemVal("auto_back_point")&&"__death__"!==t&&await this.set({name:"__back__",option:{disposable:!0,force:!0}}),await M((()=>this.player.teleport(e.location,{dimension:e.dimension,checkForBlocks:!1,keepVelocity:!1}))),{info:e}}async tryTeleport({names:t=[]}){for(const e of t){const t=await this.teleport({name:e});if(t)return t}}list(){const t=this.playerDB.getAll().map((({text:t})=>t));if(t.length)return{msg:t}}}async function At(t){const e=t.deadEntity,r=new Mt(e);await r.set({name:"__death__",option:{disposable:!0,force:!0}})}const Dt=pt.registerNamesapace("tpx").addItem({name:"auto_back_point",description:"允许使用 tpx 传送时自动添加返回点",values:[[!0],[!1]],defaultValue:!0,events:{changed:(t,e)=>console.warn("tpx:auto_back_point -> from",e,"to",t)}}).addItem({name:"back_after_death",description:"允许死亡时自动添加死亡点",values:[[!0],[!1]],defaultValue:!0,events:{changed:(e,r)=>{console.warn("tpx:back_after_death -> from",r,"to",e),e?t.afterEvents.entityDie.subscribe(At,{entityTypes:["minecraft:player"]}):t.afterEvents.entityDie.unsubscribe(At)}}}).addItem({name:"back_cmd",description:"允许使用独立的 back 命令",values:[[!0],[!1]],defaultValue:!1,reload:!0,events:{changed:(t,e)=>console.warn("tpx:back_cmd -> from",e,"to",t)}}).addItem({name:"home_cmd",description:"允许使用独立的 home 命令",values:[[!0],[!1]],defaultValue:!1,reload:!0,events:{changed:(t,e)=>console.warn("tpx:home_cmd -> from",e,"to",t)}}),Et=["set","-s","remove","rm","-r","back","bk","-b","list","ls","-l","help","-h","option","opt","-o"];async function zt(t,e){const r=t[2]??"default",n=new Mt(e);switch(t[1]){case"set":case"-s":{if(Et.includes(r)||"__back__"===r)throw A(`添加失败：不能使用 ${r} 作为名称`,e);const i=await n.set({name:r,option:{disposable:"true"===t[3]||"false"!==t[3]&&null}});i&&e.sendMessage(`成功设置 ${r} 在 ${i.info}`);break}case"remove":case"rm":case"-r":{const t=await n.remove({name:r});if(!0===t)e.sendMessage(`成功删除 ${r}`);else if(!1===t)throw A(`删除失败：未找到 ${r}`,e);break}case"back":case"bk":case"-b":{const t=await n.tryTeleport({names:["__death__","__back__"]});if(!t)throw A("传送失败：未找到返回点",e);e.sendMessage(`已返回到 ${t.info}`);break}case"list":case"ls":case"-l":{const t=n.list();t?(t.msg.unshift("您的传送点有："),e.sendMessage(t.msg.join("\n- "))):e.sendMessage("您目前没有传送点");break}case"help":case"-h":e.sendMessage("制作中...");break;case"option":case"opt":case"-o":await M((()=>Dt.getPlayer(e).showDialog()));break;default:{const r=await n.teleport({name:t[1]});if(!r)throw A(`传送失败：未找到传送点 ${t[1]}`,e);e.sendMessage(`已传送到 ${r.info}`)}}}async function Rt(t,e){Dt.getPlayer(e).getItemVal("back_cmd")?await S.asyncRun("!tpx back",e):e.sendMessage("您未启用该命令")}async function Bt(t,e){if(Dt.getPlayer(e).getItemVal("home_cmd"))if("set"===t[1])await S.asyncRun("!tpx set __home__",e);else await S.asyncRun("!tpx __home__",e);else e.sendMessage("您未启用该命令")}Dt.applyMainPlayer().then((()=>_(t.getAllPlayers(),(t=>Dt.applyPlayer(t))))).then((()=>Dt.init())).then((t=>{_(t.keys(),(t=>St.init(t))),S.register("!","tpx",zt);const e=[...t.values()];e.some((({back_cmd:t})=>t))&&S.register("!","back",Rt),e.some((({home_cmd:t})=>t))&&S.register("!","home",Bt)})).catch(x.error);const Tt=pt.registerNamesapace("better-door").addItem({name:"door",description:"允许双开门",values:[[!0],[!1]],defaultValue:!0,events:{changed:(t,e)=>console.warn("better-door:door -> from",e,"to",t)}}).addItem({name:"trapdoor",description:"允许多开活板门",values:[[!0],[!1]],defaultValue:!1,events:{changed:(t,e)=>console.warn("better-door:trapdoor -> from",e,"to",t)}}).addItem({name:"max_trapdoor_length",description:"允许多开活板门的最大距离",range:[1,32],defaultValue:3,events:{changed:(t,e)=>console.warn("better-door:max_trapdoor_length -> from",e,"to",t)}});class Nt{constructor(t){this.types=new Set(t)}add(...t){_(t,(t=>this.types.add(t)))}has(t){return this.types.has(t)}clone(){return new Nt([...this])}toArray(){return Array.from(this)}[Symbol.iterator](){return this.types.keys()}}const Pt=new Nt(["minecraft:acacia_door","minecraft:bamboo_door","minecraft:birch_door","minecraft:cherry_door","minecraft:crimson_door","minecraft:dark_oak_door","minecraft:jungle_door","minecraft:mangrove_door","minecraft:spruce_door","minecraft:warped_door","minecraft:wooden_door"]),Ot=new Nt(["minecraft:acacia_trapdoor","minecraft:bamboo_trapdoor","minecraft:birch_trapdoor","minecraft:cherry_trapdoor","minecraft:crimson_trapdoor","minecraft:dark_oak_trapdoor","minecraft:jungle_trapdoor","minecraft:mangrove_trapdoor","minecraft:spruce_trapdoor","minecraft:trapdoor","minecraft:warped_trapdoor"]),Vt=new Nt(["minecraft:acacia_log","minecraft:birch_log","minecraft:cherry_log","minecraft:dark_oak_log","minecraft:jungle_log","minecraft:mangrove_log","minecraft:oak_log","minecraft:spruce_log "]),$t=new Nt(["minecraft:crimson_stem","minecraft:warped_stem"]),Ct=new Nt(["minecraft:coal_ore","minecraft:copper_ore","minecraft:deepslate_coal_ore","minecraft:deepslate_copper_ore","minecraft:deepslate_diamond_ore","minecraft:deepslate_emerald_ore","minecraft:deepslate_gold_ore","minecraft:deepslate_iron_ore","minecraft:deepslate_lapis_ore","minecraft:deepslate_redstone_ore","minecraft:diamond_ore","minecraft:emerald_ore","minecraft:gold_ore","minecraft:iron_ore","minecraft:lapis_ore","minecraft:nether_gold_ore","minecraft:quartz_ore","minecraft:redstone_ore"]),jt=new Nt(["minecraft:stone","minecraft:deepslate"]);class Lt{static wrap(...t){return new this(...t)}static tryWrap(...t){try{return new this(...t)}catch(t){}}static match(){throw new Error("Call without override.")}}const Ut=new Nt(["minecraft:diamond_pickaxe","minecraft:netherite_pickaxe"]),Ft=new Nt([...Ut,"minecraft:iron_pickaxe"]),qt=new Nt([...Ft,"minecraft:stone_pickaxe"]),Wt=new Nt([...qt,"minecraft:golden_pickaxe","minecraft:wooden_pickaxe"]);class Kt extends Lt{constructor(t){super(),this._item=t,this.type=t.type,this.typeId=t.typeId;_(t.getComponents(),(t=>{this.components.set(E(t.typeId),t)}))}components=new Map;hasComponent(t){return this._item.hasComponent(t)}get enchants(){return this.components.get("enchantments").enchantments}}class Ht extends Kt{constructor(t){if(!Ht.match(t))throw new TypeError(`The "${t.typeId}" doesn't have the "minecraft:durability" component.`);super(t)}static match(t){return t.hasComponent("minecraft:durability")}get damage(){return this.components.get("durability").damage}set damage(t){this.components.get("durability").damage=t<0?0:t}get maxDurability(){return this.components.get("durability").maxDurability}get durability(){return this.maxDurability-this.damage}set durability(t){this.damage+=this.durability-t}applyDamage(t){const e=this.enchants.hasEnchantment("unbreaking"),r=this.components.get("durability").getDamageChance(e)/100;for(let e=0;e<t;e++)it(r)&&(this.durability-=1);return this}}var Jt={acacia_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:acacia_log"}}]},amethyst_block:{drops:[{dig_by:Wt.toArray(),raw:{item_id:"minecraft:amethyst_block"}}]},amethyst_cluster:{drops:[{dig_by:Wt.toArray(),raw:{item_id:"minecraft:amethyst_shard",default_range:[4,4]},fortune_rule:"ore"},{dig_by:"<default>",raw:{item_id:"minecraft:amethyst_shard",default_range:[2,2]}}]},ancient_debris:{drops:[{dig_by:Ut.toArray(),raw:{item_id:"minecraft:ancient_debris"},refined:{item_id:"minecraft:netherite_scrap"}}]},birch_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:birch_log"}}]},cherry_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:cherry_log"}}]},coal_ore:{drops:[{dig_by:Wt.toArray(),raw:{item_id:"minecraft:coal",xp_range:[0,2]},fortune_rule:"ore"}]},copper_ore:{drops:[{dig_by:qt.toArray(),raw:{item_id:"minecraft:raw_copper",default_range:[2,5]},refined:{item_id:"minecraft:copper_ingot"},fortune_rule:"ore"}]},crimson_stem:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:crimson_stem"}}]},dark_oak_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:dark_oak_log"}}]},deepslate:{drops:[{dig_by:Wt.toArray(),raw:{item_id:"minecraft:cobbled_deepslate"}}]},deepslate_coal_ore:{drops:[{dig_by:Wt.toArray(),raw:{item_id:"minecraft:coal",xp_range:[0,2]},fortune_rule:"ore"}]},deepslate_copper_ore:{drops:[{dig_by:qt.toArray(),raw:{item_id:"minecraft:raw_copper",default_range:[2,5]},refined:{item_id:"minecraft:copper_ingot"},fortune_rule:"ore"}]},deepslate_diamond_ore:{drops:[{dig_by:Ft.toArray(),raw:{item_id:"minecraft:diamond",xp_range:[3,7]},fortune_rule:"ore"}]},deepslate_emerald_ore:{drops:[{dig_by:Ft.toArray(),raw:{item_id:"minecraft:emerald",xp_range:[3,7]},fortune_rule:"ore"}]},deepslate_gold_ore:{drops:[{dig_by:Ft.toArray(),raw:{item_id:"minecraft:raw_gold"},refined:{item_id:"minecraft:gold_ingot"},fortune_rule:"ore"}]},deepslate_iron_ore:{drops:[{dig_by:qt.toArray(),raw:{item_id:"minecraft:raw_iron"},refined:{item_id:"minecraft:iron_ingot"},fortune_rule:"ore"}]},deepslate_lapis_ore:{drops:[{dig_by:qt.toArray(),raw:{item_id:"minecraft:lapis_lazuli",default_range:[4,9],xp_range:[2,5]},fortune_rule:"ore"}]},deepslate_redstone_ore:{drops:[{dig_by:Ft.toArray(),raw:{item_id:"minecraft:redstone",default_range:[4,5],xp_range:[1,5]},fortune_rule:"melon"}]},diamond_ore:{drops:[{dig_by:Ft.toArray(),raw:{item_id:"minecraft:diamond",xp_range:[3,7]},fortune_rule:"ore"}]},emerald_ore:{drops:[{dig_by:Ft.toArray(),raw:{item_id:"minecraft:emerald",xp_range:[3,7]},fortune_rule:"ore"}]},gold_ore:{drops:[{dig_by:Ft.toArray(),raw:{item_id:"minecraft:raw_gold"},refined:{item_id:"minecraft:gold_ingot"},fortune_rule:"ore"}]},iron_ore:{drops:[{dig_by:qt.toArray(),raw:{item_id:"minecraft:raw_iron"},refined:{item_id:"minecraft:iron_ingot"},fortune_rule:"ore"}]},jungle_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:jungle_log"}}]},lapis_ore:{drops:[{dig_by:qt.toArray(),raw:{item_id:"minecraft:lapis_lazuli",default_range:[4,9],xp_range:[2,5]},fortune_rule:"ore"}]},mangrove_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:mangrove_log"}}]},nether_gold_ore:{drops:[{dig_by:Wt.toArray(),raw:{item_id:"minecraft:gold_nugget",default_range:[2,6],xp_range:[0,1]},refined:{item_id:"minecraft:gold_ingot"},fortune_rule:"ore"}]},oak_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:oak_log"}}]},obsidian:{drops:[{dig_by:Ut.toArray(),raw:{item_id:"minecraft:obsidian"}}]},quartz_ore:{drops:[{dig_by:Wt.toArray(),raw:{item_id:"minecraft:quartz",xp_range:[2,5]},fortune_rule:"ore"}]},redstone_ore:{drops:[{dig_by:Ft.toArray(),raw:{item_id:"minecraft:redstone",default_range:[4,5],xp_range:[1,5]},fortune_rule:"melon"}]},spruce_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:spruce_log"}}]},stone:{drops:[{dig_by:Wt.toArray(),raw:{item_id:"minecraft:cobblestone"},refined:{item_id:"minecraft:smooth_stone"}}]},warped_stem:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:warped_stem"}}]}};class Gt{constructor(t){t&&_(t,(t=>{"number"==typeof t?this.addItem({weight:1,value:t}):this.addItem(t)}))}table=new Set;totalWeight=0;addItem(t){this.table.add(t),this.totalWeight+=t.weight}getResult(){let t=0;for(const{weight:e,value:r}of this.table){if(it(e/(this.totalWeight-t)))return r;t+=e}}[Symbol.iterator](){return this.table}}class Xt{constructor({item_id:t,default_range:e=[1,1],max_amount:r=1/0,xp_range:n=[0,0],damage:i=1}={}){this.itemId=t,this.range=new ht(...e),this.amountLootTable=new Gt(this.range.toArray()),this.maxAmount=r,this.xpRange=new ht(...n),this.damage=i}getResult(){return[{itemId:this.itemId,amount:Math.min(this.amountLootTable.getResult(),this.maxAmount),xp:new Gt(this.xpRange.toArray()).getResult(),damage:this.damage}]}}class Zt{constructor(t){this.items=t.map((t=>new Xt(t)))}getResult(){const t=[];return _(this.items,(e=>t.push(...e.getResult()))),t}}const Yt="ore",Qt="melon",te="grass",ee="flower",re="crop",ne="custom";class ie{constructor(t,e){const r=E(t),n=Jt[r]?.drops;if(!n)throw new Error(`Block ${r} has not been supportive.`);this.blockTypeId=t,this.drops=n,e&&this.setItemUse(e)}setItemUse(t="<empty>"){const e=this.drops.find((e=>{const r=e.dig_by;return Array.isArray(r)?r.includes(t):"string"==typeof r?r===t:void 0}))??this.drops.find((t=>"<default>"===t.dig_by));if(!e)return!1;if(this.blockItem=new Xt({item_id:s.resolve(this.blockTypeId).getItemStack()?.typeId}),this.rawResource=new Xt(e.raw)??this.blockItem,this.refinedResource=new Xt(e.refined),this.seendResource=new Xt(e.seed)??this.rawResource,this.immatureResource=new Xt(e.immature)??this.seendResource,this.fortuneRule=e.fortune_rule,this.fortuneRule===ne&&(this.custumLootTable=e.option?.custom,!this.custumLootTable))throw new Error("You must provide a custom loot table for the custom fortune rule.");return!0}getDrops({withFortune:t,withSilkTouch:e,immature:r}={}){if(t&&e)throw new Error("Could not call with both fortune and silk_touch.");if(r)return this.immatureResource.getResult();if(e)return this.blockItem.getResult();if(void 0===t||!this.fortuneRule)return this.rawResource.getResult();{const e=t;switch(this.fortuneRule){case Yt:{const t=this.rawResource.getResult()[0],r=new Gt([...lt(2,e+2),{weight:2,value:1}]);return t.amount*=r.getResult(),[t]}case Qt:{const t=this.rawResource.getResult()[0],r=new Gt([...this.rawResource.amountLootTable,...lt(1,e+1).map((t=>({weight:1,value:Math.min(this.rawResource.maxAmount,this.rawResource.range.max+t)})))]);return t.amount=r.getResult(),[t]}case te:{const t=this.rawResource.getResult()[0];if(0===t.amount)return[t];{const r=new Gt(lt(1,2*e+2));return t.amount=r.getResult(),[t]}}case ee:{const t=this.rawResource.getResult()[0],r=new Gt(lt(1,2*e+2));return t.amount=r.getResult(),[t]}case re:{const t=this.rawResource.getResult()[0],r=ot(1-(n=4/7),n,e+3),i=new Gt(lt(0,e+4).map((t=>({weight:r(t),value:t}))));return[t,{itemId:this.seendResource.itemTypeId,amount:i.getResult()}]}case ne:{const t=new Gt(this.custumLootTable[e]);return new Zt(t.getResult()).getResult()}}}var n}}class se extends Lt{constructor(t){super(),this._block=t,this.type=t.type,this.typeId=t.typeId,this.location=bt.create(t.location),this.dimension=t.dimension,this.permutation=t.permutation}getOffsetBlock(t){const e=this.location.clone().offset(t);return new se(this.dimension.getBlock(e))}getNeighbourBlock(t){const e=wt.getDirectionOffset(t);return this.getOffsetBlock(e)}getState(t){return this.permutation.getState(t)}hasState(t){return!!this.getState(t)}setState(t,e){const r=this.permutation.getAllStates();r[t]=e,this._block.setPermutation(s.resolve(this.typeId,r))}canBeDugBy(t="<empty>"){return new ie(this.typeId).setItemUse(t)}destroy(){this.dimension.fillBlocks(this.location,this.location,s.resolve("minecraft:air"))}breakBy(t){const e=new ie(this.typeId,t?.typeId??"<empty>");this.destroy();const r=(()=>{if(t){const r=t instanceof Kt?t:new Kt(t);return e.getDrops({withFortune:r.enchants.hasEnchantment("fortune"),withSilkTouch:r.enchants.hasEnchantment("silk_touch")})}return e.getDrops()})();return{drops:r,spawnDrops:()=>{_(r,(t=>{for(this.dimension.spawnItem(new a(t.itemId,t.amount),this.location);t.xp--;)this.dimension.spawnEntity("minecraft:xp_orb",this.location)}))},getTotalDamage:()=>{let t=0;return _(r,(e=>{e.damage&&(t+=e.damage)})),t}}}}class ae extends Lt{constructor(t){super(),this._blocks=(Array.isArray(t)?t:[t]).map((t=>t instanceof se?t:new se(t)))}get _block(){return this._blocks[0]}get type(){return this._block.type}get typeId(){return this._block.typeId}get location(){return this._block.location}get dimension(){return this._block.dimension}get permutation(){return this._block.permutation}}class oe{constructor(t){t&&this.add(...t)}blocks=[];get size(){return this.blocks.length}add(...t){_(t,(t=>{this.has(t)||this.blocks.push(t)}))}has(t){return this.blocks.some((({location:e})=>yt.exactEquals(e,t.location)))}shift(){return this.blocks.shift()}[Symbol.iterator](){return this.blocks.values()}}class ce extends ae{constructor(t){if(!ce.match(t))throw new TypeError(`The "${t.typeId}" is not a wooden door.`);const e=t instanceof se?t:new se(t),r=e.getState("upper_block_bit");super([r?e.getNeighbourBlock(kt.Down):e,r?e:e.getNeighbourBlock(kt.Up)])}static match(t){return Pt.has(t?.typeId)}get _lower(){return this._blocks[0]}get _upper(){return this._blocks[1]}get opened(){return this._lower.getState("open_bit")}get facingDirection(){switch(this._lower.getState("direction")){case 0:return kt.East;case 1:return kt.South;case 2:return kt.West;case 3:return kt.North}}get hingeSide(){return this._upper.getState("door_hinge_bit")}open(){this._lower.setState("open_bit",!0)}close(){this._lower.setState("open_bit",!1)}getRelated(){const t=this.facingDirection,e=this.hingeSide,r=bt.create({x:Number(t.isSouth()?e||-1:t.isNorth()?!e||-1:0),y:0,z:Number(t.isEast()?!e||-1:t.isWest()?e||-1:0)}),n=this._lower.getOffsetBlock(r),i=[this];if(ce.match(n)){const r=new ce(n);r.facingDirection.code===t.code&&r.hingeSide===!e&&i.push(r)}return i}}class le extends Lt{components=new Map;constructor(t){super(),this._entity=t,this.id=t.id,this.typeId=t.typeId,this.scoreboardIdentity=t.scoreboardIdentity;_(t.getComponents(),(t=>{this.components.set(E(t.typeId),t)}))}get nameTag(){return this._entity.nameTag}get location(){return _t.create(this._entity.location)}get dimension(){return this._entity.dimension}get isSneaking(){return this._entity.isSneaking}getRotation(){return this._entity.getRotation()}getFacingDirectionXZ(){const t=this.getRotation().y;return t>-135&&t<=-45?kt.East:t>-45&&t<=45?kt.South:t>45&&t<=135?kt.West:t>135||t<=-135?kt.North:void 0}}class he extends Lt{constructor(t){super(),this._container=t}get size(){return this._container.size}get emptySlotsCount(){return this._container.emptySlotsCount}getItem(t){return this._container.getItem(t)}setItem(t,e){return this._container.setItem(t,e)}tryAddItem(t){return this._container.addItem(t)}}class de extends he{constructor(t,e){super(e),this._entity=t}get location(){return this._entity.location}get dimension(){return this._entity.dimension}addItem(t){const e=this.tryAddItem(t);e&&this.dimension.spawnItem(e,this.location)}}class ue extends le{constructor(t){super(t),this.name=t.name}static match(t){return"minecraft:player"===t.typeId}get _player(){return this._entity}get experience(){return this.addExperience(0)}get level(){return this._player.level}get inventory(){return new de(this,this.components.get("inventory").container)}get selectedSlot(){return this._player.selectedSlot}getGameMode(){const t=[];return _(o,(e=>{this.testGameMode(e)&&t.push(e)})),t[0]}testGameMode(t){return this.dimension.getPlayers({gameMode:t}).some((t=>t.id===this.id))}setGameMode(t){if(!Object.values(o).includes(t))throw new TypeError("Unknown gamemode.");S.run(`gamemode ${t}`,this._player)}getMainHandItem(){return this.inventory.getItem(this.selectedSlot)}setMainHandItem(t){this.inventory.setItem(this.selectedSlot,t)}async useItemFromInventory(t,e=(async()=>{})){let r=this.inventory.getItem(t);r=await e(r),this.inventory.setItem(t,r)}async useMainHandItem(t=(async()=>{})){await this.useItemFromInventory(this.selectedSlot,t)}addExperience(t=0,{useXpOrb:e=!1}={}){if(e&&t>=0){for(;t--;)this.dimension.spawnEntity("minecraft:xp_orb",this.location);return this.experience}return this._player.addExperience(t)}addLevels(t=0){return this._player.addLevels(t)}}class me extends se{constructor(t){if(!me.match(t))throw new TypeError(`The "${t.typeId}" is not a wooden door.`);super(t)}static match(t){return Ot.has(t?.typeId)}get opened(){return this.getState("open_bit")}get facingDirection(){switch(this.getState("direction")){case 0:return kt.East;case 2:return kt.South;case 1:return kt.West;case 3:return kt.North}}get upsideOrDown(){return this.getState("upside_down_bit")}open(){this.setState("open_bit",!0)}close(){this.setState("open_bit",!1)}getRelated(t,{extensive:e=!0,maxLength:r=1}={}){const n=[this];if(r>0){const t=this.getNeighbourBlock(this.facingDirection);if(me.match(t)){const e=new me(t._block);e.facingDirection.isOppositeTo(this.facingDirection)&&e.upsideOrDown===this.upsideOrDown&&n.push(e)}}if(e){let e=this,i=!1;for(;--r;){const s=ue.wrap(t).getFacingDirectionXZ(),a=i?e.getNeighbourBlock(s.getOpposite()):e.getNeighbourBlock(s);if(me.match(a)){const i=new me(a._block);if(i.facingDirection.equals(this.facingDirection)&&i.upsideOrDown===this.upsideOrDown){const s=i.getRelated(t,{extensive:!1,maxLength:r});if(s.length>1){n.push(...s),e=i;continue}}}if(i)break;i=!0,e=this,r++}}return n}}Tt.applyMainPlayer().then((()=>_(t.getAllPlayers(),(t=>Tt.applyPlayer(t))))).then((()=>Tt.init())).then((()=>t.beforeEvents.itemUseOn.subscribe((t=>{const{block:e,source:r}=t,n=Tt.getPlayer(r);if(ce.match(e)&&n.getItemVal("door")){t.cancel=!0;const r=ce.wrap(e).getRelated();M((()=>{r[0].opened?_(r,(t=>t.close())):_(r,(t=>t.open()))})).catch(x.error)}else if(me.match(e)&&n.getItemVal("trapdoor")){t.cancel=!0;const i=n.getItemVal("max_trapdoor_length"),s=me.wrap(e).getRelated(r,{maxLength:i});M((()=>{s[0].opened?_(s,(t=>t.close())):_(s,(t=>t.open()))})).catch(x.error)}})))).catch(x.error);const pe=pt.registerNamesapace("scoreboard-statistic").addItem({name:"enable_creative",description:"允许统计创造模式下的行为",values:[[!0],[!1]],defaultValue:!0,events:{changed:(t,e)=>console.warn("scoreboard-statistic:enable_creative -> from",e,"to",t)}}).addItem({name:"enable_cancel_out",description:"对部分统计项启用抵消",values:[[!0],[!1]],defaultValue:!1,events:{changed:(t,e)=>console.warn("scoreboard-statistic:enable_cancel_out -> from",e,"to",t)}}).addItem({name:"enable_confirm_dialog",description:"启用删除记分板时的警告",values:[[!0],[!1]],defaultValue:!0,events:{changed:(t,e)=>console.warn("scoreboard-statistic:enable_confirm_dialog -> from",e,"to",t)}}).addItem({name:"auto_start",description:"添加记分板后是否自动开始统计",values:[[!0],[!1]],defaultValue:!0,events:{changed:(t,e)=>console.warn("scoreboard-statistic:auto_start -> from",e,"to",t)}}),ge=new tt({id:"global"},"scoreboard-statistic-global"),ye=new Map;class fe{constructor(t){this.db=new tt(t,"scoreboard-statistic-player"),this.player=t}events=new Map;static init(t){const e=new this(t);return ye.set(t,e),e}async addParticipated(t){const e=this.getParticipated();e.add(t),await this.db.set("__participated__",e)}getParticipated(){return new Set(this.db.get("__participated__")??[])}setEvents(t,e){this.events.set(t,e)}getEvents(t){return this.events.get(t)}async add(t,e){await this.addParticipated(t),this.setEvents(t,e)}has(t){return this.events.has(t)&&this.getParticipated().has(t)}async delete(t){const e=this.getParticipated();if(e.has(t))return e.delete(t),await this.db.set("__participated__",e),this.events.delete(t),!0}async clear(){await this.db.clear(),this.events.clear()}}var _e=({player:t,target:e,callback:r})=>({events:{entityDie:{option:{entityTypes:[e]},listener(e){const n=e.damageSource.cause,i=e.damageSource.damagingEntity;n===c.entityAttack&&i.id===t.id&&r({type:"increase",value:1})}}}}),we=({player:t,target:e,callback:r})=>({events:{entityDie:{option:{entities:[t]},listener(t){const n=t.damageSource.cause,i=t.damageSource.damagingEntity;n===c.entityAttack&&i.typeId===e&&r({type:"increase",value:1})}}}}),be=({player:t,target:e,callback:r})=>({events:{entityDie:{option:{entities:[t]},listener(t){"minecraft:"+t.damageSource.cause===e&&r({type:"increase",value:1})}}}}),ve=({player:t,target:e,callback:r})=>({events:{blockBreak:{listener(n){const i=n.brokenBlockPermutation;n.player.id===t.id&&i.type.id===e&&r({type:"increase",value:1})}},blockPlace:{listener(n){const i=n.block;n.player.id===t.id&&i.typeId===e&&r({type:"decrease",value:1})}}}}),xe=({player:t,target:e,callback:r})=>({events:{blockBreak:{listener(n){const i=n.brokenBlockPermutation;n.player.id===t.id&&i.type.id===e&&r({type:"decrease",value:1})}},blockPlace:{listener(n){const i=n.block;n.player.id===t.id&&i.typeId===e&&r({type:"increase",value:1})}}}});const ke={"minecraft:killed":_e,killed:_e,"minecraft:killed_by":we,killed_by:we,"minecraft:killed_for":be,killed_for:be,"minecraft:mined":ve,mined:ve,"minecraft:placed":xe,placed:xe};var Ie=new Map([...Object.entries(ke),["deathCount",({player:t,callback:e})=>({events:{entityDie:{option:{entities:[t]},listener(){e({type:"increase",value:1})}}}})],["playerKillCount",({player:t,callback:e})=>_e({player:t,target:"minecraft:player",callback:e})],["totalKillCount",({player:t,callback:e})=>({events:{entityDie:{listener(r){const n=r.damageSource.cause,i=r.damageSource.damagingEntity;n===c.entityAttack&&i.id===t.id&&e({type:"increase",value:1})}}}})],["health",({player:t,callback:e})=>({events:{entityHealthChanged:{option:{entities:[t]},listener(t){e({type:"reset",value:t.newValue})}},playerSpawn:{listener(){e({type:"reset",value:20})}}}})]]);class Se{constructor(t){this.player=t,this.playerOption=pe.getPlayer(t),this.playerDB=ye.get(t)}async add({objectiveId:e,criteria:r,displayName:n=e}){if(t.scoreboard.getObjective(e))return{code:0,message:"DUPLICATE_OBJECTIVE"};const[i]=Me(r);return Ie.get(i)?(await M((()=>{const r=t.scoreboard.addObjective(e,n);t.scoreboard.setObjectiveAtDisplaySlot(l.Sidebar,{objective:r,sortOrder:h.Ascending}),r.hasParticipant(this.player)||this.player.runCommand(`scoreboard players set @s ${e} 0`)})),await ge.set(e,r),{code:1}):{code:0,message:"UNKNOWN_CRITERIA"}}async remove({objectiveId:e}){return!!ge.get(e)&&(await M((()=>t.scoreboard.removeObjective(e))),await ge.delete(e),!0)}async start({objectiveId:e,criteria:r=ge.get(e)}){if(this.playerDB.has(e))return!1;const n=D(e),[i,s]=Me(r),a=Ie.get(i)({player:this.player,target:s,callback:t=>{if(!ue.wrap(this.player).testGameMode(o.creative)||this.playerOption.getItemVal("enable_creative"))switch(t.type){case"decrease":this.playerOption.getItemVal("enable_cancel_out")&&n.setScore(this.player,n.getScore(this.player)-t.value);break;case"reset":n.setScore(this.player,t.value);break;default:n.setScore(this.player,n.getScore(this.player)+t.value)}}});return await w(a.events,(async({option:e,listener:r},n)=>{e?await M((()=>t.afterEvents[n].subscribe(r,e))):await M((()=>t.afterEvents[n].subscribe(r)))})),await this.playerDB.add(e,a.events),!0}async stop({objectiveId:e}){if(!this.playerDB.has(e))return!1;const r=this.playerDB.getEvents(e);return await w(r,(async({listener:e},r)=>{await M((()=>t.afterEvents[r].unsubscribe(e)))})),await this.playerDB.delete(e),!0}}function Me(t){return t.split(":").map((t=>t.replace(".",":"))).map(((t,e)=>0===e||t.match(/^(.+)\:/)?t:`minecraft:${t}`))}async function Ae(t,e){const r=pe.getPlayer(e),n=new Se(e),i=t[2];switch(t[1]){case"add":{const[,,,a,o]=t;if(!i)throw A("objectiveId 是必须的",e);if(!a)throw A("criteria 是必须的",e);r.getItemVal("enable_creative")||e.sendMessage("注意：当前设置不会统计创造模式下的行为");const c=await n.add({objectiveId:i,criteria:a,displayName:o});if(c.code)e.sendMessage(`成功添加记分板 "${o}" (${i}) 使用 "${a}"`);else switch(c.message){case"DUPLICATE_OBJECTIVE":throw A(`添加失败：记分板 ${i} 已存在`,e);case"UNKNOWN_CRITERIA":throw A(`添加失败：未知的准则 ${a}`,e)}if(r.getItemVal("auto_start")){await n.start({objectiveId:i,criteria:a})&&e.sendMessage(`已自动开启您在 ${o} 上的统计`)}break}case"remove":case"rm":case"-r":{async function s(){if(!await n.remove({objectiveId:i}))throw A(`移除失败：记分板 ${i} 不存在或不是统计用记分板`,e);e.sendMessage(`删除成功 ${i}`)}r.getItemVal("enable_confirm_dialog")?await z.confirm({body:`是否清除记分板 ${i} 上的统计数据，你将永远失去它们`,target:e,onConfirm:s}):await s();break}case"stop":if(!await n.stop({objectiveId:i}))throw A(`暂停失败：您可能没有开启您在记分板 ${i} 上的统计，或该记分板不存在`,e);e.sendMessage(`已暂停您在 ${i} 上的统计`);break;case"start":if(!await n.start({objectiveId:i}))throw A(`开启失败：您可能已经开启您在记分板 ${i} 上的统计，或该记分板不存在`,e);e.sendMessage(`已开启您在 ${i} 上的统计`);break;case"option":case"opt":case"-o":await M((()=>r.showDialog()));break;default:throw A(`未知的子命令 ${t[1]}`,e)}}pe.applyMainPlayer().then((()=>_(t.getAllPlayers(),(t=>pe.applyPlayer(t))))).then((()=>pe.init())).then((async()=>{await w(pe.players,(async([t])=>{const e=fe.init(t),r=new Se(t),n=e.getParticipated();await e.clear(),await w(n,(async e=>{await r.start({objectiveId:e})&&t.sendMessage(`已重启您在记分板 ${e} 上的统计`)}))})),S.register("!","statistic",Ae)})).catch(x.error);const De=pt.registerNamesapace("vein-mining").addItem({name:"condition",description:"触发条件",values:[["off","关闭"],["always","总是"],["sneaking","仅潜行时"]],defaultValue:"sneaking",events:{changed:(t,e)=>console.warn("vein-mining:tigger -> from",e,"to",t)}}).addItem({name:"max_amount",description:"最多检测的方块数量（并非最终挖掘的方块数）",range:[8,128],defaultValue:64,events:{changed:(t,e)=>console.warn("vein-mining:enable_edge -> from",e,"to",t)}}).addItem({name:"enable_stone",description:"允许连锁挖掘岩石类方块（石头、深板岩）",values:[[!0],[!1]],defaultValue:!1,events:{changed:(t,e)=>console.warn("vein-mining:enable_stone -> from",e,"to",t)}}).addItem({name:"auto_collection",description:"自动收集掉落物及经验（绕过经验修补）",values:[[!0],[!1]],defaultValue:!1,events:{changed:(t,e)=>console.warn("vein-mining:auto_collect_drops -> from",e,"to",t)}}).addItem({name:"prevent_tool_destruction",description:"防止工具耐久耗尽",values:[[!0],[!1]],defaultValue:!1,events:{changed:(t,e)=>console.warn("vein-mining:prevent_tool_destruction -> from",e,"to",t)}}).addItem({name:"enable_edge",description:"是否检测仅棱相连的方块",values:[[!0],[!1]],defaultValue:!1,events:{changed:(t,e)=>console.warn("vein-mining:enable_edge -> from",e,"to",t)}}).addItem({name:"enable_diagonal",description:"是否检测仅角相连的方块",values:[[!0],[!1]],defaultValue:!1,events:{changed:(t,e)=>console.warn("vein-mining:enable_diagonal -> from",e,"to",t)}}),Ee=new Nt([...Vt,...$t,...Ct,"minecraft:obsidian","minecraft:ancient_debris","minecraft:amethyst_block"]),ze=()=>t.afterEvents.blockBreak.subscribe((t=>{const e=new se(t.block),r=t.brokenBlockPermutation.type.id,n=new ue(t.player),i=De.getPlayer(t.player);i.getItemVal("enable_stone")&&Ee.clone().add(...jt),n.useMainHandItem((async t=>{if(!t||!Ee.has(r)||!se.prototype.canBeDugBy.call({typeId:r},t.typeId)||"off"===i.getItemVal("condition")||"sneaking"===i.getItemVal("condition")&&!n.isSneaking)return t;const s=function(t,e,r){const n=t.getItemVal("max_amount"),i=new oe;i.add(...Re(t,e,r));let s=0,a=i.size;for(;a<n&&a-s>0;)for(const e of i)if(i.add(...Re(t,e,r)),s=a,a=i.size,a>=n)break;return i}(i,e,r),o=Ht.tryWrap(t)??new Kt(t);let c=0;const l=[];let h=0;for(;s.size>0&&(!i.getItemVal("prevent_tool_destruction")||i.getItemVal("prevent_tool_destruction")&&c<(o.durability??1/0));){const e=s.shift(),r=await M((()=>e.breakBy(t)));c+=r.getTotalDamage(),i.getItemVal("auto_collection")?_(r.drops,(t=>{t.xp&&(h+=t.xp),l.push([t.itemId,t.amount])})):r.spawnDrops()}return i.getItemVal("auto_collection")&&(_(l,(t=>n.inventory.addItem(new a(...t)))),n.addExperience(h)),o instanceof Ht&&o.applyDamage(c),o._item})).catch(x.error)}));function Re(t,e,r){const n=[new bt(1,0,0),new bt(-1,0,0),new bt(0,0,1),new bt(0,0,-1),new bt(0,1,0),new bt(0,-1,0)];t.getItemVal("enable_edge")&&n.push(new bt(1,1,0),new bt(1,-1,0),new bt(-1,1,0),new bt(-1,-1,0),new bt(0,1,1),new bt(0,-1,1),new bt(0,1,-1),new bt(0,-1,-1),new bt(1,0,1),new bt(1,0,-1),new bt(-1,0,1),new bt(-1,0,-1)),t.getItemVal("enable_diagonal")&&n.push(new bt(-1,-1,-1),new bt(-1,1,-1),new bt(-1,-1,1),new bt(-1,1,1),new bt(1,-1,-1),new bt(1,1,-1),new bt(1,-1,1),new bt(1,1,1));const i=new oe;return _(n,(t=>{const n=e.getOffsetBlock(t);n.typeId===r&&i.add(n)})),i}De.applyMainPlayer().then((()=>_(t.getAllPlayers(),(t=>De.applyPlayer(t))))).then((()=>De.init())).then((()=>ze())).catch(x.error);
