/*!
 * my-mcbe-script-bundle.js v0.0.0 (https://github.com/PFiS1737/my-mcbe-script#readme)
 * Copyright 2022-2024 PFiS1737
 * Licensed under MIT
 * 
 * This file is automatically generated, please do not change it.
 */
import{system as e,world as t,Dimension as r,BlockPermutation as n,BlockVolume as s,ItemStack as i,MinecraftDimensionTypes as a,Entity as o,GameMode as c,EntityDamageCause as l,DisplaySlotId as d,ObjectiveSortOrder as h}from"@minecraft/server";import{MessageFormData as u,FormCancelationReason as m,ModalFormResponse as p,MessageFormResponse as g,ActionFormResponse as f,ModalFormData as _,ActionFormData as y}from"@minecraft/server-ui";class w{static error(e){console.error(`${e}\n${e.stack}`)}}function b(e,t,r){if(Array.isArray(e))e.forEach(t,r);else if(e?.[Symbol.iterator])for(const n of e)t.call(r,n,e);else"object"==typeof e&&b(Object.keys(e),((n,s)=>t.call(r,e[n],n,s,e)))}async function v(e,t,r){if(Array.isArray(e))for(let n=0;n<e.length;n++)await t.call(r,e[n],n,e);else if(e?.[Symbol.iterator])for(const n of e)await t.call(r,n,e);else"object"==typeof e&&await v(Object.keys(e),(async(n,s)=>await t.call(r,e[n],n,s,e)))}function I(e){try{return JSON.parse(e)}catch(t){return function(e,t={}){return new Function(...Object.keys(t),`return ${e}`)(...Object.values(t))}(`(${e})`)}}function k(e){return"AsyncFunction"===e[Symbol.toStringTag]}class x{constructor(e){this.types=new Set(e)}add(...e){return b(e,(e=>this.types.add(e))),this}has(e){return this.types.has(e)}clone(){return new x([...this])}toArray(){return Array.from(this)}[Symbol.iterator](){return this.types.keys()}}const S=new x(["minecraft:acacia_door","minecraft:bamboo_door","minecraft:birch_door","minecraft:cherry_door","minecraft:crimson_door","minecraft:dark_oak_door","minecraft:jungle_door","minecraft:mangrove_door","minecraft:spruce_door","minecraft:warped_door","minecraft:wooden_door"]),A=new x(["minecraft:copper_door","minecraft:exposed_copper_door","minecraft:weathered_copper_door","minecraft:oxidized_copper_door","minecraft:waxed_copper_door","minecraft:waxed_exposed_copper_door","minecraft:waxed_weathered_copper_door","minecraft:waxed_oxidized_copper_door"]),M=new x([...S,...A,"minecraft:iron_door"]),D=new x(["minecraft:acacia_trapdoor","minecraft:bamboo_trapdoor","minecraft:birch_trapdoor","minecraft:cherry_trapdoor","minecraft:crimson_trapdoor","minecraft:dark_oak_trapdoor","minecraft:jungle_trapdoor","minecraft:mangrove_trapdoor","minecraft:spruce_trapdoor","minecraft:trapdoor","minecraft:warped_trapdoor"]),E=new x(["minecraft:copper_trapdoor","minecraft:exposed_copper_trapdoor","minecraft:weathered_copper_trapdoor","minecraft:oxidized_copper_trapdoor","minecraft:waxed_copper_trapdoor","minecraft:waxed_exposed_copper_trapdoor","minecraft:waxed_weathered_copper_trapdoor","minecraft:waxed_oxidized_copper_trapdoor"]),B=new x([...D,...E,"minecraft:iron_trapdoor"]),T=new x(["minecraft:acacia_log","minecraft:birch_log","minecraft:cherry_log","minecraft:dark_oak_log","minecraft:jungle_log","minecraft:mangrove_log","minecraft:oak_log","minecraft:spruce_log "]),R=new x(["minecraft:crimson_stem","minecraft:warped_stem"]),N=new x(["minecraft:coal_ore","minecraft:copper_ore","minecraft:deepslate_coal_ore","minecraft:deepslate_copper_ore","minecraft:deepslate_diamond_ore","minecraft:deepslate_emerald_ore","minecraft:deepslate_gold_ore","minecraft:deepslate_iron_ore","minecraft:deepslate_lapis_ore","minecraft:deepslate_redstone_ore","minecraft:diamond_ore","minecraft:emerald_ore","minecraft:gold_ore","minecraft:iron_ore","minecraft:lapis_ore","minecraft:nether_gold_ore","minecraft:quartz_ore","minecraft:redstone_ore"]),$=new x(["minecraft:stone","minecraft:deepslate"]);function O(e){return Math.random()<=e}function V(e){return e>1?e*V(e-1):1}function P(e,t,r){return n=>e**(r-n)*t**n*function(e,t){return V(e)/(V(t)*V(e-t))}(r,n)}function C(e,t,r=1){const n=[];for(let s=e;s<t;s+=r)n.push(s);return n}class j{constructor(...e){this.axes=e}static create(e){return Array.isArray(e)?new this(...e):"string"==typeof e?this.parse(e):void 0}static parse(e){return this.create(e.split(" ").map(Number))}stringify(){return this[Symbol.toPrimitive]("string")}toArray(){return[...this]}[Symbol.toPrimitive](e){return"string"===e?this.axes.join(" "):this}[Symbol.iterator](){return this.axes[Symbol.iterator]()}get dimensions(){return this.axes.length}get(e){return this.axes[e]}set(e,t){this.axes[e]=t}map(e){return j.create(this.axes.map(e))}}class z{static create(e){return j.create(e)}static clone(e){return this.create(e.toArray())}static _assertDimensions(e,t){if(e.dimensions!==t.dimensions)throw new Error("Vectors must have the same dimensions.")}static add(e,t){return z._assertDimensions(e,t),e.map(((e,r)=>e+t.get(r)))}static subtract(e,t){return z._assertDimensions(e,t),e.map(((e,r)=>e-t.get(r)))}static multiply(e,t){return z._assertDimensions(e,t),e.map(((e,r)=>e*t.get(r)))}static divide(e,t){return z._assertDimensions(e,t),e.map(((e,r)=>e/t.get(r)))}static scale(e,t){return e.map((e=>e*t))}static negate(e){return e.map((e=>-e))}static inverse(e){return e.map((e=>1/e))}static exchange(e,t,r){const n=this.clone(e),s=n.get(t),i=n.get(r);return n.set(t,i),n.set(r,s),n}static exactEquals(e,t){return z._assertDimensions(e,t),e.axes.every(((e,r)=>e===t.get(r)))}static equals(e,t){return z._assertDimensions(e,t),e.axes.every(((e,r)=>function(e,t,r=1e-6){return Math.abs(e-t)<=r*Math.max(1,Math.abs(e),Math.abs(t))}(e,t.get(r))))}static max(...e){const t=e[0].dimensions,r=e.reduce(((e,t)=>(t.axes.forEach(((t,r)=>{t>e[r]&&(e[r]=t)})),e)),new Array(t).fill(Number.NEGATIVE_INFINITY));return this.create(r)}static min(...e){const t=e[0].dimensions,r=e.reduce(((e,t)=>(t.axes.forEach(((t,r)=>{t<e[r]&&(e[r]=t)})),e)),new Array(t).fill(Number.POSITIVE_INFINITY));return this.create(r)}static floor(e){return e.map((e=>Math.floor(e)))}static ceil(e){return e.map((e=>Math.ceil(e)))}static round(e){return e.map((e=>{return(t=e)>=0?Math.round(t):t%.5==0?Math.floor(t):Math.round(t);var t}))}static abs(e){return e.map((e=>Math.abs(e)))}static maxMagnitude(...e){return e.reduce(((e,t)=>z.magnitude(t)>z.magnitude(e)?t:e))}static minMagnitude(...e){return e.reduce(((e,t)=>z.magnitude(t)<z.magnitude(e)?t:e))}static magnitude(e){return Math.sqrt(z.squaredMagnitude(e))}static squaredMagnitude(e){return e.axes.reduce(((e,t)=>e+t**2),0)}static distance(e,t){return Math.sqrt(z.squaredDistance(e,t))}static squaredDistance(e,t){return z._assertDimensions(e,t),e.axes.reduce(((e,r,n)=>e+(r-t.get(n))**2),0)}static dot(e,t){return z._assertDimensions(e,t),e.axes.reduce(((e,r,n)=>e+r*t.get(n)),0)}static normalize(e){const t=this.magnitude(e);return t?this.scale(e,1/t):this.create(new Array(e.dimensions).fill(0))}static angle(e,t){const r=this.dot(this.normalize(e),this.normalize(t));return Math.acos(r)}static random(e,t=1){const r=Array.from({length:e},(()=>2*Math.random()-1));return this.scale(this.create(r),t)}static lerp(e,t,r){return z._assertDimensions(e,t),e.map(((e,n)=>e*(1-r)+t.get(n)*r))}static slerp(e,t,r){if(r<=0)return this.clone(e);if(r>=1)return this.clone(t);const n=this.angle(e,t),s=Math.sin(n);if(s<=Number.EPSILON)return this.lerp(e,t,r);const i=Math.sin(n*(1-r))/s,a=Math.sin(n*r)/s;return e.map(((e,r)=>e*i+t.get(r)*a))}static bezier(e,t){const r=e.length-1;if(!r)return e[0];const n=[];for(let s=0;s<r;s++)n.push(this.lerp(e[s],e[s+1],t));return this.bezier(n,t)}}class U extends z{static create(e){return F.create(e)}static cross(e,t){return this.create([e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x])}}class F extends j{constructor(e=0,t=0,r=0){super(e,t,r)}get x(){return this.get(0)}set x(e){this.set(0,e)}get y(){return this.get(1)}set y(e){this.set(1,e)}get z(){return this.get(2)}set z(e){this.set(2,e)}static create(e){return Array.isArray(e)?new this(...e):"string"==typeof e?this.parse(e):"object"==typeof e?new this(e.x,e.y,e.z):void 0}get magnitude(){return U.magnitude(this)}get squaredMagnitude(){return U.squaredMagnitude(this)}get normalized(){return U.normalize(this)}get floored(){return U.floor(this)}get ceiled(){return U.ceil(this)}get rounded(){return U.round(this)}get absoluted(){return U.abs(this)}map(e){return F.create(this.axes.map(e))}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new F(this.x,this.y,this.z)}equals(e){return U.equals(this,e)}distanceTo(e){return U.distance(this,e)}squaredDistanceTo(e){return U.squaredDistance(this,e)}add(e){return this.copy(U.add(this,e))}subtract(e){return this.copy(U.subtract(this,e))}multiply(e){return this.copy(U.multiply(this,e))}divide(e){return this.copy(U.divide(this,e))}scale(e){return this.copy(U.scale(this,e))}negate(){return this.copy(U.negate(this))}inverse(){return this.copy(U.inverse(this))}floor(){return this.copy(this.floored)}ceil(){return this.copy(this.ceiled)}round(){return this.copy(this.rounded)}abs(){return this.copy(this.absoluted)}normalize(){return this.copy(this.normalized)}}class L extends F{get centerCorrected(){return L.create(U.add(this.floored,new F(.5,.5,.5)))}clone(){return new L(this.x,this.y,this.z)}equals(e){return U.exactEquals(this,e)}isNearTo(e,t){return this.distanceTo(e)<=t}offset(e){return this.add(e)}}class W{static getDirectionOffset(e){return L.create({x:e.isEast()?1:e.isWest()?-1:0,y:e.isUp()?1:e.isDown()?-1:0,z:e.isSouth()?1:e.isNorth()?-1:0})}static between(e,t,r=1){const n=[];for(let s=e.x;s<=t.x;s+=r)for(let i=e.y;i<=t.y;i+=r)for(let a=e.z;a<=t.z;a+=r)n.push(new L(s,i,a));return n}}class q extends L{constructor(e,t,r){super(e,t,r),this.floor()}get centerCorrected(){throw new Error('Couldn\'t get "centerCorrected" on BlockLocation.')}clone(){return new q(this.x,this.y,this.z)}divide(e){return super.divide(e),this.floor()}inverse(){throw new Error('Couldn\'t call "inverse" on BlockLocation.')}between(e){return W.between(this,e)}}function H(t){return new Promise(((r,n)=>{e.run((()=>{try{r(t())}catch(e){n(e)}}))}))}function K(e,t){const r=new Error(e);return t.sendMessage(r.toString()),r}function G(e,r){const n=t.scoreboard.getObjective(e);if(!n&&!r)throw new Error(`Couldn't find objective "${e}".`);return n||t.scoreboard.addObjective(e,r)}function J(e){return e.replace(/^minecraft\:/,"")}class X{constructor({location:e,dimension:n}){this.location=e instanceof L?e:L.create(e),this.dimension=n instanceof r?n:t.getDimension(n)}textify(){return{location:`${this.location}`,dimension:this.dimension.id}}[Symbol.toPrimitive](e){return"string"===e?`${J(this.dimension.id)}: ${this.location}`:this}}class Y{constructor(e){this.code=e}get name(){switch(this.code){case 0:return"East";case 1:return"South";case 2:return"Up";case 3:return"West";case 4:return"North";case 5:return"Down"}}isEast(){return 0===this.code}isSouth(){return 1===this.code}isUp(){return 2===this.code}isWest(){return 3===this.code}isNorth(){return 4===this.code}isDown(){return 5===this.code}equals(e){return this.code===e.code}getOpposite(){const e=this.code+3;return new Y(e>=6?e-6:e)}isOppositeTo(e){return 3===Math.abs(this.code-e.code)}}class Z{static East=new Y(0);static South=new Y(1);static Up=new Y(2);static West=new Y(3);static North=new Y(4);static Down=new Y(5)}class Q{static wrap(...e){return new this(...e)}static tryWrap(...e){try{return new this(...e)}catch(e){}}static match(){throw new Error("Not implemented.")}static assert(){throw new Error("Not implemented.")}}const ee=new x(["minecraft:diamond_pickaxe","minecraft:netherite_pickaxe"]),te=new x([...ee,"minecraft:iron_pickaxe"]),re=new x([...te,"minecraft:stone_pickaxe"]),ne=new x([...re,"minecraft:golden_pickaxe","minecraft:wooden_pickaxe"]);class se extends Q{constructor(e){super(),this._item=e,this.type=e.type,this.typeId=e.typeId;b(e.getComponents(),(e=>{this.components.set(J(e.typeId),e)}))}components=new Map;hasComponent(e){return this._item.hasComponent(e)}get enchants(){return this.components.get("enchantable")}}class ie extends se{constructor(e){if(!ie.match(e))throw new TypeError(`The "${e.typeId}" doesn't have the "minecraft:durability" component.`);super(e)}static match(e){return e.hasComponent("minecraft:durability")}get damage(){return this.components.get("durability").damage}set damage(e){this.components.get("durability").damage=e<0?0:e}get maxDurability(){return this.components.get("durability").maxDurability}get durability(){return this.maxDurability-this.damage}set durability(e){this.damage+=this.durability-e}applyDamage(e){const t=this.enchants.hasEnchantment("unbreaking"),r=this.components.get("durability").getDamageChance(t)/100;for(let t=0;t<e;t++)O(r)&&(this.durability-=1);return this}}var ae={acacia_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:acacia_log"}}]},amethyst_block:{drops:[{dig_by:ne.toArray(),raw:{item_id:"minecraft:amethyst_block"}}]},amethyst_cluster:{drops:[{dig_by:ne.toArray(),raw:{item_id:"minecraft:amethyst_shard",default_range:[4,4]},fortune_rule:"ore"},{dig_by:"<default>",raw:{item_id:"minecraft:amethyst_shard",default_range:[2,2]}}]},ancient_debris:{drops:[{dig_by:ee.toArray(),raw:{item_id:"minecraft:ancient_debris"},refined:{item_id:"minecraft:netherite_scrap"}}]},birch_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:birch_log"}}]},cherry_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:cherry_log"}}]},coal_ore:{drops:[{dig_by:ne.toArray(),raw:{item_id:"minecraft:coal",xp_range:[0,2]},fortune_rule:"ore"}]},copper_ore:{drops:[{dig_by:re.toArray(),raw:{item_id:"minecraft:raw_copper",default_range:[2,5]},refined:{item_id:"minecraft:copper_ingot"},fortune_rule:"ore"}]},crimson_stem:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:crimson_stem"}}]},dark_oak_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:dark_oak_log"}}]},deepslate:{drops:[{dig_by:ne.toArray(),raw:{item_id:"minecraft:cobbled_deepslate"}}]},deepslate_coal_ore:{drops:[{dig_by:ne.toArray(),raw:{item_id:"minecraft:coal",xp_range:[0,2]},fortune_rule:"ore"}]},deepslate_copper_ore:{drops:[{dig_by:re.toArray(),raw:{item_id:"minecraft:raw_copper",default_range:[2,5]},refined:{item_id:"minecraft:copper_ingot"},fortune_rule:"ore"}]},deepslate_diamond_ore:{drops:[{dig_by:te.toArray(),raw:{item_id:"minecraft:diamond",xp_range:[3,7]},fortune_rule:"ore"}]},deepslate_emerald_ore:{drops:[{dig_by:te.toArray(),raw:{item_id:"minecraft:emerald",xp_range:[3,7]},fortune_rule:"ore"}]},deepslate_gold_ore:{drops:[{dig_by:te.toArray(),raw:{item_id:"minecraft:raw_gold"},refined:{item_id:"minecraft:gold_ingot"},fortune_rule:"ore"}]},deepslate_iron_ore:{drops:[{dig_by:re.toArray(),raw:{item_id:"minecraft:raw_iron"},refined:{item_id:"minecraft:iron_ingot"},fortune_rule:"ore"}]},deepslate_lapis_ore:{drops:[{dig_by:re.toArray(),raw:{item_id:"minecraft:lapis_lazuli",default_range:[4,9],xp_range:[2,5]},fortune_rule:"ore"}]},deepslate_redstone_ore:{drops:[{dig_by:te.toArray(),raw:{item_id:"minecraft:redstone",default_range:[4,5],xp_range:[1,5]},fortune_rule:"melon"}]},diamond_ore:{drops:[{dig_by:te.toArray(),raw:{item_id:"minecraft:diamond",xp_range:[3,7]},fortune_rule:"ore"}]},emerald_ore:{drops:[{dig_by:te.toArray(),raw:{item_id:"minecraft:emerald",xp_range:[3,7]},fortune_rule:"ore"}]},gold_ore:{drops:[{dig_by:te.toArray(),raw:{item_id:"minecraft:raw_gold"},refined:{item_id:"minecraft:gold_ingot"},fortune_rule:"ore"}]},iron_ore:{drops:[{dig_by:re.toArray(),raw:{item_id:"minecraft:raw_iron"},refined:{item_id:"minecraft:iron_ingot"},fortune_rule:"ore"}]},jungle_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:jungle_log"}}]},lapis_ore:{drops:[{dig_by:re.toArray(),raw:{item_id:"minecraft:lapis_lazuli",default_range:[4,9],xp_range:[2,5]},fortune_rule:"ore"}]},mangrove_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:mangrove_log"}}]},nether_gold_ore:{drops:[{dig_by:ne.toArray(),raw:{item_id:"minecraft:gold_nugget",default_range:[2,6],xp_range:[0,1]},refined:{item_id:"minecraft:gold_ingot"},fortune_rule:"ore"}]},oak_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:oak_log"}}]},obsidian:{drops:[{dig_by:ee.toArray(),raw:{item_id:"minecraft:obsidian"}}]},quartz_ore:{drops:[{dig_by:ne.toArray(),raw:{item_id:"minecraft:quartz",xp_range:[2,5]},fortune_rule:"ore"}]},redstone_ore:{drops:[{dig_by:te.toArray(),raw:{item_id:"minecraft:redstone",default_range:[4,5],xp_range:[1,5]},fortune_rule:"melon"}]},spruce_log:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:spruce_log"}}]},stone:{drops:[{dig_by:ne.toArray(),raw:{item_id:"minecraft:cobblestone"},refined:{item_id:"minecraft:smooth_stone"}}]},warped_stem:{drops:[{dig_by:"<default>",raw:{item_id:"minecraft:warped_stem"}}]}};class oe{constructor(e,t,r=1){this.min=e,this.max=t,this.step=r}toArray(){return C(this.min,this.max+this.step,this.step)}get array(){return this.toArray()}includes(e){return this.array.includes(e)}[Symbol.iterator](){return this.array.values()}}class ce{constructor(e){e&&b(e,(e=>{"number"==typeof e?this.addItem({weight:1,value:e}):this.addItem(e)}))}table=new Set;totalWeight=0;addItem(e){this.table.add(e),this.totalWeight+=e.weight}getResult(){let e=0;for(const{weight:t,value:r}of this.table){if(O(t/(this.totalWeight-e)))return r;e+=t}}[Symbol.iterator](){return this.table[Symbol.iterator]()}}class le{constructor({item_id:e,default_range:t=[1,1],max_amount:r=Number.POSITIVE_INFINITY,xp_range:n=[0,0],damage:s=1}={}){this.itemId=e,this.range=new oe(...t),this.amountLootTable=new ce(this.range.toArray()),this.maxAmount=r,this.xpRange=new oe(...n),this.damage=s}getResult(){return[{itemId:this.itemId,amount:Math.min(this.amountLootTable.getResult(),this.maxAmount),xp:new ce(this.xpRange.toArray()).getResult(),damage:this.damage}]}}class de{constructor(e){this.items=e.map((e=>new le(e)))}getResult(){const e=[];return b(this.items,(t=>e.push(...t.getResult()))),e}}const he="ore",ue="melon",me="grass",pe="flower",ge="crop",fe="custom";class _e{constructor(e,t){const r=J(e),n=ae[r]?.drops;if(!n)throw new Error(`Block ${r} has not been supported.`);this.blockTypeId=e,this.drops=n,t&&this.setItemUse(t)}setItemUse(e="<empty>"){const t=this.drops.find((t=>{const r=t.dig_by;return Array.isArray(r)?r.includes(e):"string"==typeof r?r===e:void 0}))??this.drops.find((e=>"<default>"===e.dig_by));if(!t)return!1;if(this.blockItem=new le({item_id:n.resolve(this.blockTypeId).getItemStack()?.typeId}),this.rawResource=new le(t.raw)??this.blockItem,this.refinedResource=new le(t.refined),this.seendResource=new le(t.seed)??this.rawResource,this.immatureResource=new le(t.immature)??this.seendResource,this.fortuneRule=t.fortune_rule,this.fortuneRule===fe&&(this.custumLootTable=t.option?.custom,!this.custumLootTable))throw new Error("You must provide a custom loot table for the custom fortune rule.");return!0}getDrops({withFortune:e=0,withSilkTouch:t=!1,immature:r=!1}={}){if(e&&t)throw new Error("Could not call with both fortune and silk_touch.");if(r)return this.immatureResource.getResult();if(t)return this.blockItem.getResult();if(0===e||!this.fortuneRule)return this.rawResource.getResult();{const t=e;switch(this.fortuneRule){case he:{const e=this.rawResource.getResult()[0],r=new ce([...C(2,t+2),{weight:2,value:1}]);return e.amount*=r.getResult(),[e]}case ue:{const e=this.rawResource.getResult()[0],r=new ce([...this.rawResource.amountLootTable,...C(1,t+1).map((e=>({weight:1,value:Math.min(this.rawResource.maxAmount,this.rawResource.range.max+e)})))]);return e.amount=r.getResult(),[e]}case me:{const e=this.rawResource.getResult()[0];if(0===e.amount)return[e];const r=new ce(C(1,2*t+2));return e.amount=r.getResult(),[e]}case pe:{const e=this.rawResource.getResult()[0],r=new ce(C(1,2*t+2));return e.amount=r.getResult(),[e]}case ge:{const e=this.rawResource.getResult()[0],r=P(1-(n=4/7),n,t+3),s=new ce(C(0,t+4).map((e=>({weight:r(e),value:e}))));return[e,{itemId:this.seendResource.itemId,amount:s.getResult()}]}case fe:{const e=new ce(this.custumLootTable[t]);return new de(e.getResult()).getResult()}}}var n}}class ye extends Q{constructor(e){super(),this._block=e,this.type=e.type,this.typeId=e.typeId,this.location=q.create(e.location),this.dimension=e.dimension,this.permutation=e.permutation}getOffsetBlock(e){const t=this.location.clone().offset(e);return new ye(this.dimension.getBlock(t))}getNeighbourBlock(e){const t=W.getDirectionOffset(e);return this.getOffsetBlock(t)}getState(e){return this.permutation.getState(e)}hasState(e){return!!this.getState(e)}setState(e,t){const r=this.permutation.getAllStates();r[e]=t,this._block.setPermutation(n.resolve(this.typeId,r))}canBeDugBy(e="<empty>"){return new _e(this.typeId).setItemUse(e)}destroy(){this.dimension.fillBlocks(new s(this.location,this.location),n.resolve("minecraft:air"))}breakBy(e){const t=new _e(this.typeId,e?.typeId??"<empty>");this.destroy();const r=(()=>{if(e){const r=e instanceof se?e:new se(e);return t.getDrops({withFortune:r.enchants.hasEnchantment("fortune")?r.enchants.getEnchantment("fortune").level:0,withSilkTouch:r.enchants.hasEnchantment("silk_touch")})}return t.getDrops()})();return{drops:r,spawnDrops:()=>{b(r,(e=>{for(this.dimension.spawnItem(new i(e.itemId,e.amount),this.location);e.xp--;)this.dimension.spawnEntity("minecraft:xp_orb",this.location)}))},getTotalDamage:()=>{let e=0;return b(r,(t=>{t.damage&&(e+=t.damage)})),e}}}}class we extends Q{constructor(e){super(),this._blocks=(Array.isArray(e)?e:[e]).map((e=>e instanceof ye?e:new ye(e)))}get _block(){return this._blocks[0]}get type(){return this._block.type}get typeId(){return this._block.typeId}get location(){return this._block.location}get dimension(){return this._block.dimension}get permutation(){return this._block.permutation}}class be{constructor(e){e&&this.add(...e)}blocks=[];get size(){return this.blocks.length}add(...e){b(e,(e=>{this.has(e)||this.blocks.push(e)}))}has(e){return this.blocks.some((({location:t})=>U.exactEquals(t,e.location)))}shift(){return this.blocks.shift()}[Symbol.iterator](){return this.blocks.values()}}class ve extends we{constructor(e){ve.assert(e);const t=e instanceof ye?e:new ye(e),r=t.getState("upper_block_bit");super([r?t.getNeighbourBlock(Z.Down):t,r?t:t.getNeighbourBlock(Z.Up)])}static match(e){return M.has(e?.typeId)}static assert(e){if(ve.match(e))return!0;throw new TypeError(`The "${e.typeId}" is not a door.`)}get _lower(){return this._blocks[0]}get _upper(){return this._blocks[1]}get opened(){return this._lower.getState("open_bit")}get facingDirection(){switch(this._lower.getState("direction")){case 0:return Z.East;case 1:return Z.South;case 2:return Z.West;case 3:return Z.North;default:throw new Error("Unkonw error.")}}get hingeSide(){return this._upper.getState("door_hinge_bit")}isWooden(){return S.has(this.typeId)}isCopper(){return A.has(this.typeId)}isIron(){return!this.canBeOpenedByHand()}canBeOpenedByHand(){return this.isWooden()||this.isCopper()}open(){this._lower.setState("open_bit",!0)}close(){this._lower.setState("open_bit",!1)}getRelated({shouldBeTheSameType:e=!0}={}){const t=[this],r=this.facingDirection,n=this.hingeSide,s=q.create({x:Number(r.isSouth()?n||-1:r.isNorth()?!n||-1:0),y:0,z:Number(r.isEast()?!n||-1:r.isWest()?n||-1:0)}),i=this._lower.getOffsetBlock(s);if(ve.match(i)){const s=new ve(i);!s.canBeOpenedByHand()||e&&s.typeId!==this.typeId||s.facingDirection.code!==r.code||s.hingeSide!==!n||t.push(s)}return t}}class Ie extends Q{components=new Map;constructor(e){super(),this._entity=e,this.id=e.id,this.typeId=e.typeId,this.scoreboardIdentity=e.scoreboardIdentity;b(e.getComponents(),(e=>{this.components.set(J(e.typeId),e)}))}get nameTag(){return this._entity.nameTag}get location(){return L.create(this._entity.location)}get dimension(){return this._entity.dimension}get isSneaking(){return this._entity.isSneaking}getRotation(){return this._entity.getRotation()}getFacingDirectionXZ(){const e=this.getRotation().y;return e>-135&&e<=-45?Z.East:e>-45&&e<=45?Z.South:e>45&&e<=135?Z.West:e>135||e<=-135?Z.North:void 0}}const ke=t.getDimension(a.overworld),xe=new Set;class Se{static run(e,t=ke){if(t instanceof r||t instanceof o)return t.runCommand(e);throw new TypeError("Target must be Entity or Dimension.")}static async asyncRun(e,t=ke){if(!(t instanceof r||t instanceof o))throw new TypeError("Target must be Entity or Dimension.");{const r=[...xe].filter((({regex:t})=>t.test(e))).map((e=>e.runner));if(!r.length)return await t.runCommandAsync(e);await v(r,(async r=>await r(e,t)))}}static register(e,r,n){if(e.startsWith("/"))throw new Error("Unable to register slash commands.");const s=new RegExp(`^${e}${r}( |$)`),i=async(e,t)=>{const r=e.split(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g).filter((e=>e.trim().length>0));await n(r,t)};xe.add({regex:s,runner:i}),t.beforeEvents.chatSend.subscribe((e=>{s.test(e.message)&&(e.cancel=!0,i(e.message,e.sender).catch(w.error))}))}}class Ae extends Q{constructor(e){super(),this._container=e}get size(){return this._container.size}get emptySlotsCount(){return this._container.emptySlotsCount}getItem(e){return this._container.getItem(e)}setItem(e,t){return this._container.setItem(e,t)}tryAddItem(e){return this._container.addItem(e)}}class Me extends Ae{constructor(e,t){super(t),this._entity=e}get location(){return this._entity.location}get dimension(){return this._entity.dimension}addItem(e){const t=this.tryAddItem(e);t&&this.dimension.spawnItem(t,this.location)}}class De extends Ie{constructor(e){super(e),this.name=e.name}static match(e){return"minecraft:player"===e.typeId}get _player(){return this._entity}get experience(){return this.addExperience(0)}get level(){return this._player.level}get inventory(){return new Me(this,this.components.get("inventory").container)}get selectedSlotIndex(){return this._player.selectedSlotIndex}getGameMode(){const e=[];return b(c,(t=>{this.testGameMode(t)&&e.push(t)})),e[0]}testGameMode(e){return this.dimension.getPlayers({gameMode:e}).some((e=>e.id===this.id))}setGameMode(e){if(!Object.values(c).includes(e))throw new TypeError("Unknown gamemode.");Se.run(`gamemode ${e}`,this._player)}getMainHandItem(){return this.inventory.getItem(this.selectedSlotIndex)}setMainHandItem(e){this.inventory.setItem(this.selectedSlotIndex,e)}async useItemFromInventory(e,t=(async e=>{})){let r=this.inventory.getItem(e);r=await t(r),this.inventory.setItem(e,r)}async useMainHandItem(e=(async()=>{})){await this.useItemFromInventory(this.selectedSlotIndex,e)}addExperience(e=0,{useXpOrb:t=!1}={}){if(t&&e>=0){for(;e--;)this.dimension.spawnEntity("minecraft:xp_orb",this.location);return this.experience}return this._player.addExperience(e)}addLevels(e=0){return this._player.addLevels(e)}}class Ee extends ye{constructor(e){Ee.assert(e),super(e)}static match(e){return B.has(e?.typeId)}static assert(e){if(Ee.match(e))return!0;throw new TypeError(`The "${e.typeId}" is not a trapdoor.`)}get opened(){return this.getState("open_bit")}get facingDirection(){switch(this.getState("direction")){case 0:return Z.East;case 2:return Z.South;case 1:return Z.West;case 3:return Z.North;default:throw new Error("Unkonw error.")}}get upsideOrDown(){return this.getState("upside_down_bit")}isWooden(){return D.has(this.typeId)}isCopper(){return E.has(this.typeId)}isIron(){return!this.canBeOpenedByHand()}canBeOpenedByHand(){return this.isWooden()||this.isCopper()}open(){this.setState("open_bit",!0)}close(){this.setState("open_bit",!1)}getRelated(e,{extensive:t=!0,maxLength:r=1,shouldBeTheSameType:n=!0}={}){const s=[this];if(r>0){const e=this.getNeighbourBlock(this.facingDirection);if(Ee.match(e)){const t=new Ee(e._block);!t.canBeOpenedByHand()||n&&t.typeId!==this.typeId||!t.facingDirection.isOppositeTo(this.facingDirection)||t.upsideOrDown!==this.upsideOrDown||s.push(t)}}if(t){let t=this,i=!1;for(;--r;){const a=De.wrap(e).getFacingDirectionXZ(),o=i?t.getNeighbourBlock(a.getOpposite()):t.getNeighbourBlock(a);if(Ee.match(o)){const i=new Ee(o._block);if(i.canBeOpenedByHand()&&(!n||i.typeId===this.typeId)&&i.facingDirection.equals(this.facingDirection)&&i.upsideOrDown===this.upsideOrDown){const n=i.getRelated(e,{extensive:!1,maxLength:r});if(n.length>1){s.push(...n),t=i;continue}}}if(i)break;i=!0,t=this,r++}}return s}}class Be{static async confirm({title:e="确认",body:t,target:r,onCancel:n=(async()=>{}),onConfirm:s=(async()=>{})}){if(!t||!r)throw new Error;const i=await H((()=>new Be({dialog:(new u).title(e).body(t).button1("CANCEL").button2("OK"),onClose:n,onSelectButton1:n,onSelectButton2:s})));return await i.show(r)}constructor({dialog:e,onClose:t=(async()=>{}),onSubmit:r=(async e=>{}),onSelectButton1:n=(async()=>{}),onSelectButton2:s=(async()=>{}),onSelect:i=(async e=>{})}){this.dialog=e,this.onSubmit=r,this.onSelectButton1=n,this.onSelectButton2=s,this.onSelect=i,this.onClose=t}async show(e){let t;e.sendMessage("[!] 新对话框已发送，请关闭命令输入栏或其他对话框");do{t=await this.dialog.show(e)}while(t.cancelationReason===m.UserBusy);if(t.canceled&&t.cancelationReason===m.UserClosed)return await this.onClose();if(t instanceof p)return await this.onSubmit(t.formValues);if(t instanceof g){if(0===t.selection)return await this.onSelectButton1();if(1===t.selection)return await this.onSelectButton2()}else if(t instanceof f)return await this.onSelect(t.selection);return t}}function Te(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Re,Ne,$e={exports:{}},Oe={exports:{}};Re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ne={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&Ne.rotl(e,8)|4278255360&Ne.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=Ne.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var t=[],r=0;r<e.length;r+=3)for(var n=e[r]<<16|e[r+1]<<8|e[r+2],s=0;s<4;s++)8*r+6*s<=8*e.length?t.push(Re.charAt(n>>>6*(3-s)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var t=[],r=0,n=0;r<e.length;n=++r%4)0!=n&&t.push((Re.indexOf(e.charAt(r-1))&Math.pow(2,-2*n+8)-1)<<2*n|Re.indexOf(e.charAt(r))>>>6-2*n);return t}},Oe.exports=Ne;var Ve=Oe.exports,Pe={utf8:{stringToBytes:function(e){return Pe.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(Pe.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}},Ce=Pe,je=function(e){return null!=e&&(ze(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&ze(e.slice(0,0))}(e)||!!e._isBuffer)};function ze(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}!function(){var e=Ve,t=Ce.utf8,r=je,n=Ce.bin,s=function(i,a){i.constructor==String?i=a&&"binary"===a.encoding?n.stringToBytes(i):t.stringToBytes(i):r(i)?i=Array.prototype.slice.call(i,0):Array.isArray(i)||i.constructor===Uint8Array||(i=i.toString());for(var o=e.bytesToWords(i),c=8*i.length,l=1732584193,d=-271733879,h=-1732584194,u=271733878,m=0;m<o.length;m++)o[m]=16711935&(o[m]<<8|o[m]>>>24)|4278255360&(o[m]<<24|o[m]>>>8);o[c>>>5]|=128<<c%32,o[14+(c+64>>>9<<4)]=c;var p=s._ff,g=s._gg,f=s._hh,_=s._ii;for(m=0;m<o.length;m+=16){var y=l,w=d,b=h,v=u;l=p(l,d,h,u,o[m+0],7,-680876936),u=p(u,l,d,h,o[m+1],12,-389564586),h=p(h,u,l,d,o[m+2],17,606105819),d=p(d,h,u,l,o[m+3],22,-1044525330),l=p(l,d,h,u,o[m+4],7,-176418897),u=p(u,l,d,h,o[m+5],12,1200080426),h=p(h,u,l,d,o[m+6],17,-1473231341),d=p(d,h,u,l,o[m+7],22,-45705983),l=p(l,d,h,u,o[m+8],7,1770035416),u=p(u,l,d,h,o[m+9],12,-1958414417),h=p(h,u,l,d,o[m+10],17,-42063),d=p(d,h,u,l,o[m+11],22,-1990404162),l=p(l,d,h,u,o[m+12],7,1804603682),u=p(u,l,d,h,o[m+13],12,-40341101),h=p(h,u,l,d,o[m+14],17,-1502002290),l=g(l,d=p(d,h,u,l,o[m+15],22,1236535329),h,u,o[m+1],5,-165796510),u=g(u,l,d,h,o[m+6],9,-1069501632),h=g(h,u,l,d,o[m+11],14,643717713),d=g(d,h,u,l,o[m+0],20,-373897302),l=g(l,d,h,u,o[m+5],5,-701558691),u=g(u,l,d,h,o[m+10],9,38016083),h=g(h,u,l,d,o[m+15],14,-660478335),d=g(d,h,u,l,o[m+4],20,-405537848),l=g(l,d,h,u,o[m+9],5,568446438),u=g(u,l,d,h,o[m+14],9,-1019803690),h=g(h,u,l,d,o[m+3],14,-187363961),d=g(d,h,u,l,o[m+8],20,1163531501),l=g(l,d,h,u,o[m+13],5,-1444681467),u=g(u,l,d,h,o[m+2],9,-51403784),h=g(h,u,l,d,o[m+7],14,1735328473),l=f(l,d=g(d,h,u,l,o[m+12],20,-1926607734),h,u,o[m+5],4,-378558),u=f(u,l,d,h,o[m+8],11,-2022574463),h=f(h,u,l,d,o[m+11],16,1839030562),d=f(d,h,u,l,o[m+14],23,-35309556),l=f(l,d,h,u,o[m+1],4,-1530992060),u=f(u,l,d,h,o[m+4],11,1272893353),h=f(h,u,l,d,o[m+7],16,-155497632),d=f(d,h,u,l,o[m+10],23,-1094730640),l=f(l,d,h,u,o[m+13],4,681279174),u=f(u,l,d,h,o[m+0],11,-358537222),h=f(h,u,l,d,o[m+3],16,-722521979),d=f(d,h,u,l,o[m+6],23,76029189),l=f(l,d,h,u,o[m+9],4,-640364487),u=f(u,l,d,h,o[m+12],11,-421815835),h=f(h,u,l,d,o[m+15],16,530742520),l=_(l,d=f(d,h,u,l,o[m+2],23,-995338651),h,u,o[m+0],6,-198630844),u=_(u,l,d,h,o[m+7],10,1126891415),h=_(h,u,l,d,o[m+14],15,-1416354905),d=_(d,h,u,l,o[m+5],21,-57434055),l=_(l,d,h,u,o[m+12],6,1700485571),u=_(u,l,d,h,o[m+3],10,-1894986606),h=_(h,u,l,d,o[m+10],15,-1051523),d=_(d,h,u,l,o[m+1],21,-2054922799),l=_(l,d,h,u,o[m+8],6,1873313359),u=_(u,l,d,h,o[m+15],10,-30611744),h=_(h,u,l,d,o[m+6],15,-1560198380),d=_(d,h,u,l,o[m+13],21,1309151649),l=_(l,d,h,u,o[m+4],6,-145523070),u=_(u,l,d,h,o[m+11],10,-1120210379),h=_(h,u,l,d,o[m+2],15,718787259),d=_(d,h,u,l,o[m+9],21,-343485551),l=l+y>>>0,d=d+w>>>0,h=h+b>>>0,u=u+v>>>0}return e.endian([l,d,h,u])};s._ff=function(e,t,r,n,s,i,a){var o=e+(t&r|~t&n)+(s>>>0)+a;return(o<<i|o>>>32-i)+t},s._gg=function(e,t,r,n,s,i,a){var o=e+(t&n|r&~n)+(s>>>0)+a;return(o<<i|o>>>32-i)+t},s._hh=function(e,t,r,n,s,i,a){var o=e+(t^r^n)+(s>>>0)+a;return(o<<i|o>>>32-i)+t},s._ii=function(e,t,r,n,s,i,a){var o=e+(r^(t|~n))+(s>>>0)+a;return(o<<i|o>>>32-i)+t},s._blocksize=16,s._digestsize=16,$e.exports=function(t,r){if(null==t)throw new Error("Illegal argument "+t);var i=e.wordsToBytes(s(t,r));return r&&r.asBytes?i:r&&r.asString?n.bytesToString(i):e.bytesToHex(i)}}();var Ue=Te($e.exports),Fe=function(e){null==e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,e.constructor==Array?this.init_by_array(e,e.length):this.init_seed(e)};Fe.prototype.init_seed=function(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<this.N;this.mti++){e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}},Fe.prototype.init_by_array=function(e,t){var r,n,s;for(this.init_seed(19650218),r=1,n=0,s=this.N>t?this.N:t;s;s--){var i=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1664525*((4294901760&i)>>>16)<<16)+1664525*(65535&i))+e[n]+n,this.mt[r]>>>=0,n++,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1),n>=t&&(n=0)}for(s=this.N-1;s;s--){i=this.mt[r-1]^this.mt[r-1]>>>30;this.mt[r]=(this.mt[r]^(1566083941*((4294901760&i)>>>16)<<16)+1566083941*(65535&i))-r,this.mt[r]>>>=0,++r>=this.N&&(this.mt[0]=this.mt[this.N-1],r=1)}this.mt[0]=2147483648},Fe.prototype.random_int=function(){var e,t=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var r;for(this.mti==this.N+1&&this.init_seed(5489),r=0;r<this.N-this.M;r++)e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+this.M]^e>>>1^t[1&e];for(;r<this.N-1;r++)e=this.mt[r]&this.UPPER_MASK|this.mt[r+1]&this.LOWER_MASK,this.mt[r]=this.mt[r+(this.M-this.N)]^e>>>1^t[1&e];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0},Fe.prototype.random_int31=function(){return this.random_int()>>>1},Fe.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},Fe.prototype.random=function(){return this.random_int()*(1/4294967296)},Fe.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},Fe.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)};var Le=new Fe(Math.random()*Number.MAX_SAFE_INTEGER);var We=Te((function(e){var t=e.length;for(;t--;)e[t]=Math.floor(256*Le.random());return e}));const qe=function(){const e=(t=16,We(new Uint8Array(t)));var t;let r="";for(let t=0;t<16;++t)r+=e[t].toString(16);return r}(),He=new RegExp(`(\\\\)?"@__(F|R|D|M|S|A|U|I|B|L)-${qe}-(\\d+)__@"`,"g"),Ke=/\{\s*\[native code\]\s*\}/g,Ge=/function.*?\(/,Je=/.*?=>.*?/,Xe=/[<>\/\u2028\u2029]/g,Ye=["*","async"],Ze={"<":"\\u003C",">":"\\u003E","/":"\\u002F","\u2028":"\\u2028","\u2029":"\\u2029"};function Qe(e){return Ze[e]}function et(e,t){t||(t={}),"number"!=typeof t&&"string"!=typeof t||(t={space:t});const r=[],n=[],s=[],i=[],a=[],o=[],c=[],l=[];if(t.ignoreFunction&&"function"==typeof e&&(e=void 0),void 0===e)return String(e);let d;return d=t.isJSON&&!t.space?JSON.stringify(e):JSON.stringify(e,t.isJSON?null:function(e,d){if(t.ignoreFunction&&function(e){const t=[];for(const r in e)"function"==typeof e[r]&&t.push(r);for(let r=0;r<t.length;r++)delete e[t[r]]}(d),!d&&void 0!==d)return d;const h=this[e],u=typeof h;if("object"===u){if(h instanceof RegExp)return`@__R-${qe}-${n.push(h)-1}__@`;if(h instanceof Date)return`@__D-${qe}-${s.push(h)-1}__@`;if(h instanceof Map)return`@__M-${qe}-${i.push(h)-1}__@`;if(h instanceof Set)return`@__S-${qe}-${a.push(h)-1}__@`;if(Array.isArray(h)&&h.filter((()=>!0)).length!==h.length)return`@__A-${qe}-${o.push(h)-1}__@`}return"function"===u?`@__F-${qe}-${r.push(h)-1}__@`:"undefined"===u?`@__U-${qe}-${c.push(h)-1}__@`:"number"!==u||Number.isNaN(h)||Number.isFinite(h)?d:`@__I-${qe}-${l.push(h)-1}__@`},t.space),"string"!=typeof d?String(d):(!0!==t.unsafe&&(d=d.replace(Xe,Qe)),0===r.length&&0===n.length&&0===s.length&&0===i.length&&0===a.length&&0===o.length&&0===c.length&&0===l.length?d:d.replace(He,((e,c,d,h)=>{if(c)return e;if("D"===d)return`new Date("${s[h].toISOString()}")`;if("R"===d)return`new RegExp(${et(n[h].source)}, "${n[h].flags}")`;if("M"===d)return`new Map(${et(Array.from(i[h].entries()),t)})`;if("S"===d)return`new Set(${et(Array.from(a[h].values()),t)})`;if("A"===d)return`Array.prototype.slice.call(${et(Object.assign({length:o[h].length},o[h]),t)})`;if("U"===d)return"undefined";if("I"===d)return l[h];return function(e){const t=e.toString();if(Ke.test(t))throw new TypeError(`Serializing native function: ${e.name}`);if(Ge.test(t))return t;if(Je.test(t))return t;const r=t.indexOf("("),n=t.substr(0,r).trim().split(" ").filter((e=>e.length>0));return n.filter((e=>-1===Ye.indexOf(e))).length>0?`${n.indexOf("async")>-1?"async ":""}function${n.join("").indexOf("*")>-1?"*":""}${t.substr(r)}`:t}(r[h])})))}const tt=new Map;class rt{static open(e,t){return new rt(e,t)}constructor(e,t){const r=Ue(`db:${t}_${e.id}`).slice(8,24);this.id=r,this.objective=G(r,`db:${t}`),this._syncDataFromScoreboard(),tt.set(r,this)}store=new Map;_syncDataFromScoreboard(){this.store.clear(),b(this.objective.getParticipants(),(e=>{const t=I(e.displayName),r=Object.keys(t)[0],n=t[r];this.store.set(r,{value:n,participant:e})}))}has(e){return this.store.has(e)}async delete(e){if(this.has(e)){const{participant:t}=this.store.get(e);return await H((()=>this.objective.removeParticipant(t))),this.store.delete(e),!0}return!1}async clear(){await v(this.store,(async([,{participant:e}])=>await H((()=>this.objective.removeParticipant(e))))),this.store.clear()}get(e){if(this.has(e))return this.store.get(e).value}async set(e,t){await this.delete(e);const r=et({[e]:t}).replaceAll('"',"'");if(r.length>32767)throw new RangeError("Database: Only accepts a string value less than 32767 characters.");await H((()=>this.objective.setScore(r,1))),this._syncDataFromScoreboard()}getAll(){const e={};for(const[t,r]of this)e[t]=r;return e}*entries(){for(const[e,{value:t}]of this.store.entries())yield[e,t]}*keys(){for(const e of this.store.keys())yield e}*values(){for(const{value:e}of this.store.values())yield e}[Symbol.iterator](){return this.entries()}}class nt{constructor(){this._events={}}on(e,t){if(k(t)){const r=`${e}.async`;this._events[r]?this._events[r].push(t):this._events[r]=[t]}else this._events[e]?this._events[e].push(t):this._events[e]=[t];return this}once(e,t){if(k(t)){const r=`${e}.async`,n=async(...e)=>{await t(...e),this.removeListener(r,n)};this._events[r]?this._events[r].push(n):this._events[r]=[n]}else{const r=(...n)=>{t(...n),this.removeListener(e,r)};this._events[e]?this._events[e].push(r):this._events[e]=[r]}return this}removeListener(e,t){if(this._events[e]){const r=[];b(this._events[e],(e=>{e!==t&&r.push(e)})),this._events[e]=r}return this}async emit(e,...t){this._events[e]&&b(this._events[e],(e=>e(...t))),await this.asyncEmit(e,...t)}async asyncEmit(e,...t){const r=`${e}.async`;this._events[r]&&await v(this._events[r],(async e=>await e(...t)))}addListener(e,t){return this.on(e,t)}off(e,t){return this.removeListener(e,t)}}class st{constructor({name:e,description:t,range:r=[0,1,1],defaultValue:n,events:s,reload:i,_player:a}){this.name=e,this.description=t,this.range=new oe(...r),this.events=new nt,this.reload=i,this._defaultValue=n,this._player=a,s&&b(s,((e,t)=>this.events.on(t,e))),void 0!==n&&this._includes(n)?this.selected=n:this.selected=this.range.min,this.events.emit("inited",this.selected,a),this.events.emit("changed",this.selected,void 0,a)}select(e){return!(this.selected===e||!this._includes(e))&&(this.original=this.selected,this.selected=e,this.events.emit("selected",this.selected,this.original,this._player),this.events.emit("changed",this.selected,this.original,this._player),!0)}_includes(e){return this.range.includes(e)}}class it{constructor({name:e,description:t,values:r=[],defaultValue:n,events:s,reload:i,_player:a}){this.name=e,this.description=t,this.values=new Map(r.map((e=>("object"!=typeof e[0]&&void 0!==e[0]||(e[0]=et(e[0])),!0!==e[0]||e[1]?!1!==e[0]||e[1]||(e[1]="关闭"):e[1]="开启",e)))),this.events=new nt,this.reload=i,this._defaultValue=n,this._player=a,s&&b(s,((e,t)=>this.events.on(t,e))),void 0!==n&&this.hasVal(n)?this.selected=n:r[0]&&(this.selected=r[0][0]),this.events.emit("inited",this.selected,a),this.events.emit("changed",this.selected,void 0,a)}select(e){return!(this.selected===e||!this.hasVal(e))&&(this.original=this.selected,this.selected=e,this.events.emit("selected",this.selected,this.original,this._player),this.events.emit("changed",this.selected,this.original,this._player),!0)}hasVal(e){return this.values.has(e)||!this.values.size}}class at{constructor(e,t){this.name=t,this.db=rt.open(e,`option-manager:${t}`),this.player=e}items={};addItem(e){return e.range?this.items[e.name]=new st(e):e.values&&(this.items[e.name]=new it(e)),this}async _syncToDB(){const e=this.getItemValMap();await v(e,(async(e,t)=>{await this.db.set(t,e)})),await v(this.db,(async([e,t])=>{this.hasItem(e)||await this.db.delete(e)}))}async _syncFromDB(){b(this.db,(([e,t])=>this.setItemVal(e,t,void 0,{syncFromDB:!0}))),await this._syncToDB()}async init(){return this.addItem=void 0,await this._syncFromDB(),this.getItemValMap()}_getItem(e){return this.items[e]}hasItem(e){return!!this.items[e]}setItemVal(e,t,r=((e,t,r)=>{}),{syncFromDB:n=!1}={}){const s=this._getItem(e);if(s){s.select(t)&&(!n&&s.reload&&(this.reload=!0),r(s.selected,s.original,this.getItemValMap()))}return this}getItemVal(e){const t=this._getItem(e);if(t)return t.selected}getItemValMap(){const e={};return b(this.items,((t,r)=>{e[r]=this.getItemVal(r)})),e}async done(e){const t=async({reply:e=!0}={})=>{await this._syncToDB(),e&&this.player.sendMessage("设置选项修改成功")};this.reload?(this.reload=!1,await Be.confirm({body:'你选择的项目更改后需要刷新脚本，请手动运行 "/reload" 命令。\n\n您也可以取消您的更改',target:this.player,onConfirm:async()=>{await t({reply:!1})},onCancel:async()=>{await this._syncFromDB(),await this.showDialog(e)}})):await t()}async showDialog(e){const t=(new _).title(`${this.name} 选项`),r=[];b(this.items,(e=>{if(e instanceof it){const{name:n,description:s,values:i,selected:a}=e;if(2===i.size&&i.get(!0)&&i.get(!1)){const e=new Map;b(i,(([t])=>e.set(t,t))),r.push({name:n,valuesMap:e}),t.toggle(s,a)}else{const e=[...i],o=new Map;b(e,(([e],t)=>o.set(t,e))),r.push({name:n,valuesMap:o}),t.dropdown(s,e.map((e=>e[1])),e.map((e=>e[0])).findIndex((e=>e===a)))}}else if(e instanceof st){const{name:n,description:s,range:i,selected:a}=e,o=new Map;b(i,(e=>o.set(e,e))),r.push({name:n,valuesMap:o}),t.slider(s,i.min,i.max,i.step,a)}}));const n=new Be({dialog:t,onClose:async()=>{e&&await e.show(this.player)},onSubmit:async t=>{b(t,((e,t)=>{const{name:n,valuesMap:s}=r[t],i=s.get(e);this.setItemVal(n,i)})),await this.done(e)}});await n.show(this.player)}}class ot{constructor(e){this.name=e}players=new Map;_items=new Set;addItem(e){return this._items.add(e),this}applyPlayer(e){if(this.players.has(e))return this.players.get(e);const t=new at(e,this.name);return b(this._items,(r=>{r._player=e,t.addItem(r)})),this.players.set(e,t),t}async applyMainPlayer(){const e=await function(){const e=t.getAllPlayers();return e.length?Promise.resolve(e[0]):new Promise((e=>{const r=t.afterEvents.playerSpawn.subscribe((n=>{n.initialSpawn&&e(n.player),t.afterEvents.playerSpawn.unsubscribe(r)}))}))}();return this.applyPlayer(e)}async init(){const e=new Map;return await v(this.players,(async([t,r])=>{const n=await r.init();e.set(t,n)})),this.applyPlayer=void 0,e}getPlayer(e){return this.players.get(e)}}const ct=new class{namespaces=new Map;registerNamesapace(e){const t=new ot(e);return this.namespaces.set(e,t),t}getNamesapace(e){return this.namespaces.get(e)}async showDialog(e){const t=(new y).title("设置选项").body("选择要设置的模块："),r=[];b(this.namespaces,(([e])=>{r.push(e),t.button(e)}));const n=new Be({dialog:t,onSelect:async t=>{const s=r[t];await this.getNamesapace(s).getPlayer(e).showDialog(n)}});await n.show(e)}};Se.register("!","option",(async(e,t)=>{switch(e[1]){case"dialog":case"-d":case void 0:await H((()=>ct.showDialog(t)));break;default:throw K("未知的子命令",t)}}));const lt=ct.registerNamesapace("better-door").addItem({name:"door",description:"允许双开门",values:[[!0],[!1]],defaultValue:!0,events:{changed:(e,t)=>console.warn("better-door:door -> from",t,"to",e)}}).addItem({name:"trapdoor",description:"允许多开活板门",values:[[!0],[!1]],defaultValue:!1,events:{changed:(e,t)=>console.warn("better-door:trapdoor -> from",t,"to",e)}}).addItem({name:"max_trapdoor_length",description:"允许多开活板门的最大距离",range:[1,32],defaultValue:3,events:{changed:(e,t)=>console.warn("better-door:max_trapdoor_length -> from",t,"to",e)}}).addItem({name:"should_be_the_same_type",description:"是否需要是同种门",values:[[!0],[!1]],defaultValue:!0,events:{changed:(e,t)=>console.warn("better-door:should_be_the_same_type -> from",t,"to",e)}});lt.applyMainPlayer().then((()=>b(t.getAllPlayers(),(e=>lt.applyPlayer(e))))).then((()=>lt.init())).then((()=>t.beforeEvents.itemUseOn.subscribe((e=>{const{block:t,source:r}=e,n=lt.getPlayer(r),s=n.getItemVal("should_be_the_same_type");if(ve.match(t)&&n.getItemVal("door")){e.cancel=!0;const r=ve.wrap(t).getRelated({shouldBeTheSameType:s});H((()=>{r[0].opened?b(r,(e=>e.close())):b(r,(e=>e.open()))})).catch(w.error)}else if(Ee.match(t)&&n.getItemVal("trapdoor")){e.cancel=!0;const i=n.getItemVal("max_trapdoor_length"),a=Ee.wrap(t).getRelated(r,{maxLength:i,shouldBeTheSameType:s});H((()=>{a[0].opened?b(a,(e=>e.close())):b(a,(e=>e.open()))})).catch(w.error)}})))).catch(w.error);const dt=new rt({id:"global"},"scoreboard-statistic-global"),ht=new Map;class ut{constructor(e){this.db=new rt(e,"scoreboard-statistic-player"),this.player=e}events=new Map;static init(e){const t=new ut(e);return ht.set(e,t),t}async addParticipated(e){const t=this.getParticipated();t.add(e),await this.db.set("__participated__",t)}getParticipated(){return new Set(this.db.get("__participated__")??[])}setEvents(e,t){this.events.set(e,t)}getEvents(e){return this.events.get(e)}async add(e,t){await this.addParticipated(e),this.setEvents(e,t)}has(e){return this.events.has(e)&&this.getParticipated().has(e)}async delete(e){const t=this.getParticipated();if(t.has(e))return t.delete(e),await this.db.set("__participated__",t),this.events.delete(e),!0}async clear(){await this.db.clear(),this.events.clear()}}const mt=ct.registerNamesapace("scoreboard-statistic").addItem({name:"enable_creative",description:"允许统计创造模式下的行为",values:[[!0],[!1]],defaultValue:!0,events:{changed:(e,t)=>console.warn("scoreboard-statistic:enable_creative -> from",t,"to",e)}}).addItem({name:"enable_cancel_out",description:"对部分统计项启用抵消",values:[[!0],[!1]],defaultValue:!1,events:{changed:(e,t)=>console.warn("scoreboard-statistic:enable_cancel_out -> from",t,"to",e)}}).addItem({name:"enable_confirm_dialog",description:"启用删除记分板时的警告",values:[[!0],[!1]],defaultValue:!0,events:{changed:(e,t)=>console.warn("scoreboard-statistic:enable_confirm_dialog -> from",t,"to",e)}}).addItem({name:"auto_start",description:"添加记分板后是否自动开始统计",values:[[!0],[!1]],defaultValue:!0,events:{changed:(e,t)=>console.warn("scoreboard-statistic:auto_start -> from",t,"to",e)}});var pt=({player:e,target:t,callback:r})=>({events:{entityDie:{option:{entityTypes:[t]},listener(t){const n=t.damageSource.cause,s=t.damageSource.damagingEntity;n===l.entityAttack&&s.id===e.id&&r({type:"increase",value:1})}}}}),gt=({player:e,target:t,callback:r})=>({events:{entityDie:{option:{entities:[e]},listener(e){const n=e.damageSource.cause,s=e.damageSource.damagingEntity;n===l.entityAttack&&s.typeId===t&&r({type:"increase",value:1})}}}}),ft=({player:e,target:t,callback:r})=>({events:{entityDie:{option:{entities:[e]},listener(e){`minecraft:${e.damageSource.cause}`===t&&r({type:"increase",value:1})}}}}),_t=({player:e,target:t,callback:r})=>({events:{playerBreakBlock:{listener(n){const s=n.brokenBlockPermutation;n.player.id===e.id&&s.type.id===t&&r({type:"increase",value:1})}},playerPlaceBlock:{listener(n){const s=n.block;n.player.id===e.id&&s.typeId===t&&r({type:"decrease",value:1})}}}}),yt=({player:e,target:t,callback:r})=>({events:{playerBreakBlock:{listener(n){const s=n.brokenBlockPermutation;n.player.id===e.id&&s.type.id===t&&r({type:"decrease",value:1})}},playerPlaceBlock:{listener(n){const s=n.block;n.player.id===e.id&&s.typeId===t&&r({type:"increase",value:1})}}}});const wt={"minecraft:killed":pt,killed:pt,"minecraft:killed_by":gt,killed_by:gt,"minecraft:killed_for":ft,killed_for:ft,"minecraft:mined":_t,mined:_t,"minecraft:placed":yt,placed:yt};var bt=new Map([...Object.entries(wt),["deathCount",({player:e,callback:t})=>({events:{entityDie:{option:{entities:[e]},listener(){t({type:"increase",value:1})}}}})],["playerKillCount",({player:e,callback:t})=>pt({player:e,target:"minecraft:player",callback:t})],["totalKillCount",({player:e,callback:t})=>({events:{entityDie:{listener(r){const n=r.damageSource.cause,s=r.damageSource.damagingEntity;n===l.entityAttack&&s.id===e.id&&t({type:"increase",value:1})}}}})],["health",({player:e,callback:t})=>({events:{entityHealthChanged:{option:{entities:[e]},listener(e){t({type:"reset",value:e.newValue})}},playerSpawn:{listener(){t({type:"reset",value:20})}}}})]]);let vt=class{constructor(e){this.player=e,this.playerOption=mt.getPlayer(e),this.playerDB=ht.get(e)}async add({objectiveId:e,criteria:r,displayName:n=e}){if(t.scoreboard.getObjective(e))return{code:0,message:"DUPLICATE_OBJECTIVE"};const[s]=It(r);return bt.get(s)?(await H((()=>{const r=t.scoreboard.addObjective(e,n);t.scoreboard.setObjectiveAtDisplaySlot(d.Sidebar,{objective:r,sortOrder:h.Ascending}),r.hasParticipant(this.player)||this.player.runCommand(`scoreboard players set @s ${e} 0`)})),await dt.set(e,r),{code:1}):{code:0,message:"UNKNOWN_CRITERIA"}}async remove({objectiveId:e}){return!!dt.get(e)&&(await H((()=>t.scoreboard.removeObjective(e))),await dt.delete(e),!0)}async start({objectiveId:e,criteria:r=dt.get(e)}){if(this.playerDB.has(e))return!1;const n=G(e),[s,i]=It(r),a=bt.get(s)({player:this.player,target:i,callback:e=>{if(!De.wrap(this.player).testGameMode(c.creative)||this.playerOption.getItemVal("enable_creative"))switch(e.type){case"decrease":this.playerOption.getItemVal("enable_cancel_out")&&n.setScore(this.player,n.getScore(this.player)-e.value);break;case"reset":n.setScore(this.player,e.value);break;default:n.setScore(this.player,n.getScore(this.player)+e.value)}}});return await v(a.events,(async({option:e,listener:r},n)=>{e?await H((()=>t.afterEvents[n].subscribe(r,e))):await H((()=>t.afterEvents[n].subscribe(r)))})),await this.playerDB.add(e,a.events),!0}async stop({objectiveId:e}){if(!this.playerDB.has(e))return!1;const r=this.playerDB.getEvents(e);return await v(r,(async({listener:e},r)=>{await H((()=>t.afterEvents[r].unsubscribe(e)))})),await this.playerDB.delete(e),!0}};function It(e){return e.split(":").map((e=>e.replace(".",":"))).map(((e,t)=>0===t||e.match(/^(.+)\:/)?e:`minecraft:${e}`))}async function kt(e,t){const r=mt.getPlayer(t),n=new vt(t),s=e[2];switch(e[1]){case"add":{const[,,,i,a]=e;if(!s)throw K("objectiveId 是必须的",t);if(!i)throw K("criteria 是必须的",t);r.getItemVal("enable_creative")||t.sendMessage("注意：当前设置不会统计创造模式下的行为");const o=await n.add({objectiveId:s,criteria:i,displayName:a});if(o.code)t.sendMessage(`成功添加记分板 "${a}" (${s}) 使用 "${i}"`);else switch(o.message){case"DUPLICATE_OBJECTIVE":throw K(`添加失败：记分板 ${s} 已存在`,t);case"UNKNOWN_CRITERIA":throw K(`添加失败：未知的准则 ${i}`,t)}if(r.getItemVal("auto_start")){await n.start({objectiveId:s,criteria:i})&&t.sendMessage(`已自动开启您在 ${a} 上的统计`)}break}case"remove":case"rm":case"-r":{async function c(){if(!await n.remove({objectiveId:s}))throw K(`移除失败：记分板 ${s} 不存在或不是统计用记分板`,t);t.sendMessage(`删除成功 ${s}`)}r.getItemVal("enable_confirm_dialog")?await Be.confirm({body:`是否清除记分板 ${s} 上的统计数据，你将永远失去它们`,target:t,onConfirm:c}):await c();break}case"stop":if(!await n.stop({objectiveId:s}))throw K(`暂停失败：您可能没有开启您在记分板 ${s} 上的统计，或该记分板不存在`,t);t.sendMessage(`已暂停您在 ${s} 上的统计`);break;case"start":if(!await n.start({objectiveId:s}))throw K(`开启失败：您可能已经开启您在记分板 ${s} 上的统计，或该记分板不存在`,t);t.sendMessage(`已开启您在 ${s} 上的统计`);break;case"option":case"opt":case"-o":await H((()=>r.showDialog()));break;default:throw K(`未知的子命令 ${e[1]}`,t)}}mt.applyMainPlayer().then((()=>b(t.getAllPlayers(),(e=>mt.applyPlayer(e))))).then((()=>mt.init())).then((async()=>{await v(mt.players,(async([e])=>{const t=ut.init(e),r=new vt(e),n=t.getParticipated();await t.clear(),await v(n,(async t=>{await r.start({objectiveId:t})&&e.sendMessage(`已重启您在记分板 ${t} 上的统计`)}))})),Se.register("!","statistic",kt)})).catch(w.error);const xt=new Map;class St{constructor(e){this.db=rt.open(e,"tpx"),this.player=e}static init(e){const t=new St(e);return xt.set(e,t),t}async set({name:e,disposable:t,force:r}){const n=new X(this.player),s=async()=>(await this.db.set(e,{info:n.textify(),disposable:t}),n);return!r&&this.db.has(e)?await Be.confirm({body:`名称 ${e} 已被占用，是否覆盖？`,target:this.player,onConfirm:async()=>await s()}):await s()}async get(e){if(!this.db.has(e))return;const{info:t,disposable:r}=this.db.get(e);return r&&await this.db.delete(e),t?new X(t):void 0}async remove(e){return!!this.db.has(e)&&await Be.confirm({body:`是否删除 ${e} `,target:this.player,onConfirm:async()=>await this.db.delete(e)})}getAll(){const e=[];return b(this.db,(([t,{info:r,disposable:n}])=>{const s=new X(r);e.push({name:t,info:s,disposable:n,text:`${t} (${s})${n?" [一次性]":""}`})})),e}}async function At(e){const t=e.deadEntity,r=new Dt(t);await r.set({name:"__death__",option:{disposable:!0,force:!0}})}const Mt=ct.registerNamesapace("tpx").addItem({name:"auto_back_point",description:"允许使用 tpx 传送时自动添加返回点",values:[[!0],[!1]],defaultValue:!0,events:{changed:(e,t)=>console.warn("tpx:auto_back_point -> from",t,"to",e)}}).addItem({name:"back_after_death",description:"允许死亡时自动添加死亡点",values:[[!0],[!1]],defaultValue:!0,events:{changed:(e,r)=>{console.warn("tpx:back_after_death -> from",r,"to",e),e?t.afterEvents.entityDie.subscribe(At,{entityTypes:["minecraft:player"]}):t.afterEvents.entityDie.unsubscribe(At)}}}).addItem({name:"back_cmd",description:"允许使用独立的 back 命令",values:[[!0],[!1]],defaultValue:!1,reload:!0,events:{changed:(e,t)=>console.warn("tpx:back_cmd -> from",t,"to",e)}}).addItem({name:"home_cmd",description:"允许使用独立的 home 命令",values:[[!0],[!1]],defaultValue:!1,reload:!0,events:{changed:(e,t)=>console.warn("tpx:home_cmd -> from",t,"to",e)}});class Dt{constructor(e){this.player=e,this.playerOption=Mt.getPlayer(e),this.playerDB=xt.get(e)}async set({name:e="default",option:t={}}){const r=await this.playerDB.set(Object.assign({name:e},t));if("__back__"!==e&&"__death__"!==e)return{info:r}}async remove({name:e="default"}){return await this.playerDB.remove(e)}async teleport({name:e="default"}){const t=await this.playerDB.get(e);if(t)return this.playerOption.getItemVal("auto_back_point")&&"__death__"!==e&&await this.set({name:"__back__",option:{disposable:!0,force:!0}}),await H((()=>this.player.teleport(t.location,{dimension:t.dimension,checkForBlocks:!1,keepVelocity:!1}))),{info:t}}async tryTeleport({names:e=[]}){for(const t of e){const e=await this.teleport({name:t});if(e)return e}}list(){const e=this.playerDB.getAll().map((({text:e})=>e));if(e.length)return{msg:e}}}const Et=["set","-s","remove","rm","-r","back","bk","-b","list","ls","-l","help","-h","option","opt","-o"];async function Bt(e,t){const r=e[2]??"default",n=new Dt(t);switch(e[1]){case"set":case"-s":{if(Et.includes(r)||"__back__"===r)throw K(`添加失败：不能使用 ${r} 作为名称`,t);const s=await n.set({name:r,option:{disposable:"true"===e[3]||"false"!==e[3]&&null}});s&&t.sendMessage(`成功设置 ${r} 在 ${s.info}`);break}case"remove":case"rm":case"-r":{const e=await n.remove({name:r});if(!0===e)t.sendMessage(`成功删除 ${r}`);else if(!1===e)throw K(`删除失败：未找到 ${r}`,t);break}case"back":case"bk":case"-b":{const e=await n.tryTeleport({names:["__death__","__back__"]});if(!e)throw K("传送失败：未找到返回点",t);t.sendMessage(`已返回到 ${e.info}`);break}case"list":case"ls":case"-l":{const e=n.list();e?(e.msg.unshift("您的传送点有："),t.sendMessage(e.msg.join("\n- "))):t.sendMessage("您目前没有传送点");break}case"help":case"-h":t.sendMessage("制作中...");break;case"option":case"opt":case"-o":await H((()=>Mt.getPlayer(t).showDialog()));break;default:{const r=await n.teleport({name:e[1]});if(!r)throw K(`传送失败：未找到传送点 ${e[1]}`,t);t.sendMessage(`已传送到 ${r.info}`)}}}async function Tt(e,t){Mt.getPlayer(t).getItemVal("back_cmd")?await Se.asyncRun("!tpx back",t):t.sendMessage("您未启用该命令")}async function Rt(e,t){if(Mt.getPlayer(t).getItemVal("home_cmd"))if("set"===e[1])await Se.asyncRun("!tpx set __home__",t);else await Se.asyncRun("!tpx __home__",t);else t.sendMessage("您未启用该命令")}Mt.applyMainPlayer().then((()=>b(t.getAllPlayers(),(e=>Mt.applyPlayer(e))))).then((()=>Mt.init())).then((e=>{b(e.keys(),(e=>St.init(e))),Se.register("!","tpx",Bt);const t=[...e.values()];t.some((({back_cmd:e})=>e))&&Se.register("!","back",Tt),t.some((({home_cmd:e})=>e))&&Se.register("!","home",Rt)})).catch(w.error);const Nt=new x([...T,...R,...N,"minecraft:obsidian","minecraft:ancient_debris","minecraft:amethyst_block"]),$t=ct.registerNamesapace("vein-mining").addItem({name:"condition",description:"触发条件",values:[["off","关闭"],["always","总是"],["sneaking","仅潜行时"]],defaultValue:"sneaking",events:{changed:(e,t)=>console.warn("vein-mining:tigger -> from",t,"to",e)}}).addItem({name:"max_amount",description:"最多检测的方块数量（并非最终挖掘的方块数）",range:[8,128],defaultValue:64,events:{changed:(e,t)=>console.warn("vein-mining:enable_edge -> from",t,"to",e)}}).addItem({name:"enable_stone",description:"允许连锁挖掘岩石类方块（石头、深板岩）",values:[[!0],[!1]],defaultValue:!1,events:{changed:(e,t)=>console.warn("vein-mining:enable_stone -> from",t,"to",e)}}).addItem({name:"auto_collection",description:"自动收集掉落物及经验（绕过经验修补）",values:[[!0],[!1]],defaultValue:!1,events:{changed:(e,t)=>console.warn("vein-mining:auto_collect_drops -> from",t,"to",e)}}).addItem({name:"prevent_tool_destruction",description:"防止工具耐久耗尽",values:[[!0],[!1]],defaultValue:!1,events:{changed:(e,t)=>console.warn("vein-mining:prevent_tool_destruction -> from",t,"to",e)}}).addItem({name:"enable_edge",description:"是否检测仅棱相连的方块",values:[[!0],[!1]],defaultValue:!1,events:{changed:(e,t)=>console.warn("vein-mining:enable_edge -> from",t,"to",e)}}).addItem({name:"enable_diagonal",description:"是否检测仅角相连的方块",values:[[!0],[!1]],defaultValue:!1,events:{changed:(e,t)=>console.warn("vein-mining:enable_diagonal -> from",t,"to",e)}}),Ot=()=>t.afterEvents.playerBreakBlock.subscribe((e=>{const t=new ye(e.block),r=e.brokenBlockPermutation.type.id,n=new De(e.player),s=$t.getPlayer(e.player);let a=Nt;s.getItemVal("enable_stone")&&(a=Nt.clone().add(...$)),n.useMainHandItem((async e=>{if(!e||!a.has(r)||!ye.prototype.canBeDugBy.call({typeId:r},e.typeId)||"off"===s.getItemVal("condition")||"sneaking"===s.getItemVal("condition")&&!n.isSneaking)return e;const o=function(e,t,r){const n=e.getItemVal("max_amount"),s=new be;s.add(...Vt(e,t,r));let i=0,a=s.size;for(;a<n&&a-i>0;)for(const t of s)if(s.add(...Vt(e,t,r)),i=a,a=s.size,a>=n)break;return s}(s,t,r),c=ie.tryWrap(e)??new se(e);let l=0;const d=[];let h=0;for(;o.size>0&&(!s.getItemVal("prevent_tool_destruction")||s.getItemVal("prevent_tool_destruction")&&l<(c.durability??Number.POSITIVE_INFINITY));){const t=o.shift(),r=await H((()=>t.breakBy(e)));l+=r.getTotalDamage(),s.getItemVal("auto_collection")?b(r.drops,(e=>{e.xp&&(h+=e.xp),d.push(e)})):r.spawnDrops()}return s.getItemVal("auto_collection")&&(b(d,(({itemId:e,amount:t})=>n.inventory.addItem(new i(e,t)))),n.addExperience(h)),c instanceof ie&&c.applyDamage(l),c._item})).catch(w.error)}));function Vt(e,t,r){const n=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)];e.getItemVal("enable_edge")&&n.push(new q(1,1,0),new q(1,-1,0),new q(-1,1,0),new q(-1,-1,0),new q(0,1,1),new q(0,-1,1),new q(0,1,-1),new q(0,-1,-1),new q(1,0,1),new q(1,0,-1),new q(-1,0,1),new q(-1,0,-1)),e.getItemVal("enable_diagonal")&&n.push(new q(-1,-1,-1),new q(-1,1,-1),new q(-1,-1,1),new q(-1,1,1),new q(1,-1,-1),new q(1,1,-1),new q(1,-1,1),new q(1,1,1));const s=new be;return b(n,(e=>{const n=t.getOffsetBlock(e);n.typeId===r&&s.add(n)})),s}$t.applyMainPlayer().then((()=>b(t.getAllPlayers(),(e=>$t.applyPlayer(e))))).then((()=>$t.init())).then((()=>Ot())).catch(w.error);
