/*!
 * my-mcbe-script-tpx.js v0.0.0 (https://github.com/PFiS1737/my-mcbe-script#readme)
 * Copyright 2022-2023 PFiS1737
 * Licensed under MIT
 * 
 * This file is automatically generated, please do not change it.
 */
import{world as t,MinecraftDimensionTypes as e,Dimension as s,Entity as n,system as i}from"@minecraft/server";import{MessageFormData as r,FormCancelationReason as a,ModalFormResponse as o,MessageFormResponse as c,ActionFormResponse as h,ModalFormData as u,ActionFormData as l}from"@minecraft/server-ui";function d(t,e,s){if(Array.isArray(t))t.forEach(e,s);else if(t&&t[Symbol.iterator])for(let n of t)e.call(s,n,t);else"object"==typeof t&&d(Object.keys(t),((n,i)=>e.call(s,t[n],n,i,t)))}async function y(t,e,s){if(Array.isArray(t))for(let n=0;n<t.length;n++)await e.call(s,t[n],n,t);else if(t&&t[Symbol.iterator])for(let n of t)await e.call(s,n,t);else"object"==typeof t&&await y(Object.keys(t),(async(n,i)=>await e.call(s,t[n],n,i,t)))}function m(t){try{return JSON.parse(t)}catch(e){return function(t,e={}){return new Function(...Object.keys(e),`return ${t}`)(...Object.values(e))}(`(${t})`)}}const f=async function(){}.constructor;class p{static error(t){console.error(`${t}\n${t.stack}`)}}const g=t.getDimension(e.overworld),w=new Set;class _{static run(t,e=g){if(e instanceof s||e instanceof n)return e.runCommand(t);throw new TypeError("Target must be Entity or Dimension.")}static async asyncRun(t,e=g){if(!(e instanceof s||e instanceof n))throw new TypeError("Target must be Entity or Dimension.");{const s=[...w].filter((({regex:e})=>e.test(t))).map((t=>t.runner));if(!s.length)return await e.runCommandAsync(t);await y(s,(async s=>await s(t,e)))}}static register(e,s,n){if(e.startsWith("/"))throw new Error("Unable to register slash commands.");const i=new RegExp(`^${e}${s}( |$)`),r=async(t,e)=>{const s=t.split(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g).filter((t=>t.trim().length>0));await n(s,e)};w.add({regex:i,runner:r}),t.beforeEvents.chatSend.subscribe((t=>{i.test(t.message)&&(t.cancel=!0,r(t.message,t.sender).catch(p.error))}))}}function b(t){return new Promise(((e,s)=>{i.run((()=>{try{e(t())}catch(t){s(t)}}))}))}function v(t,e){const s=new Error(t);return e.sendMessage(s.toString()),s}class x{static async confirm({title:t="确认",body:e,target:s,onCancel:n=(async()=>{}),onConfirm:i=(async()=>{})}){if(!e||!s)throw new Error;const a=await b((()=>new x({dialog:(new r).title(t).body(e).button1("CANCEL").button2("OK"),onClose:n,onSelectButton1:n,onSelectButton2:i})));return await a.show(s)}constructor({dialog:t,onClose:e=(async()=>{}),onSubmit:s=(async()=>{}),onSelectButton1:n=(async()=>{}),onSelectButton2:i=(async()=>{}),onSelect:r=(async()=>{})}){this.dialog=t,this.onSubmit=s,this.onSelectButton1=n,this.onSelectButton2=i,this.onSelect=r,this.onClose=e}async show(t){let e;t.sendMessage("[!] 新对话框已发送，请关闭命令输入栏或其他对话框");do{e=await this.dialog.show(t)}while(e.cancelationReason===a.UserBusy);if(e.canceled&&e.cancelationReason===a.UserClosed)return await this.onClose();if(e instanceof o)return await this.onSubmit(e.formValues);if(e instanceof c){if(0===e.selection)return await this.onSelectButton1();if(1===e.selection)return await this.onSelectButton2()}else if(e instanceof h)return await this.onSelect(e.selection);return e}}var M=function(t){null==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,t.constructor==Array?this.init_by_array(t,t.length):this.init_seed(t)};M.prototype.init_seed=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},M.prototype.init_by_array=function(t,e){var s,n,i;for(this.init_seed(19650218),s=1,n=0,i=this.N>e?this.N:e;i;i--){var r=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(1664525*((4294901760&r)>>>16)<<16)+1664525*(65535&r))+t[n]+n,this.mt[s]>>>=0,n++,++s>=this.N&&(this.mt[0]=this.mt[this.N-1],s=1),n>=e&&(n=0)}for(i=this.N-1;i;i--){r=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(1566083941*((4294901760&r)>>>16)<<16)+1566083941*(65535&r))-s,this.mt[s]>>>=0,++s>=this.N&&(this.mt[0]=this.mt[this.N-1],s=1)}this.mt[0]=2147483648},M.prototype.random_int=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var s;for(this.mti==this.N+1&&this.init_seed(5489),s=0;s<this.N-this.M;s++)t=this.mt[s]&this.UPPER_MASK|this.mt[s+1]&this.LOWER_MASK,this.mt[s]=this.mt[s+this.M]^t>>>1^e[1&t];for(;s<this.N-1;s++)t=this.mt[s]&this.UPPER_MASK|this.mt[s+1]&this.LOWER_MASK,this.mt[s]=this.mt[s+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},M.prototype.random_int31=function(){return this.random_int()>>>1},M.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},M.prototype.random=function(){return this.random_int()*(1/4294967296)},M.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},M.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)};var S=new M(Math.random()*Number.MAX_SAFE_INTEGER),z=function(t){var e=t.length;for(;e--;)t[e]=Math.floor(256*S.random());return t};var A=function(){for(var t=(n=16,z(new Uint8Array(n))),e="",s=0;s<16;++s)e+=t[s].toString(16);var n;return e}(),E=new RegExp('(\\\\)?"@__(F|R|D|M|S|A|U|I|B|L)-'+A+'-(\\d+)__@"',"g"),k=/\{\s*\[native code\]\s*\}/g,B=/function.*?\(/,D=/.*?=>.*?/,I=/[<>\/\u2028\u2029]/g,N=["*","async"],T={"<":"\\u003C",">":"\\u003E","/":"\\u002F","\u2028":"\\u2028","\u2029":"\\u2029"};function P(t){return T[t]}function $(t,e){e||(e={}),"number"!=typeof e&&"string"!=typeof e||(e={space:e});var s,n=[],i=[],r=[],a=[],o=[],c=[],h=[],u=[];return e.ignoreFunction&&"function"==typeof t&&(t=void 0),void 0===t?String(t):(s=e.isJSON&&!e.space?JSON.stringify(t):JSON.stringify(t,e.isJSON?null:function(t,s){if(e.ignoreFunction&&function(t){var e=[];for(var s in t)"function"==typeof t[s]&&e.push(s);for(var n=0;n<e.length;n++)delete t[e[n]]}(s),!s&&void 0!==s)return s;var l=this[t],d=typeof l;if("object"===d){if(l instanceof RegExp)return"@__R-"+A+"-"+(i.push(l)-1)+"__@";if(l instanceof Date)return"@__D-"+A+"-"+(r.push(l)-1)+"__@";if(l instanceof Map)return"@__M-"+A+"-"+(a.push(l)-1)+"__@";if(l instanceof Set)return"@__S-"+A+"-"+(o.push(l)-1)+"__@";if(l instanceof Array&&l.filter((function(){return!0})).length!==l.length)return"@__A-"+A+"-"+(c.push(l)-1)+"__@"}return"function"===d?"@__F-"+A+"-"+(n.push(l)-1)+"__@":"undefined"===d?"@__U-"+A+"-"+(h.push(l)-1)+"__@":"number"!==d||isNaN(l)||isFinite(l)?s:"@__I-"+A+"-"+(u.push(l)-1)+"__@"},e.space),"string"!=typeof s?String(s):(!0!==e.unsafe&&(s=s.replace(I,P)),0===n.length&&0===i.length&&0===r.length&&0===a.length&&0===o.length&&0===c.length&&0===h.length&&0===u.length?s:s.replace(E,(function(t,s,h,l){return s?t:"D"===h?'new Date("'+r[l].toISOString()+'")':"R"===h?"new RegExp("+$(i[l].source)+', "'+i[l].flags+'")':"M"===h?"new Map("+$(Array.from(a[l].entries()),e)+")":"S"===h?"new Set("+$(Array.from(o[l].values()),e)+")":"A"===h?"Array.prototype.slice.call("+$(Object.assign({length:c[l].length},c[l]),e)+")":"U"===h?"undefined":"I"===h?u[l]:function(t){var e=t.toString();if(k.test(e))throw new TypeError("Serializing native function: "+t.name);if(B.test(e))return e;if(D.test(e))return e;var s=e.indexOf("("),n=e.substr(0,s).trim().split(" ").filter((function(t){return t.length>0}));return n.filter((function(t){return-1===N.indexOf(t)})).length>0?(n.indexOf("async")>-1?"async ":"")+"function"+(n.join("").indexOf("*")>-1?"*":"")+e.substr(s):e}(n[l])}))))}var O,R,j={exports:{}},V={exports:{}};O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&R.rotl(t,8)|4278255360&R.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=R.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],s=0,n=0;s<t.length;s++,n+=8)e[n>>>5]|=t[s]<<24-n%32;return e},wordsToBytes:function(t){for(var e=[],s=0;s<32*t.length;s+=8)e.push(t[s>>>5]>>>24-s%32&255);return e},bytesToHex:function(t){for(var e=[],s=0;s<t.length;s++)e.push((t[s]>>>4).toString(16)),e.push((15&t[s]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],s=0;s<t.length;s+=2)e.push(parseInt(t.substr(s,2),16));return e},bytesToBase64:function(t){for(var e=[],s=0;s<t.length;s+=3)for(var n=t[s]<<16|t[s+1]<<8|t[s+2],i=0;i<4;i++)8*s+6*i<=8*t.length?e.push(O.charAt(n>>>6*(3-i)&63)):e.push("=");return e.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var e=[],s=0,n=0;s<t.length;n=++s%4)0!=n&&e.push((O.indexOf(t.charAt(s-1))&Math.pow(2,-2*n+8)-1)<<2*n|O.indexOf(t.charAt(s))>>>6-2*n);return e}},V.exports=R;var C={utf8:{stringToBytes:function(t){return C.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(C.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],s=0;s<t.length;s++)e.push(255&t.charCodeAt(s));return e},bytesToString:function(t){for(var e=[],s=0;s<t.length;s++)e.push(String.fromCharCode(t[s]));return e.join("")}}},F=C,q=function(t){return null!=t&&(U(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&U(t.slice(0,0))}(t)||!!t._isBuffer)};function U(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}!function(){var t=V.exports,e=F.utf8,s=q,n=F.bin,i=function(r,a){r.constructor==String?r=a&&"binary"===a.encoding?n.stringToBytes(r):e.stringToBytes(r):s(r)?r=Array.prototype.slice.call(r,0):Array.isArray(r)||r.constructor===Uint8Array||(r=r.toString());for(var o=t.bytesToWords(r),c=8*r.length,h=1732584193,u=-271733879,l=-1732584194,d=271733878,y=0;y<o.length;y++)o[y]=16711935&(o[y]<<8|o[y]>>>24)|4278255360&(o[y]<<24|o[y]>>>8);o[c>>>5]|=128<<c%32,o[14+(c+64>>>9<<4)]=c;var m=i._ff,f=i._gg,p=i._hh,g=i._ii;for(y=0;y<o.length;y+=16){var w=h,_=u,b=l,v=d;h=m(h,u,l,d,o[y+0],7,-680876936),d=m(d,h,u,l,o[y+1],12,-389564586),l=m(l,d,h,u,o[y+2],17,606105819),u=m(u,l,d,h,o[y+3],22,-1044525330),h=m(h,u,l,d,o[y+4],7,-176418897),d=m(d,h,u,l,o[y+5],12,1200080426),l=m(l,d,h,u,o[y+6],17,-1473231341),u=m(u,l,d,h,o[y+7],22,-45705983),h=m(h,u,l,d,o[y+8],7,1770035416),d=m(d,h,u,l,o[y+9],12,-1958414417),l=m(l,d,h,u,o[y+10],17,-42063),u=m(u,l,d,h,o[y+11],22,-1990404162),h=m(h,u,l,d,o[y+12],7,1804603682),d=m(d,h,u,l,o[y+13],12,-40341101),l=m(l,d,h,u,o[y+14],17,-1502002290),h=f(h,u=m(u,l,d,h,o[y+15],22,1236535329),l,d,o[y+1],5,-165796510),d=f(d,h,u,l,o[y+6],9,-1069501632),l=f(l,d,h,u,o[y+11],14,643717713),u=f(u,l,d,h,o[y+0],20,-373897302),h=f(h,u,l,d,o[y+5],5,-701558691),d=f(d,h,u,l,o[y+10],9,38016083),l=f(l,d,h,u,o[y+15],14,-660478335),u=f(u,l,d,h,o[y+4],20,-405537848),h=f(h,u,l,d,o[y+9],5,568446438),d=f(d,h,u,l,o[y+14],9,-1019803690),l=f(l,d,h,u,o[y+3],14,-187363961),u=f(u,l,d,h,o[y+8],20,1163531501),h=f(h,u,l,d,o[y+13],5,-1444681467),d=f(d,h,u,l,o[y+2],9,-51403784),l=f(l,d,h,u,o[y+7],14,1735328473),h=p(h,u=f(u,l,d,h,o[y+12],20,-1926607734),l,d,o[y+5],4,-378558),d=p(d,h,u,l,o[y+8],11,-2022574463),l=p(l,d,h,u,o[y+11],16,1839030562),u=p(u,l,d,h,o[y+14],23,-35309556),h=p(h,u,l,d,o[y+1],4,-1530992060),d=p(d,h,u,l,o[y+4],11,1272893353),l=p(l,d,h,u,o[y+7],16,-155497632),u=p(u,l,d,h,o[y+10],23,-1094730640),h=p(h,u,l,d,o[y+13],4,681279174),d=p(d,h,u,l,o[y+0],11,-358537222),l=p(l,d,h,u,o[y+3],16,-722521979),u=p(u,l,d,h,o[y+6],23,76029189),h=p(h,u,l,d,o[y+9],4,-640364487),d=p(d,h,u,l,o[y+12],11,-421815835),l=p(l,d,h,u,o[y+15],16,530742520),h=g(h,u=p(u,l,d,h,o[y+2],23,-995338651),l,d,o[y+0],6,-198630844),d=g(d,h,u,l,o[y+7],10,1126891415),l=g(l,d,h,u,o[y+14],15,-1416354905),u=g(u,l,d,h,o[y+5],21,-57434055),h=g(h,u,l,d,o[y+12],6,1700485571),d=g(d,h,u,l,o[y+3],10,-1894986606),l=g(l,d,h,u,o[y+10],15,-1051523),u=g(u,l,d,h,o[y+1],21,-2054922799),h=g(h,u,l,d,o[y+8],6,1873313359),d=g(d,h,u,l,o[y+15],10,-30611744),l=g(l,d,h,u,o[y+6],15,-1560198380),u=g(u,l,d,h,o[y+13],21,1309151649),h=g(h,u,l,d,o[y+4],6,-145523070),d=g(d,h,u,l,o[y+11],10,-1120210379),l=g(l,d,h,u,o[y+2],15,718787259),u=g(u,l,d,h,o[y+9],21,-343485551),h=h+w>>>0,u=u+_>>>0,l=l+b>>>0,d=d+v>>>0}return t.endian([h,u,l,d])};i._ff=function(t,e,s,n,i,r,a){var o=t+(e&s|~e&n)+(i>>>0)+a;return(o<<r|o>>>32-r)+e},i._gg=function(t,e,s,n,i,r,a){var o=t+(e&n|s&~n)+(i>>>0)+a;return(o<<r|o>>>32-r)+e},i._hh=function(t,e,s,n,i,r,a){var o=t+(e^s^n)+(i>>>0)+a;return(o<<r|o>>>32-r)+e},i._ii=function(t,e,s,n,i,r,a){var o=t+(s^(e|~n))+(i>>>0)+a;return(o<<r|o>>>32-r)+e},i._blocksize=16,i._digestsize=16,j.exports=function(e,s){if(null==e)throw new Error("Illegal argument "+e);var r=t.wordsToBytes(i(e,s));return s&&s.asBytes?r:s&&s.asString?n.bytesToString(r):t.bytesToHex(r)}}();var L=j.exports;const K=new Map;class W{static open(t,e){return new this(t,e)}constructor(e,s){const n=L("db:"+s+"_"+e.id).slice(8,24);this.id=n,this.objective=function(e,s){const n=t.scoreboard.getObjective(e);if(n||s)return n||t.scoreboard.addObjective(e,s);throw new Error(`Couldn't find objective "${e}".`)}(n,"db:"+s),this._syncDataFromScoreboard(),K.set(n,this)}store=new Map;_syncDataFromScoreboard(){this.store.clear(),d(this.objective.getParticipants(),(t=>{const e=m(t.displayName),s=Object.keys(e)[0],n=e[s];this.store.set(s,{value:n,participant:t})}))}has(t){return this.store.has(t)}async delete(t){if(this.has(t)){const{participant:e}=this.store.get(t);return await b((()=>this.objective.removeParticipant(e))),this.store.delete(t),!0}return!1}async clear(){await y(this.store,(async([,{participant:t}])=>await b((()=>this.objective.removeParticipant(t))))),this.store.clear()}get(t){if(this.has(t))return this.store.get(t).value}async set(t,e){await this.delete(t);const s=$({[t]:e}).replaceAll('"',"'");if(s.length>32767)throw new RangeError("Database: Only accepts a string value less than 32767 characters.");await b((()=>this.objective.setScore(s,1))),this._syncDataFromScoreboard()}getAll(){const t={};for(const[e,s]of this)t[e]=s;return t}*entries(){for(const[t,{value:e}]of this.store.entries())yield[t,e]}*keys(){for(const t of this.store.keys())yield t}*values(){for(const{value:t}of this.store.values())yield t}[Symbol.iterator](){return this.entries()}}class J{constructor(){this._events={}}on(t,e){if(e instanceof f){const s=`${t}.async`;this._events[s]?this._events[s].push(e):this._events[s]=[e]}else this._events[t]?this._events[t].push(e):this._events[t]=[e];return this}once(t,e){if(e instanceof f){const s=`${t}.async`,n=async(...t)=>{await e(...t),this.removeListener(s,n)};this._events[s]?this._events[s].push(n):this._events[s]=[n]}else{const s=(...n)=>{e(...n),this.removeListener(t,s)};this._events[t]?this._events[t].push(s):this._events[t]=[s]}return this}removeListener(t,e){if(this._events[t]){const s=[];d(this._events[t],(t=>{t!==e&&s.push(t)})),this._events[t]=s}return this}async emit(t,...e){this._events[t]&&d(this._events[t],(t=>t(...e))),await this.asyncEmit(t,...e)}async asyncEmit(t,...e){const s=`${t}.async`;this._events[s]&&await y(this._events[s],(async t=>await t(...e)))}addListener(t,e){return this.on(t,e)}off(t,e){return this.removeListener(t,e)}}class X{constructor({name:t,description:e,values:s=[],defaultValue:n,events:i,reload:r,_player:a}){this.name=t,this.description=e,this.values=new Map(s.map((t=>("object"!=typeof t[0]&&void 0!==t[0]||(t[0]=$(t[0])),!0!==t[0]||t[1]?!1!==t[0]||t[1]||(t[1]="关闭"):t[1]="开启",t)))),this.events=new J,this.reload=r,this._defaultValue=n,this._player=a,i&&d(i,((t,e)=>this.events.on(e,t))),void 0!==n&&this.hasVal(n)?this.selected=n:s[0]&&(this.selected=s[0][0]),this.events.emit("inited",this.selected,a),this.events.emit("changed",this.selected,void 0,a)}select(t){return!(this.selected===t||!this.hasVal(t))&&(this.original=this.selected,this.selected=t,this.events.emit("selected",this.selected,this.original,this._player),this.events.emit("changed",this.selected,this.original,this._player),!0)}hasVal(t){return this.values.has(t)||!this.values.size}}function H(t){return t>=0?Math.round(t):t%.5==0?Math.floor(t):Math.round(t)}function G(t,e,s=1e-6){return Math.abs(t-e)<=s*Math.max(1,Math.abs(t),Math.abs(e))}function Y(t){return t>1?t*Y(t-1):1}function Z(t,e,s){return n=>t**(s-n)*e**n*function(t,e){return Y(t)/(Y(e)*Y(t-e))}(s,n)}function Q(t,e,s){let n=0;for(let i=t;i<=e;i++)n+=s(i);return n}class tt{constructor(t,e,s=1){this.min=t,this.max=e,this.step=s}toArray(){return function(t,e,s=1){const n=[];for(let i=t;i<e;i+=s)n.push(i);return n}(this.min,this.max+this.step,this.step)}get array(){return this.toArray()}includes(t){return this.array.includes(t)}[Symbol.iterator](){return this.array.values()}}class et{constructor({name:t,description:e,range:s=[0,1,1],defaultValue:n,events:i,reload:r,_player:a}){this.name=t,this.description=e,this.range=new tt(...s),this.events=new J,this.reload=r,this._defaultValue=n,this._player=a,i&&d(i,((t,e)=>this.events.on(e,t))),void 0!==n&&this._includes(n)?this.selected=n:this.selected=this.range.min,this.events.emit("inited",this.selected,a),this.events.emit("changed",this.selected,void 0,a)}select(t){return!(this.selected===t||!this._includes(t))&&(this.original=this.selected,this.selected=t,this.events.emit("selected",this.selected,this.original,this._player),this.events.emit("changed",this.selected,this.original,this._player),!0)}_includes(t){return this.range.includes(t)}}class st{constructor(t,e){this.name=e,this.db=W.open(t,`option-manager:${e}`),this.player=t}items={};addItem(t){return t.range?this.items[t.name]=new et(t):t.values&&(this.items[t.name]=new X(t)),this}async _syncToDB(){const t=this.getItemValMap();await y(t,(async(t,e)=>{await this.db.set(e,t)})),await y(this.db,(async([t,e])=>{this.hasItem(t)||this.db.delete(t)}))}async _syncFromDB(){d(this.db,(([t,e])=>this.setItemVal(t,e,void 0,{syncFromDB:!0}))),await this._syncToDB()}async init(){return delete this.addItem,await this._syncFromDB(),this.getItemValMap()}_getItem(t){return this.items[t]}hasItem(t){return!!this.items[t]}setItemVal(t,e,s=(()=>{}),{syncFromDB:n}={}){const i=this._getItem(t);if(i){i.select(e)&&(!n&&i.reload&&(this.reload=!0),s(i.selected,i.original,this.getItemValMap()))}return this}getItemVal(t){const e=this._getItem(t);if(e)return e.selected}getItemValMap(){const t={};return d(this.items,((e,s)=>t[s]=this.getItemVal(s))),t}async done(t){const e=async({reply:t=!0}={})=>{await this._syncToDB(),t&&this.player.sendMessage("设置选项修改成功")};this.reload?(this.reload=!1,await x.confirm({body:'你选择的项目更改后需要刷新脚本，请手动运行 "/reload" 命令。\n\n您也可以取消您的更改',target:this.player,onConfirm:async()=>{await e({reply:!1})},onCancel:async()=>{await this._syncFromDB(),await this.showDialog(t)}})):await e()}async showDialog(t){const e=(new u).title(`${this.name} 选项`),s=[];d(this.items,(t=>{if(t instanceof X){const{name:n,description:i,values:r,selected:a}=t;if(2===r.size&&r.get(!0)&&r.get(!1)){const t=new Map;d(r,(([e])=>t.set(e,e))),s.push({name:n,valuesMap:t}),e.toggle(i,a)}else{const t=[...r],o=new Map;d(t,(([t],e)=>o.set(e,t))),s.push({name:n,valuesMap:o}),e.dropdown(i,t.map((t=>t[1])),t.map((t=>t[0])).findIndex((t=>t===a)))}}else if(t instanceof et){const{name:n,description:i,range:r,selected:a}=t,o=new Map;d(r,(t=>o.set(t,t))),s.push({name:n,valuesMap:o}),e.slider(i,r.min,r.max,r.step,a)}}));const n=new x({dialog:e,onClose:async()=>{t&&await t.show(this.player)},onSubmit:async e=>{d(e,((t,e)=>{const{name:n,valuesMap:i}=s[e],r=i.get(t);this.setItemVal(n,r)})),await this.done(t)}});await n.show(this.player)}}class nt{constructor(t){this.name=t}players=new Map;_items=new Set;addItem(t){return this._items.add(t),this}applyPlayer(t){if(this.players.has(t))return this.players.get(t);const e=new st(t,this.name);return d(this._items,(s=>{s._player=t,e.addItem(s)})),this.players.set(t,e),e}async applyMainPlayer(){const e=await function(){const e=t.getAllPlayers();return e.length?Promise.resolve(e[0]):new Promise((e=>{const s=t.afterEvents.playerSpawn.subscribe((n=>{n.initialSpawn&&e(n.player),t.afterEvents.playerSpawn.unsubscribe(s)}))}))}();return this.applyPlayer(e)}async init(){const t=new Map;return await y(this.players,(async([e,s])=>{const n=await s.init();t.set(e,n)})),delete this.applyPlayer,t}getPlayer(t){return this.players.get(t)}}const it=new class{constructor(){}namespaces=new Map;registerNamesapace(t){const e=new nt(t);return this.namespaces.set(t,e),e}getNamesapace(t){return this.namespaces.get(t)}async showDialog(t){const e=(new l).title("设置选项").body("选择要设置的模块："),s=[];d(this.namespaces,(([t])=>{s.push(t),e.button(t)}));const n=new x({dialog:e,onSelect:async e=>{const i=s[e];await this.getNamesapace(i).getPlayer(t).showDialog(n)}});await n.show(t)}};_.register("!","option",(async(t,e)=>{switch(t[1]){case"dialog":case"-d":case void 0:await b((()=>it.showDialog(e)));break;default:throw v("未知的子命令",e)}}));class rt{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}static parse(t){return new this(...t.split(" ").map(Number))}static create(t){if(Array.isArray(t))return new this(...t);if("string"==typeof t)return this.parse(t);if("object"==typeof t)return new this(t.x,t.y,t.z);throw new TypeError('The argument "vector" must be an array, a vector string or a vector object.')}stringify(){return this[Symbol.toPrimitive]("string")}toArray(){return[...this]}[Symbol.toPrimitive](t){return"string"===t?`${this.x} ${this.y} ${this.z}`:this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}class at{static clone(t){return ot.create(t)}static add(t,e){return new ot(t.x+e.x,t.y+e.y,t.z+e.z)}static subtract(t,e){return new ot(t.x-e.x,t.y-e.y,t.z-e.z)}static multiply(t,e){return new ot(t.x*e.x,t.y*e.y,t.z*e.z)}static divide(t,e){return new ot(t.x/e.x,t.y/e.y,t.z/e.z)}static scale(t,e){return new ot(t.x*e,t.y*e,t.z*e)}static negate(t){return new ot(-t.x,-t.y,-t.z)}static inverse(t){return new ot(1/t.x,1/t.y,1/t.z)}static exchange(t,e=[]){if(2!==e.length)throw new Error("You could only exchange two axes.");const s=this.clone(t),n=s[e[0]],i=s[e[1]];return s[e[0]]=i,s[e[1]]=n,s}static exactEquals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}static equals(t,e){return G(t.x,e.x)&&G(t.y,e.y)&&G(t.z,e.z)}static max(...t){return new ot(Math.max(...t.map((({x:t})=>t))),Math.max(...t.map((({y:t})=>t))),Math.max(...t.map((({z:t})=>t))))}static min(...t){return new ot(Math.min(...t.map((({x:t})=>t))),Math.min(...t.map((({y:t})=>t))),Math.min(...t.map((({z:t})=>t))))}static floor(t){return new ot(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}static ceil(t){return new ot(Math.ceil(t.x),Math.ceil(t.y),Math.ceil(t.z))}static round(t){return new ot(H(t.x),H(t.y),H(t.z))}static abs(t){return new ot(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))}static maxMagnitude(...t){return t.reduce(((t,e)=>this.magnitude(e)>this.magnitude(t)?e:t))}static minMagnitude(...t){return t.reduce(((t,e)=>this.magnitude(e)<this.magnitude(t)?e:t))}static magnitude(t){return Math.sqrt(this.squaredMagnitude(t))}static squaredMagnitude(t){return t.x**2+t.y**2+t.z**2}static distance(t,e){return Math.sqrt(this.squaredDistance(t,e))}static squaredDistance(t,e){return(e.x-t.x)**2+(e.y-t.y)**2+(e.x-t.z)**2}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){return new ot(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static normalize(t){const e=this.magnitude(t);return e?this.scale(t,1/e):new ot(0,0,0)}static angle(t,e){const s=this.dot(this.normalize(t),this.normalize(e));return Math.acos(s)}static random(t=1){const e=2*Math.random()*Math.PI,s=2*Math.random()-1,n=Math.sqrt(1-s*s)*t;return new ot(Math.cos(e)*n,Math.sin(e)*n,s*t)}static lerp(t,e,s){return new ot(t.x*(1-s)+e.x*s,t.y*(1-s)+e.y*s,t.z*(1-s)+e.z*s)}static slerp(t,e,s){if(s<=0)return this.clone(t);if(s>=1)return this.clone(e);const n=this.angle(t,e),i=Math.sin(n);if(i<=Number.EPSILON)return this.lerp(t,e,s);const r=Math.sin(n*(1-s))/i,a=Math.sin(n*s)/i;return new ot(t.x*r+e.x*a,t.y*r+e.y*a,t.z*r+e.z*a)}static bezier(t,e){const s=t.length-1,n=Z(1-e,e,s);return new ot(Q(0,s,(e=>t[e].x*n(e))),Q(0,s,(e=>t[e].y*n(e))),Q(0,s,(e=>t[e].z*n(e))))}}class ot extends rt{constructor(t,e,s){super(t,e,s)}get magnitude(){return at.magnitude(this)}get squaredMagnitude(){return at.squaredMagnitude(this)}get normalized(){return at.normalize(this)}get floored(){return at.floor(this)}get ceiled(){return at.ceil(this)}get rounded(){return at.round(this)}get absolute(){return at.abs(this)}set(t,e,s){return this.x=t,this.y=e,this.z=s,this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new ot(this.x,this.y,this.z)}equals(t){return at.equals(this,t)}distance(t){return at.distance(this,t)}squaredDistance(t){return at.squaredDistance(this,t)}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}scale(t){return this.x*=t,this.y*=t,this.z*=t,this}negate(t){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}inverse(t){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this}floor(){return this.copy(at.floor(this)),this}ceil(){return this.copy(at.ceil(this)),this}round(){return this.copy(at.round(this)),this}abs(){return this.copy(at.abs(this)),this}normalize(){return this.copy(at.normalize(this)),this}}class ct extends ot{constructor(t,e,s){super(t,e,s)}get centerCorrected(){return new ct(...at.add(this.floored,new ot(.5,.5,.5)))}clone(){return new ct(this.x,this.y,this.z)}equals(t){return at.exactEquals(this,t)}offset(t){return this.add(t)}isNear(t,e){return this.distance(t)<=e}}class ht{constructor({location:e,dimension:n}){this.location=e instanceof ct?e:ct.create(e),this.dimension=n instanceof s?n:t.getDimension(n)}textify(){return{location:`${this.location}`,dimension:this.dimension.id}}[Symbol.toPrimitive](t){return"string"===t?`${e=this.dimension.id,e.replace(/^minecraft\:/,"")}: ${this.location}`:this;var e}}const ut=new Map;class lt{constructor(t){this.db=W.open(t,"tpx"),this.player=t}static init(t){const e=new this(t);return ut.set(t,e),e}async set({name:t,disposable:e,force:s}){const n=new ht(this.player),i=async()=>(await this.db.set(t,{info:n.textify(),disposable:e}),n);return!s&&this.db.has(t)?await x.confirm({body:`名称 ${t} 已被占用，是否覆盖？`,target:this.player,onConfirm:async()=>await i()}):await i()}async get(t){if(!this.db.has(t))return;const{info:e,disposable:s}=this.db.get(t);return s&&await this.db.delete(t),e?new ht(e):void 0}async remove(t){return!!this.db.has(t)&&await x.confirm({body:`是否删除 ${t} `,target:this.player,onConfirm:async()=>await this.db.delete(t)})}getAll(){const t=[];return d(this.db,(([e,{info:s,disposable:n}])=>{const i=new ht(s);t.push({name:e,info:i,disposable:n,text:`${e} (${i})`+(n?" [一次性]":"")})})),t}}class dt{constructor(t){this.player=t,this.playerOption=mt.getPlayer(t),this.playerDB=ut.get(t)}async set({name:t="default",option:e={}}){const s=await this.playerDB.set(Object.assign({name:t},e));if("__back__"!==t&&"__death__"!==t)return{info:s}}async remove({name:t="default"}){return await this.playerDB.remove(t)}async teleport({name:t="default"}){const e=await this.playerDB.get(t);if(e)return this.playerOption.getItemVal("auto_back_point")&&"__death__"!==t&&await this.set({name:"__back__",option:{disposable:!0,force:!0}}),await b((()=>this.player.teleport(e.location,{dimension:e.dimension,checkForBlocks:!1,keepVelocity:!1}))),{info:e}}async tryTeleport({names:t=[]}){for(const e of t){const t=await this.teleport({name:e});if(t)return t}}list(){const t=this.playerDB.getAll().map((({text:t})=>t));if(t.length)return{msg:t}}}async function yt(t){const e=t.deadEntity,s=new dt(e);await s.set({name:"__death__",option:{disposable:!0,force:!0}})}const mt=it.registerNamesapace("tpx").addItem({name:"auto_back_point",description:"允许使用 tpx 传送时自动添加返回点",values:[[!0],[!1]],defaultValue:!0,events:{changed:(t,e)=>console.warn("tpx:auto_back_point -> from",e,"to",t)}}).addItem({name:"back_after_death",description:"允许死亡时自动添加死亡点",values:[[!0],[!1]],defaultValue:!0,events:{changed:(e,s)=>{console.warn("tpx:back_after_death -> from",s,"to",e),e?t.afterEvents.entityDie.subscribe(yt,{entityTypes:["minecraft:player"]}):t.afterEvents.entityDie.unsubscribe(yt)}}}).addItem({name:"back_cmd",description:"允许使用独立的 back 命令",values:[[!0],[!1]],defaultValue:!1,reload:!0,events:{changed:(t,e)=>console.warn("tpx:back_cmd -> from",e,"to",t)}}).addItem({name:"home_cmd",description:"允许使用独立的 home 命令",values:[[!0],[!1]],defaultValue:!1,reload:!0,events:{changed:(t,e)=>console.warn("tpx:home_cmd -> from",e,"to",t)}}),ft=["set","-s","remove","rm","-r","back","bk","-b","list","ls","-l","help","-h","option","opt","-o"];async function pt(t,e){const s=t[2]??"default",n=new dt(e);switch(t[1]){case"set":case"-s":{if(ft.includes(s)||"__back__"===s)throw v(`添加失败：不能使用 ${s} 作为名称`,e);const i=await n.set({name:s,option:{disposable:"true"===t[3]||"false"!==t[3]&&null}});i&&e.sendMessage(`成功设置 ${s} 在 ${i.info}`);break}case"remove":case"rm":case"-r":{const t=await n.remove({name:s});if(!0===t)e.sendMessage(`成功删除 ${s}`);else if(!1===t)throw v(`删除失败：未找到 ${s}`,e);break}case"back":case"bk":case"-b":{const t=await n.tryTeleport({names:["__death__","__back__"]});if(!t)throw v("传送失败：未找到返回点",e);e.sendMessage(`已返回到 ${t.info}`);break}case"list":case"ls":case"-l":{const t=n.list();t?(t.msg.unshift("您的传送点有："),e.sendMessage(t.msg.join("\n- "))):e.sendMessage("您目前没有传送点");break}case"help":case"-h":e.sendMessage("制作中...");break;case"option":case"opt":case"-o":await b((()=>mt.getPlayer(e).showDialog()));break;default:{const s=await n.teleport({name:t[1]});if(!s)throw v(`传送失败：未找到传送点 ${t[1]}`,e);e.sendMessage(`已传送到 ${s.info}`)}}}async function gt(t,e){mt.getPlayer(e).getItemVal("back_cmd")?await _.asyncRun("!tpx back",e):e.sendMessage("您未启用该命令")}async function wt(t,e){if(mt.getPlayer(e).getItemVal("home_cmd"))if("set"===t[1])await _.asyncRun("!tpx set __home__",e);else await _.asyncRun("!tpx __home__",e);else e.sendMessage("您未启用该命令")}mt.applyMainPlayer().then((()=>d(t.getAllPlayers(),(t=>mt.applyPlayer(t))))).then((()=>mt.init())).then((t=>{d(t.keys(),(t=>lt.init(t))),_.register("!","tpx",pt);const e=[...t.values()];e.some((({back_cmd:t})=>t))&&_.register("!","back",gt),e.some((({home_cmd:t})=>t))&&_.register("!","home",wt)})).catch(p.error);
