#!/usr/bin/env node

// @ts-check

import fs from "node:fs"
import { resolvePath } from "../../lib/util/node.js"

const PATH = resolvePath(".", import.meta)

fs.rmSync(`${PATH}/index.ts`, {
  force: true,
})

const files = fs
  .readdirSync(PATH, {
    withFileTypes: true,
  })
  .filter((file) => file.name.endsWith(".json.ts"))

const names = files.map(({ name }) => name.replace(/\.json\.ts$/, ""))

const index = [
  "// This file is automatically generated.",
  "",
  'import type { BlockConfig } from "./_types"',
  "",
]
index.push(
  ...names.map(
    (name) =>
      `import ${name.split(".")[0].replace(":", "_")} from "./${name}.json"`
  ),
  ""
)
index.push(
  "export default {",
  ...names.map(
    (name) =>
      `  "${/^(.+)\:/.test(name) ? name : `minecraft:${name}`}": ${name.split(".")[0].replace(":", "_")},`
  ),
  "} as Record<string, BlockConfig>",
  ""
)
fs.writeFileSync(`${PATH}/index.ts`, index.join("\n"))
